### 函数：getNetTime 获取网络时间

**函数名称：获取网络时间**

**函数功能：从互联网上获取时间信息，返回从 1970 年 1 月 1 日到当前状态的秒数**

**函数方法**

time = getNetTime()

返回值： time

| 返回值 |  类型  | 说明                                                         |
| :----: | :----: | :----------------------------------------------------------- |
|  time  | number | 返回从 1970 年 1 月 1 日到当前状态的秒数，如获取失败则返回 0 |

**函数用例**

*获取网络时间 & 格式化网络时间*

```lua
time = getNetTime();         
time_year = os.date("%Y",time)            --格式化 time 值获取年份
toast(time_year)
mSleep(3000)
time_M = os.date("%m",time)             --格式化 time 值获取月份
toast(time_M)
mSleep(3000)
time_D = os.date("%d",time)             --格式化 time 值获取日
toast(time_D)
mSleep(3000)
toast(os.date("%Y年%m月%d日",time))        --连起来可以写成这样
mSleep(3000)
toast(os.date("%Y年%m月%d日%H点%M分%S秒",time))        --或这样
```

*获取网络时间并判断脚本过期*

```lua
require("TSLib")
origin = 1404439947;                            --代表北京时间 2014/7/4 10:12:27
origin_text = os.date("%Y/%m/%d %X", origin);   --格式化时间 
current = getNetTime();                         --获取网络时间 
current_text = os.date("%Y/%m/%d %X", current); --格式化时间 
if origin >= current then
    dialog("脚本尚未过期！", 5);
else
    dialog("脚本已经过期！\n 脚本使用期限："..origin_text.."\n 当前时间："..current_text, 5); 
    luaExit();
end
```

**注意事项**

1. 该函数需要网络支持，且根据网络状况有所延迟。
2. 当无法正确获取的时候该函数返回 0。

### 函数：ts.ping 测试网络连接情况

**函数名称：测试网络连接情况**

**函数功能：测试设备网络连接情况**

**函数方法**

status = ts.ping(IP/Domain Name,time)

|      参数      |     类型      | 必填 |     说明      |
| :------------: | :-----------: | :--: | :-----------: |
| IP/Domain Name | number/string |  是  | IP 地址或域名 |
|      time      |    number     |  是  |  ping 的次数  |

| 返回值 | 类型  |     说明     |
| :----: | :---: | :----------: |
| status | table | 网络连接情况 |

**函数用例**

```lua
local ts = require("ts")
status = ts.ping("www.baidu.com",3)  --也可以是 IP 地址
if status then
    for i,v in pairs(status) do
        dialog(string.format("%s = %s",i,v))
        mSleep(3000)
    end
else
    dialog(status, 0)
end
```

**注意事项**

- 1.2.1 以上版本新增了超时时间，时间为 3 秒
- ping 的次数只支持大于 0 的整数，次数超过 16 次返回值只显示 16 次的内容

### 函数：ts.ms 毫秒级时间戳

**函数名称：毫秒级时间戳**

**函数功能：返回毫秒级时间戳，用于精确计算时间**

**函数方法**

time = ts.ms()

| 返回值 |  类型  |     说明     |
| :----: | :----: | :----------: |
|  time  | number | 毫秒级时间戳 |

**函数用例**

```lua
local ts = require("ts")
time = ts.ms() 
dialog(time, 0)  --Unix时间戳
--如需转换为标准时间格式
dialog(os.date("%c",time))
```

### 函数：getNetInterfaces 获取设备接口 IP（仅支持 iOS）

**函数名称：获取设备接口 IP**

**函数功能：获取设备接口 IP**

**支持版本：专业版 iOS v3.0.4 及其以上版本**

**引擎版本：iOS v3.0.4 及其以上版本**

**函数方法**

ip = getNetInterfaces()

| 返回值 | 类型  |    说明     |
| :----: | :---: | :---------: |
|   ip   | table | 设备接口 IP |

**函数用例**

```lua
local ts = require("ts")
local json = ts.json
local ip = getNetInterfaces()
dialog(json.encode(ip))
```

### 函数：getNetIP 获取 外网IP

**函数名称：获取外网 IP**

**函数功能：获取外网 IP**

**TSLib 版本：v1.1.7 以上版本**

**函数方法**

ip = getNetIP()

| 返回值 |  类型  |  说明   |
| :----: | :----: | :-----: |
|   ip   | string | IP 地址 |

**函数用例**

```lua
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
ip = getNetIP() --获取 IP
if ip and ip ~= "" then
dialog(ip)
end
```

### 函数：ts.setHttpsTimeOut 设置请求超时时间

**函数名称：设置请求超时时间**

**函数功能：发送 httpsGET类型请求、发送 httpsPOST 类型请求、设置请求超时时间**

**函数方法**

ts.setHttpsTimeOut(sec);

| 参数 |  类型  | 必填 |        说明        |
| :--: | :----: | :--: | :----------------: |
| sec  | number |  是  | 超时时间，单位为秒 |

**注意事项**

- 此函数方法 HTTP 请求通用
- Android 仅支持 v1.1.3 及其以上版本 ts.so

### 函数：http.setTimeout 设置请求超时间

**函数名称：设置请求超时时间**

**函数功能：发送 http.get/http.post 类型请求设置请求超时时间**

**函数方法**

http.setTimeout(sec);

| 参数 |  类型  | 必填 |        说明        |
| :--: | :----: | :--: | :----------------: |
| sec  | number |  是  | 超时时间，单位为秒 |

### 函数：httpGet 获取网页数据

**函数名称：获取网页数据**

**函数功能：获取网页数据信息**

**函数方法**

webdata = httpGet(url,timeOut)

|  参数   |  类型  | 必填 | 说明                      |
| :-----: | :----: | :--: | :------------------------ |
|   url   | string |  是  | 请求的网页地址 url        |
| timeOut | number |  否  | 超时时间，不写默认为 5 秒 |

| 返回值  |      类型      | 说明                             |
| :-----: | :------------: | :------------------------------- |
| webdata | string/boolean | 成功返回网页内容，失败返回 false |

**函数用例**

```lua
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
webdata = httpGet("http://www.baidu.com/")--获取百度首页网页数据
if  webdata and webdata ~= "" then
dialog(webdata)
end
```

### 函数：ts.httpGet 发送 httpGET 请求

**函数名称：发送 httpGET 请求**

**函数功能：发送 httpGET 类型请求**

**iOS 函数方法**

status_resp, header_resp,body_resp = ts.httpGet(url, header_send, body_send);

|    参数     |  类型  | 必填 | 说明                                     |
| :---------: | :----: | :--: | :--------------------------------------- |
|     url     | string |  是  | 请求 URL                                 |
| header_send | table  |  否  | 请求头部内容，本参数必须与请求体一起填写 |
|  body_send  | table  |  否  | 请求内容，本参数必须与头部一起填写       |

|   返回值    |  类型  | 说明                      |
| :---------: | :----: | :------------------------ |
| status_resp | number | HTTP 状态码，成功返回 200 |
| header_resp | string | 返回头部                  |
|  body_resp  | string | 返回内容                  |

**Android 函数方法**

status_resp, header_resp,body_resp = ts.httpGet(url,tab)

| 参数 |  类型  | 必填 | 说明       |
| :--: | :----: | :--: | :--------- |
| url  | string |  是  | 请求 URL   |
| tab  | table  |  否  | table 参数 |

table 参数介绍

|    参数     |  类型  | 必填 | 说明                                                         |
| :---------: | :----: | :--: | :----------------------------------------------------------- |
|    tstab    | string |  是  | 只能为 tstab，不可修改                                       |
| header_send | table  |  否  | 请求头部内容，本参数必须与请求体一起填写                     |
|  body_send  | table  |  否  | 请求内容，本参数必须与头部一起填写                           |
|   format    | string |  否  | 仅支持 v1.1.4 及其以上版本 ts.so， 不写默认不对返回值进行转码， utf8 - 对 body_resp 进行 utf-8 格式转码， gbk - 对 body_resp 进行 gbk 格式转码 |

|   返回值    |  类型  | 说明                      |
| :---------: | :----: | ------------------------- |
| status_resp | number | HTTP 状态码，成功返回 200 |
| header_resp | string | 返回头部                  |
|  body_resp  | string | 返回内容                  |

**函数用例**

```lua
--iOS 脚本实例
local ts = require("ts")
header_send = {typeget = "ios"}
body_send = {id = "687"}
ts.setHttpsTimeOut(60)
status_resp, header_resp,body_resp = ts.httpGet("http://helpdoc.touchsprite.com", header_send, body_send)
dialog(status_resp,0)
dialog(header_resp,0)
dialog(body_resp,0)
--Android 脚本实例
local ts = require("ts")
--format 参数仅支持 Android ts.so v1.1.4 及其以上版本
--tstab = "tstab" 此参数不能修改
tab = {tstab = "tstab",header_send = {typeget = "android"} , body_send = {id = "687"} ,format ="gbk" }
code,header_resp, body_resp = ts.httpGet("http://whois.pconline.com.cn/ip.jsp",tab)
dialog(code,0)
dialog(header_resp,0)
dialog(body_resp,0)
```

**注意事项**

- 如果参数中有类似 “%E8%A7%A6%E5%8A%A8%E7%B2%BE%E7%81%B5” 的参数并且运行代码后发现和网络请求的结果不显示，请使用 [urlDecoder](https://helpdoc.touchsprite.com/dev_docs/26/11.html) 函数将此段代码编码后重新运行代码再试下。

### 函数：ts.httpsGet 发送 httpsGET 请求

**函数名称：发送 httpsGET 请求**

**函数功能：发送 httpsGET 类型请求**

**iOS 函数方法**

code,header_resp,body_resp = ts.httpsGet(url, header_send, body_send)

|    参数     |  类型  | 必填 | 说明                                     |
| :---------: | :----: | :--: | :--------------------------------------- |
|     url     | string |  是  | 请求 URL                                 |
| header_send | table  |  否  | 请求头部内容，本参数必须与请求体一起填写 |
|  body_send  | table  |  否  | 请求内容，本参数必须与头部一起填写       |

|   返回值    |  类型  | 说明                     |
| :---------: | :----: | :----------------------- |
|    code     | number | 返回状态码，成功返回 200 |
| header_resp | string | 头部返回内容             |
|  body_resp  | string | 返回内容                 |

**Android 函数方法**

code,header_resp,body_resp = ts.httpsGet(url,tab)

| 参数 |  类型  | 必填 | 说明       |
| :--: | :----: | :--: | :--------- |
| url  | string |  是  | 请求 URL   |
| tab  | table  |  否  | table 参数 |

**table 参数介绍**

|    参数     |  类型  | 必填 | 说明                                                         |
| :---------: | :----: | :--: | :----------------------------------------------------------- |
|    tstab    | string |  是  | 只能为 tstab，不可修改                                       |
| header_send | table  |  否  | 请求头部内容，本参数必须与请求体一起填写                     |
|  body_send  | table  |  否  | 请求内容，本参数必须与头部一起填写                           |
|   format    | string |  否  | 仅支持 v1.1.4 及其以上版本 ts.so， 不写默认为不对返回值进行转码， utf8 - 对 body_resp 进行 utf-8 格式转码， gbk - 对 body_resp 进行 gbk 格式转码 |

|   返回值    |  类型  | 说明                     |
| :---------: | :----: | :----------------------- |
|    code     | number | 返回状态码，成功返回 200 |
| header_resp | string | 头部返回内容             |
|  body_resp  | string | 返回内容                 |

**函数用例**

```lua
--iOS 脚本实例
local ts = require("ts")
header_send = {
["Content-Type"] = "application/x-www-form-urlencoded",
["Accept-Encoding"] = "gzip",
["typeget"] = "ios"
}
body_send = {["msg"] = "hello"}
ts.setHttpsTimeOut(60) 
code,header_resp, body_resp = ts.httpsGet("https://www.baidu.com", header_send,body_send)
dialog(code,0)
dialog(header_resp,0)
dialog(body_resp,0)
--Android 脚本实例
local ts = require("ts")
--format 参数仅支持 Android ts.so v1.1.4 及其以上版本
--tstab = "tstab"此参数不能修改
tab = {tstab = "tstab",header_send = {typeget = "android"} , body_send = {id = "687"} ,format ="gbk" }
code,header_resp, body_resp = ts.httpsGet("https://whois.pconline.com.cn/ip.jsp",tab)
dialog(code,0)
dialog(header_resp,0)
dialog(body_resp,0)
```

**注意事项**

- 如果参数中有类似 “%E8%A7%A6%E5%8A%A8%E7%B2%BE%E7%81%B5” 的参数并且运行代码后发现和网络请求的结果不显示，请使用 [urlDecoder](https://helpdoc.touchsprite.com/dev_docs/26/11.html) 函数将此段代码编码后重新运行代码再试下。

### 函数：http.get 发送 httpGET/httpsGET 请求

**函数名称：发送 httpGET/httpsGET 请求**

**函数功能：发送 httpGET/httpsGET 类型请求**

**函数方法**

status,header,content = http.get(url,tb)

| 参数 |  类型  | 必填 |    说明    |
| :--: | :----: | :--: | :--------: |
| url  | string |  是  |  请求 URL  |
|  tb  | table  |  是  | table 参数 |

table 参数介绍

|  参数   | 类型  | 必填 | 说明                                     |
| :-----: | :---: | :--: | :--------------------------------------- |
| headers | table |  否  | 请求头部内容，本参数必须与请求体一起填写 |
| params  | table |  否  | 字段对，会转换成 aaa=111&bbb=222 的形式  |
|  opts   | table |  否  | 文件保存路径及对返回值进行转码           |

opts 参数介绍

|  参数   |  类型  | 必填 | 说明                                                         |
| :-----: | :----: | :--: | :----------------------------------------------------------- |
|  save   | string |  否  | 文件保存路径                                                 |
| charset | string |  否  | 是否对返回值进行转码，不写默认不进行转码， gbk - 将 gbk 格式数据转换成 utf-8 格式数据 |

| 返回值  |  类型  |    说明     |
| :-----: | :----: | :---------: |
| status  | number | HTTP 状态码 |
| header  | string |  返回头部   |
| content | string |  返回内容   |

**函数用例**

```lua
--[[
    请严格按照参数名称及格式进行填写，否则会出现请求错误的问题
    本示例不可直接使用，url 需要修改为正确的网络地址
]]
require("tsnet")
local url = "https://www.baidu.com"
header_send = {
["Content-Type"] = "application/x-www-form-urlencoded",
["Accept-Encoding"] = "gzip",
["typeget"] = "ios"
}
body_send = {["msg"] = "hello"}
status,header,content = http.get(url,{headers=header_send,params=body_send,opts={charset="gbk"}})
if status == 200 then
    toast("成功",5)
    dialog(header,6)
    dialog(content,6)
    else
    dialog("失败")
end
require("tsnet")
local url = "https://whois.pconline.com.cn/ip.jsp"
status,header,content = http.get(url,{headers={aaa=123,cd=12},params={aaa=111,bbb=222},
        opts={charset="gbk"}
    }
)
dialog(status)
dialog(header)
dialog(content)
--下载图片
require("tsnet")
tb = {
    opts = {
        save = userPath().."/res/1.jpg"
    }
}
status,header,content = http.get("http://p0.so.qhmsg.com/sdr/720_1080_/t01f0c2107148464d50.jpg",tb)
if status == 200 then
    dialog("下载成功")
    else
    dialog("下载失败")
end
```

**注意事项**

- 如果使用了ops 参数中的 save 参数，则返回值中的 header 和 content 将失效，都为空字符串。
- 不使用 http.setTimeout 函数默认超时时间为 10 秒。
- 使用 ts.so 函数出现问题可以使用此函数试下。
- 请点击[使用方法](https://helpdoc.touchsprite.com/dev_docs/2188/1.html)、[函数库下载](https://helpdoc.touchsprite.com/dev_docs/2188/1.html)、[注意事项](https://helpdoc.touchsprite.com/dev_docs/2188/1.html)查看使用方法、下载函数库及查看注意事项。
- iOS 仅支持专业版、企业版和小精灵。
- Android 支持标准版、企业版和小精灵，标准版需要登录账号、购买 VIP 并且在调用过程中账号需要保持登录状态否则会导致调用失效。
- 请严格按照参数名称及格式进行填写，否则会出现请求错误的问题。
- 如果参数中有类似 “%E8%A7%A6%E5%8A%A8%E7%B2%BE%E7%81%B5” 的参数并且运行代码后发现和网络请求的结果不显示，请使用 [urlDecoder](https://helpdoc.touchsprite.com/dev_docs/26/11.html) 函数将此段代码编码后重新运行代码再试下。

- 如果想上传图片或者文件可以使用函数： [imageBase64](https://helpdoc.touchsprite.com/dev_docs/26/33.html)编码后进行上传。

### 函数：httpPost 提交网页数据

**函数名称：提交网页数据**

**函数功能：以 post 方式提交数据获取网页返回信息**

**函数方法**

str = httpPost(url,data,options)

|  参数   |  类型  | 必填 | 说明                                       |
| :-----: | :----: | :--: | :----------------------------------------- |
|   url   | string |  是  | 访问的网页地址 URL                         |
|  data   | string |  是  | 要提交的 Post 参数数据                     |
| options | table  |  否  | 仅 TSLib v1.2.8 及其以上版本支持，操作参数 |

options 参数介绍

|   参数    |  类型   | 必填 | 说明                                                         |
| :-------: | :-----: | :--: | :----------------------------------------------------------- |
|   tstab   | number  |  是  | 参数需要写为 1，不可修改                                     |
|  timeOut  | number  |  否  | 超时时间，不写默认为 5 秒                                    |
| urlEnCode | boolean |  否  | 仅 TSLib v1.2.8 及其以上版本支持 是否对 URL 进行编码。默认 false false - 不进行编码，true - 进行编码 |

| 返回值 |      类型      | 说明                             |
| :----: | :------------: | :------------------------------- |
|  str   | string/boolean | 成功返回网页内容，失败返回 false |

**函数用例**

```lua
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
local url = "http://openapi.touchsprite.com/api/openapi"
local data = [[{"action": "getAuth","key": "开发者的key","devices": {"设备号1"},"valid": 3600,"time": ]].. os.time() ..[[}]]
local options = {
    ["tstab"] = 1, -- 必填项
    ["timeOut"] = 90,
    ["urlEnCode"] = false
}
str = httpPost(url, data,options)
if str and str ~= "" then
dialog(str)
end
```

### 函数：ts.httpPost 发送 httpPOST 请求

**函数名称：ts.httpPost**

**函数功能：发送 http POST 类型 请求**

**iOS 函数方法**

status_resp, header_resp,body_resp = ts.httpPost(urlL,header_send,body_send,encode)

|    参数     |  类型   | 必填 | 说明                                                         |
| :---------: | :-----: | :--: | :----------------------------------------------------------- |
|     url     | string  |  是  | 请求 URL                                                     |
| header_send |  table  |  否  | 请求头部内容，本参数必须与请求体一起填写                     |
|  body_send  |  table  |  否  | 请求内容，本参数必须与头部一起填写                           |
|   encode    | boolean |  否  | 仅 ts.so v1.4.0 及其以上版本支持， 是否对 URL 进行编码，默认是 false，true - 对 URL 进行编码 |

|   返回值    |  类型  | 说明        |
| :---------: | :----: | ----------- |
| status_resp | number | HTTP 状态码 |
| header_resp | string | 返回头部    |
|  body_resp  | string | 返回内容    |

**Android 函数方法**

status_resp, header_resp,body_resp = ts.httpPost(url,tab)

| 参数 |  类型  | 必填 | 说明       |
| :--: | :----: | :--: | :--------- |
| url  | string |  是  | 请求 URL   |
| tab  | table  |  否  | table 参数 |

table 参数介绍

|    参数     |  类型  | 必填 | 说明                                                         |
| :---------: | :----: | :--: | :----------------------------------------------------------- |
|    tstab    | string |  是  | 只能为 tstab，不可修改                                       |
| header_send | table  |  否  | 请求头部内容，本参数必须与请求体一起填写                     |
|  body_send  | table  |  否  | 请求内容，本参数必须与头部一起填写                           |
|   format    | string |  否  | 仅 ts.so v1.1.4 及其以上版本支持， 不写为不对返回值进行转码， utf8 - 对 body_resp 进行 utf-8 格式转码， gbk - 对 body_resp 进行 gbk 格式转码 |

|   返回值    |  类型  | 说明        |
| :---------: | :----: | ----------- |
| status_resp | number | HTTP 状态码 |
| header_resp | string | 返回头部    |
|  body_resp  | string | 返回内容    |

**函数用例**

```lua
--iOS 函数用例
local ts = require("ts")
header_send = {typeget = "ios"}
body_send = {msg = "hello"}
ts.setHttpsTimeOut(60)
status_resp,header_resp, body_resp  = ts.httpPost("http://api.qingyunke.com/api.php?msg=123&key=free", header_send, body_send,true)
dialog(status_resp,0)
dialog(header_resp,0)
dialog(body_resp,0)
--Android 函数用例
local ts = require("ts")
--format 参数仅支持 Android ts.so v1.1.4 及其以上版本
--tstab = "tstab" 此参数不嫩能修改
tab = {tstab = "tstab",header_send = {typeget = "android"} , body_send = {id = "687"} ,format ="gbk" }
code,header_resp, body_resp = ts.httpPost("http://whois.pconline.com.cn/ip.jsp",tab)
dialog(code,0)
dialog(header_resp,0)
dialog(body_resp,0)
```

**注意事项**

- 如果参数中有类似 “%E8%A7%A6%E5%8A%A8%E7%B2%BE%E7%81%B5” 的参数并且运行代码后发现和网络请求的结果不显示，请使用 [urlDecoder](https://helpdoc.touchsprite.com/dev_docs/26/11.html) 函数将此段代码编码后重新运行代码再试下。
- 如果想上传图片或者文件可以使用函数： [imageBase64](https://helpdoc.touchsprite.com/dev_docs/26/33.html)编码后进行上传。

### 函数：ts.httpsPost 发送 httpsPOST 请求

**函数名称：发送 httpsPOST 请求**

**函数功能：发送 httpsPOST 类型 请求**

**iOS 函数方法**

code,header_resp,body_resp = ts.httpsPost(url,header_send, body_send);

|    参数     |  类型  | 必填 | 说明                                     |
| :---------: | :----: | :--: | :--------------------------------------- |
|     url     | string |  是  | 请求 URL                                 |
| header_send | table  |  否  | 请求头部内容，本参数必须与请求体一起填写 |
|  body_send  | table  |  否  | 请求内容，本参数必须与头部一起填写       |

|   返回值    |  类型  | 说明         |
| :---------: | :----: | :----------- |
|    code     | number | 返回状态码   |
| header_resp | string | 头部返回内容 |
|  body_resp  | string | 返回内容     |

**Android 函数方法**

code,status_resp,body_resp = ts.httpsPost(url,tab)

| 参数 |  类型  | 必填 | 说明       |
| :--: | :----: | :--: | :--------- |
| url  | string |  是  | 请求 URL   |
| tab  | table  |  否  | table 参数 |

table 参数介绍

|    参数     |  类型  | 必填 | 说明                                                         |
| :---------: | :----: | :--: | :----------------------------------------------------------- |
|    tstab    | string |  是  | 只能为 tstab，不可修改                                       |
| header_send | table  |  否  | 请求头部内容，本参数必须与请求体一起填写                     |
|  body_send  | table  |  否  | 请求内容，本参数必须与头部一起填写                           |
|   format    | string |  否  | 仅 Android ts.so v1.1.4 及其以上版本支持， 不写为不对返回值进行转码， utf8 - 对 body_resp 进行 utf-8 格式转码， gbk - 对 body_resp 进行 gbk 格式转码 |

|   返回值    |  类型  | 说明         |
| :---------: | :----: | :----------- |
|    code     | number | 返回状态码   |
| header_resp | string | 头部返回内容 |
|  body_resp  | string | 返回内容     |

**函数用例**

```lua
--iOS 脚本实例
local ts = require("ts")
header_send = {typeget = "iOS"}
body_send = {
["username"] = "aa",
["password"] = "1234"
}
-- body : username=aa&password=1234
ts.setHttpsTimeOut(60) 
code,status_resp, body_resp = ts.httpsPost("https://www.baidu.com", header_send, body_send)
dialog(code,0)
dialog(header_resp,0)
dialog(body_resp,0)
--Android 脚本实例
local ts = require("ts")
--format 参数仅支持 Android ts.so v1.1.4 及其以上版本
--tstab = "tstab"此参数不嫩能修改
tab = {tstab = "tstab",header_send = {typeget = "android"} , body_send = {id = "687"} ,format ="gbk" }
code,header_resp, body_resp = ts.httpsPost("https://whois.pconline.com.cn/ip.jsp",tab)
dialog(code,0)
dialog(header_resp,0)
dialog(body_resp,0)
```

**注意事项**

- 如果参数中有类似 “%E8%A7%A6%E5%8A%A8%E7%B2%BE%E7%81%B5” 的参数并且运行代码后发现和网络请求的结果不显示，请使用 [urlDecoder](https://helpdoc.touchsprite.com/dev_docs/26/11.html) 函数将此段代码编码后重新运行代码再试下。
- 如果想上传图片或者文件可以使用函数： [imageBase64](https://helpdoc.touchsprite.com/dev_docs/26/33.html)编码后进行上传。

### 函数：http.post 发送 httpPOST/httpsPOST 请求

**函数名称：发送 httpPOST/httpsPOST 请求**

**函数功能：发送 httpPOST/httpsPOS 类型请求**

**函数方法**

status,header,content = http.post(url,tb)

| 参数 |  类型  | 必填 |    说明    |
| :--: | :----: | :--: | :--------: |
| url  | string |  是  |  请求 URL  |
|  tb  | table  |  是  | table 参数 |

table 参数介绍

|  参数   | 类型  | 必填 | 说明                                     |
| :-----: | :---: | :--: | :--------------------------------------- |
| headers | table |  否  | 请求头部内容，本参数必须与请求体一起填写 |
| params  | table |  否  | 字段对，会转换成 aaa=111&bbb=222 的形式  |
|  opts   | table |  否  | 对返回值进行转码                         |

opts 参数介绍

|  参数   |  类型  | 必填 | 说明                                                         |
| :-----: | :----: | :--: | :----------------------------------------------------------- |
| charset | string |  否  | 是否对返回值进行转码，不写默认不进行转码， gbk - 将 gbk 格式数据转换成 utf-8 格式数据 |

| 返回值  |  类型  | 说明        |
| :-----: | :----: | :---------- |
| status  | number | HTTP 状态码 |
| header  | string | 返回头部    |
| content | string | 返回内容    |

**函数用例**

```lua
--请严格按照参数名称及格式进行填写，否则会出现请求错误的问题
require("tsnet")
local url = "https://www.baidu.com"
header_send =  {aaa=123,cd=12}
body_send =   {aaa=111,bbb=222}
status,header,content = http.post(url,{headers=header_send,params=body_send,opts={charset="gbk"}})
if status == 200 then
    toast("成功",5)
    dialog(header,6)
    dialog(content,6)
    else
    dialog("失败")
end
```

**注意事项**

- 如果不想提交 key = value 形式，可以不带 params 字段，可以使用 postdata = 要发送的数据格式的数据进行请求。
- 不使用 http.setTimeout 函数默认超时时间为 10 秒。
- 使用 ts.so 函数出现问题可以使用此函数试下。
- 请点击[使用方法](https://helpdoc.touchsprite.com/dev_docs/2188/1.html)、[函数库下载](https://helpdoc.touchsprite.com/dev_docs/2188/1.html)、[注意事项](https://helpdoc.touchsprite.com/dev_docs/2188/1.html)查看使用方法、下载函数库及查看注意事项。
- iOS 仅支持专业版、企业版和小精灵。
- Android 支持标准版、企业版和小精灵，标准版需要登录账号、购买 VIP 并且在调用过程中账号需要保持登录状态否则会导致调用失效。
- 请严格按照参数名称及格式进行填写，否则会出现请求错误的问题。
- 如果参数中有类似 “%E8%A7%A6%E5%8A%A8%E7%B2%BE%E7%81%B5” 的参数并且运行代码后发现和网络请求的结果不显示，请使用 [urlDecoder](https://helpdoc.touchsprite.com/dev_docs/26/11.html) 函数将此段代码编码后重新运行代码再试下。

- 如果想上传图片或者文件可以使用函数： [imageBase64](https://helpdoc.touchsprite.com/dev_docs/26/33.html)编码后进行上传。

### 函数：ts.setHttpProxy 设置 http 代理服务器（仅支持 iOS）

**函数名称：设置 http 代理服务器**

**函数功能：设置 http 代理服务器**

**ts.so 版本：仅支持 v1.2.4 及其以上版本**

**函数方法**

ts.setHttpProxy(IP,port)

| 参数 |  类型  | 必填 | 说明               |
| :--: | :----: | :--: | :----------------- |
|  IP  | string |  是  | 代理服务器 IP 地址 |
| port | string |  是  | 端口号             |

**函数用例**

```lua
local ts = require("ts")
IP = "123.43.123.1"
port="8008"
ts.setHttpProxy(IP,port) --—开启
ts.setHttpProxy("127.0.0.1","") --— 关闭
```

**注意事项**

此函数只针对 ts.so 中 httpGet 和 httpPost 函数生效，并不是设置手机设置中的代理。

### 函数：ts.ftp.connect 连接 FTP 服务器

**函数名称：连接 FTP 服务器**

**函数功能：连接 FTP 服务器，使用 FTP 功能前必须先连接**

**函数方法**

status = ts.ftp.connect(ftppath,username,password,kind);

|   参数   |  类型  | 必填 | 说明                                                         |
| :------: | :----: | :--: | :----------------------------------------------------------- |
| ftppath  | string |  是  | 服务器地址，示例："192.168.0.1"                              |
| username | string |  是  | 用户名，服务器登录用户名                                     |
| password | string |  是  | 密码，服务器登录密码                                         |
|   kind   | number |  否  | 仅支持 iOS ts.so v1.4.0 及其以上版本， 默认为 0，1 - 默认模式无法连请使用此模式 |

| 返回值 |  类型   | 说明                          |
| :----: | :-----: | :---------------------------- |
| status | boolean | 成功返回 true，失败返回 false |

### 函数：ts.ftp.setFTPTimeOut 设置 FTP 超时时间

**函数名称：设置 FTP 超时时间**

**函数功能：设置 FTP 超时时间，超时后执行下一步防止阻塞**

**函数方法**

ts.ftp.setFTPTimeOut(sec);

| 参数 |  类型  | 必填 |        说明        |
| :--: | :----: | :--: | :----------------: |
| sec  | number |  是  | 超时时间，单位为秒 |

### 函数：ts.ftp.download 下载文件

**函数名称：下载文件**

**函数功能：下载服务器文件到本地**

**函数方法**

status = ts.ftp.download(localfilepath,severfilepath,kind);

|     参数      |  类型  | 必填 | 说明                                        |
| :-----------: | :----: | :--: | :------------------------------------------ |
| localfilepath | string |  是  | 本地文件路径                                |
| severfilepath | string |  是  | FTP 文件路径                                |
|     kind      | number |  是  | 不写默认值 1 表示文本类型，0 表示非文本类型 |

| 返回值 |  类型   | 说明                              |
| :----: | :-----: | :-------------------------------- |
| status | boolean | true - 下载成功，false - 下载失败 |

**函数用例**

```lua
--脚本仅供参考不可直接使用
local ts = require("ts")--使用官方库前一定要在开头插入这一句
status = ts.ftp.connect("111.111.11.151","username","password") 
if status then
    dialog("连接成功", 0)
else
    dialog("连接失败", 0)
end
dwStatus = ts.ftp.download(userPath().."/res/me.png","/love.png",0)
--下载服务器上的 love.png 文件到本地 res 文件夹
if dwStatus then
    toast("下载完成", 1)
else
    toast("下载失败", 1)
end
ts.ftp.close()  --操作完成后，断开 FTP 服务器连接
```

**完整示例**

```lua
local ts = require("ts")--使用官方库前一定要在开头插入这一句
status = ts.ftp.connect("111.111.11.151","username","password") 
--FTP 操作第一步，连接 FTP 服务器，连接成功后才可进行 FTP 相关操作
if status then
    dialog("连接成功", 0)
else
    dialog("连接失败", 0)
end
mkStatus = ts.ftp.mkdir("tsnewfolder")   --创建文件夹
rmStatus=ts.ftp.rmdir("/haha") --删除文件夹
allFile = ts.ftp.list("/tsnewfolder")   --列出文件夹里所有文件
if allFile then
    allFilestr=""
    for i,v in pairs(allFile) do
        --dialog(string.format("%s = %s",i,v),1)
        --mSleep(3000)
        allFilestr=v.."\n"..allFilestr;
    end
    dialog(allFilestr, time)
else
    dialog("error",0)
end    
renameStatus =  ts.ftp.rename("/haha","/hehe123")  --重命名文件夹或文件，第一个参数为旧名，第二个参数为新名   
xstatus = ts.ftp.delete("C38K7L77DTWF.txt") --删除某个文件
path = userPath(）
    upStatus = ts.ftp.upload(path.."/lua/main.txt","/haha/main.txt") 
--上传本地 lua 文件夹下的 main.lua 文件到服务器的 haha 文件夹里
    dwStatus = ts.ftp.download(path.."/res/me.png","/love.png",0)
--下载服务器上的 love.png 文件到本地 res 文件夹
    ts.ftp.close()  --操作完成后，断开 FTP 服务器连接
```

**注意事项**

- 使用本模块时填写的文件路径中，文件名不能使用中文字符
- 文件路径必须填写完整路径

### 函数：ts.ftp.upload 上传文件

**函数名称：上传文件**

**函数功能：上传本地文件到服务器**

**函数方法**

status = ts.ftp.upload(localfilepath,severfilepath,kind);

|     参数      |  类型  | 必填 | 说明                                        |
| :-----------: | :----: | :--: | :------------------------------------------ |
| localfilepath | string |  是  | 本地文件路径                                |
| severfilepath | string |  是  | FTP 文件路径                                |
|     kind      | number |  否  | 不写默认值 1 表示文本类型，0 表示非文本类型 |

| 返回值 |  类型   | 说明                              |
| :----: | :-----: | :-------------------------------- |
| status | boolean | true - 上传成功，false - 上传失败 |

**函数用例**

```lua
--脚本仅供参考不可直接使用
local ts = require("ts")--使用官方库前一定要在开头插入这一句
status = ts.ftp.connect("111.111.11.151","username","password") 
if status then
    dialog("连接成功", 0)
else
    dialog("连接失败", 0)
end
upStatus = ts.ftp.upload(userPath().."/lua/main.txt","/haha/main.txt") 
--上传本地 lua 文件夹下的 main.lua 文件到服务器的 haha 文件夹里
if upStatus then
    toast("上传完成", 1)
else
    toast("上传失败", 1)
end
ts.ftp.close()  --操作完成后，断开 FTP 服务器连接
```

### 函数：ts.ftp.delete 删除文件

**函数名称：删除文件**

**函数功能：删除指定文件**

**函数方法**

status = ts.ftp.delete(fileName)

|   参数   |  类型  | 必填 | 说明                                     |
| :------: | :----: | :--: | :--------------------------------------- |
| fileName | string |  是  | 文件路径下的文件，具体文件需要加上扩展名 |

| 返回值 |  类型   | 说明                              |
| :----: | :-----: | :-------------------------------- |
| status | boolean | true - 删除成功，false - 删除失败 |

**函数用例**

```lua
--脚本仅供参考不可直接使用
--脚本仅供参考不可直接使用
local ts = require("ts")--使用官方库前一定要在开头插入这一句
status = ts.ftp.connect("111.111.11.151","username","password") 
if status then
    dialog("连接成功", 0)
else
    dialog("连接失败", 0)
end
xstatus = ts.ftp.delete("C38K7L77DTWF.txt") --删除某个文件
if xstatus then
    dialog("删除成功")
else
    dialog("删除失败")
end
ts.ftp.close()  --操作完成后，断开 FTP 服务器连接
```

### 函数：ts.ftp.rename 重命名文件

**函数名称：重命名文件**

**函数功能：重命名服务器上指定目录的文件**

**函数方法**

status = ts.ftp.rename(oldfilepath,newfilepath);

|    参数     |  类型  | 必填 | 说明           |
| :---------: | :----: | :--: | :------------- |
| oldfilepath | string |  是  | 待重命名文件名 |
|  filePath   | string |  是  | 新文件名       |

| 返回值 |  类型   | 说明                                  |
| :----: | :-----: | :------------------------------------ |
| status | boolean | true - 重命名成功，false - 重命名失败 |

**函数用例**

```lua
--脚本仅供参考不可直接使用
local ts = require("ts")--使用官方库前一定要在开头插入这一句
status = ts.ftp.connect("111.111.11.151","username","password") 
if status then
    dialog("连接成功", 0)
else
    dialog("连接失败", 0)
end
status = ts.ftp.rename("/haha/test1","/haha/test2")
if status then
    dialog("修改成功")
else
    dialog("修改失败")
end
ts.ftp.close()  --操作完成后，断开 FTP 服务器连接
```

**注意事项**

- 新、旧文件路径层级数必须相同
- 新、旧文件夹路径必须是同一目录

### 函数：ts.ftp.list 获取文件列表文件

**函数名称：获取文件列表文件**

**函数功能：获取服务器指定目录下的文件列表**

**函数方法**

file = ts.ftp.list(filepath)

|   参数   |  类型  | 必填 | 说明                 |
| :------: | :----: | :--: | :------------------- |
| filepath | string |  是  | 需要获取的文件夹路径 |

| 返回值 | 类型  | 说明                     |
| :----: | :---: | :----------------------- |
|  file  | table | 文件目录下的所有文件列表 |

**函数用例**

```lua
--脚本仅供参考不可直接使用
local ts = require("ts")--使用扩展库前必须插入这一句
local json = ts.json--使用 JSON 模块前必须插入这一句
status = ts.ftp.connect("111.111.11.111","username","password") 
--FTP 操作第一步，连 接 FTP 服务器，连接成功后才可进行 FTP 相关操作
if status then
    dialog("连接成功", 0)
else
    dialog("连接失败", 0)
end
file = ts.ftp.list("/firstfile/")--获取目录下的文件夹
if file then
--把 table 转换成 json 字符串
    local jsonstring = json.encode(file);
    dialog(jsonstring,0)
end
ts.ftp.close()  --操作完成后，断开 FTP 服务器连接
```

### 函数：ts.ftp.rmdir 删除文件夹

**函数名称：删除文件夹**

**函数功能：在服务器指定目录下删除文件夹**

**函数方法**

status = ts.ftp.rmdir(filepath)

|   参数   |  类型  | 必填 | 说明                   |
| :------: | :----: | :--: | :--------------------- |
| filepath | string |  是  | 删除指定目录下的文件夹 |

| 返回值 |  类型   | 说明                              |
| :----: | :-----: | :-------------------------------- |
| status | boolean | true - 删除成功，false - 删除失败 |

**函数用例**

```lua
--脚本仅供参考不可直接使用
--使用官方库前一定要在开头插入这一句
local ts = require("ts")
status = ts.ftp.connect("111.111.11.111","username","password") 
--FTP 操作第一步，连 接 FTP 服务器，连接成功后才可进行 FTP 相关操作
if status then
    dialog("连接成功", 0)
else
    dialog("连接失败", 0)
end
--删除目录下的文件夹
ts.ftp.rmdir("firstfile/ChildFile")
--操作完成后，断开 FTP 服务器连接
ts.ftp.close()
```

### 函数：ts.ftp.mkdir 创建文件夹

**函数名称：创建文件夹**

**函数功能：在服务器指定目录下创建文件夹**

**函数方法**

status = ts.ftp.mkdir(filePath);

|   参数   |  类型  | 必填 | 说明                 |
| :------: | :----: | :--: | :------------------- |
| filePath | string |  是  | 文件夹路径及文件夹名 |

| 返回值 |  类型   | 说明                              |
| :----: | :-----: | :-------------------------------- |
| status | boolean | true - 创建成功，false - 创建失败 |

**函数用例**

```lua
--脚本仅供参考不可直接使用
local ts = require("ts")--使用官方库前一定要在开头插入这一句
--此处应填入真实的地址及账号密码
status = ts.ftp.connect("111.111.11.111","username","password") 
--FTP 操作第一步，连接 FTP 服务器，连接成功后才可进行 FTP 相关操作
if status then
    dialog("连接成功", 0)
else
    dialog("连接失败", 0)
end
 --在 FTP 上的 firstFile 文件夹内创建一个 childFile 文件夹，如果没有 firstFile 文件夹则先创建 firstFile 文件夹
mkStatus = ts.ftp.mkdir("firstFile/childFile")  
 --操作完成后，断开 FTP 服务器连接
ts.ftp.close()
```

### 函数：ts.ftp.close 断开 FTP 连接

**函数名称：断开 FTP 连接**

**函数功能：断开 FTP 连接，FTP 功能使用结束后必须调用**

**函数方法**

ts.ftp.close()

### 函数：ftp.init 初始化 FTP 服务器

**函数名称：初始化 FTP 服务器**

**函数功能：初始化 FTP 服务器**

**函数方法**

ftp.init(url,username,password,kind)

|   参数   |  类型  | 必填 | 说明                                                         |
| :------: | :----: | :--: | :----------------------------------------------------------- |
|   url    | string |  是  | 服务器地址，示例："1.1.1.1"，默认端口号：21， 如果端口号不是 21，需要加下端口号，如："1.1.1.1:22" |
| username | string |  是  | 用户名，服务器登录用户名                                     |
| password | string |  是  | 密码，服务器登录密码                                         |
|   kind   | number |  否  | 连接模式，默认为 0，无法连接请更换为 1                       |

### 函数：ftp.setTimeout 设置 FTP 超时时间

**函数名称：设置 FTP 超时时间**

**函数功能：设置 FTP 超时时间，超时后执行下一步防止阻塞**

**函数方法**

ftp.setTimeout(sec)

| 参数 |  类型  | 必填 |        说明        |
| :--: | :----: | :--: | :----------------: |
| sec  | number |  否  | 超时时间，单位为秒 |

### 函数：ftp.upload 上传文件

**函数名称：上传文件**

**函数功能：上传本地文件到服务器**

**函数方法**

ret,msg = ftp.upload(localfilepath,severfilepath)

|     参数      |  类型  | 必填 | 说明         |
| :-----------: | :----: | :--: | :----------- |
|   filePath    | string |  是  | 本地文件路径 |
| severfilepath | string |  是  | FTP 文件路径 |

| 返回值 |  类型  | 说明                       |
| :----: | :----: | :------------------------- |
|  ret   | number | 1 - 上传成功，0 - 上传失败 |
|  msg   | string | 上传失败返回失败原因       |

**函数用例**

```lua
--脚本仅供参考不可直接使用
require("tsnet")
ftp.setTimeout(50)
local url ="1.1.1.1"
local username ="ceshi"
local password ="ceshi"
ftp.init(url,username,password)
ret,msg = ftp.upload(userPath().."/res/1.png","/test/1.png")  
if ret == 1 then
    dialog("上传成功")
else
    dialog("上传失败".."\n".."失败原因："..msg)
end
ftp.clean()
```

### 函数：ftp.download 下载文件

**函数名称：下载文件**

**函数功能：下载服务器文件到本地**

**函数方法**

ret,msg = ftp.download(localfilepath,severfilepath)

|     参数      |  类型  | 必填 | 说明         |
| :-----------: | :----: | :--: | :----------- |
| localfilepath | string |  是  | 本地文件路径 |
| severfilepath | string |  是  | FTP 文件路径 |

| 返回值 |  类型  | 说明                       |
| :----: | :----: | :------------------------- |
|  ret   | number | 1 - 下载成功，0 - 下载失败 |
|  msg   | string | 下载失败返回失败原因       |

**函数用例**

```lua
--脚本仅供参考不可直接使用
require("tsnet")
ftp.setTimeout(50)
local url ="1.1.1.1"
local username ="ceshi"
local password ="ceshi"
ftp.init(url,username,password)
ret,msg = ftp.download(userPath().."/res/1.png","/test/1.png")  
if ret == 1 then
    dialog("下载成功")
else
    dialog("下载失败".."\n".."失败原因："..msg)
end
ftp.clean()
```

### 函数：ftp.delete 删除文件

**函数名称：删除文件**

**函数功能：删除指定文件**

**函数方法**

ret,msg = ftp.delete(filepath)

|   参数   |  类型  | 必填 | 说明                                               |
| :------: | :----: | :--: | :------------------------------------------------- |
| filepath | string |  是  | FTP 服务器文件路径下的文件，具体文件需要加上扩展名 |

| 返回值 |  类型  | 说明                       |
| :----: | :----: | :------------------------- |
|  ret   | string | 1 - 删除成功，0 - 删除失败 |
|  msg   | string | 删除失败返回失败原因       |

**函数用例**

```lua
--脚本仅供参考不可直接使用
require("tsnet")
ftp.setTimeout(50)
local url ="1.1.1.1"
local username ="ceshi"
local password ="ceshi"
ftp.init(url,username,password)
ret,msg = ftp.delete("/test/1.png")  
if ret == 1 then
    dialog("删除成功")
else
    dialog("删除失败".."\n".."失败原因："..msg)
end
ftp.clean()
```

### 函数：ftp.rename 重命名文件（夹）

**函数名称：重命名文件（夹）**

**函数功能：重命名服务器上指定目录的文件（夹）**

**函数方法**

ret,msg = ftp.rename(oldfilepath,filepath)

|    参数     |  类型  | 必填 | 说明                   |
| :---------: | :----: | :--: | :--------------------- |
| oldfilepath | string |  是  | 待重命名文件（夹）名称 |
|  filepath   | string |  是  | 新文件名               |

| 返回值 |  类型  | 说明                           |
| :----: | :----: | :----------------------------- |
|  ret   | number | 1 - 重命名成功，0 - 重命名失败 |
|  msg   | string | 重命名失败返回失败原因         |

**函数用例**

```lua
--脚本仅供参考不可直接使用
require("tsnet")
ftp.setTimeout(50)
local url ="1.1.1.1"
local username ="ceshi"
local password ="ceshi"
ftp.init(url,username,password)
ret,msg = ftp.rename("/test/123.png","/test/223.png")  
if ret == 1 then
    dialog("重命名成功")
else
    dialog("重命名失败".."\n".."失败原因："..msg)
end
ftp.clean()
```

### 函数：ftp.list 获取文件列表文件

**函数名称：获取文件列表文件**

**函数功能：获取服务器指定目录下的文件列表**

**函数方法**

ret,msg,list = ftp.list(filepath)

|   参数   |  类型  | 必填 | 说明                 |
| :------: | :----: | :--: | :------------------- |
| filepath | string |  是  | 需要获取的文件夹路径 |

| 返回值 |  类型  | 说明                       |
| :----: | :----: | :------------------------- |
|  ret   | number | 1 - 获取成功，0 - 获取失败 |
|  msg   | string | 获取失败返回失败原因       |
|  list  | table  | 获取的文件列表             |

**函数用例**

```lua
--脚本仅供参考不可直接使用
require("tsnet")
ftp.setTimeout(50)
local url ="1.1.1.1"
local username ="ceshi"
local password ="ceshi"
ftp.init(url,username,password)
ret,msg,list = ftp.list("/test/")  
if ret == 1 then
    if list then
   allFilestr = ""
    for i,v in pairs(list) do
        allFilestr=v.."\n"..allFilestr;
    end

    dialog("获取成功："..allFilestr)--打印文件夹内所有文件列表
    end
else
    dialog("获取失败".."\n".."失败原因："..msg)
end
ftp.clean()
```

### 函数：ftp.rmdir 删除文件夹

**函数名称：删除文件夹**

**函数功能：在服务器删除指定的文件夹**

**函数方法**

ret,msg = ftp.rmkdir(filepath)

|   参数   |  类型  | 必填 | 说明                   |
| :------: | :----: | :--: | :--------------------- |
| filepath | string |  是  | 删除指定目录下的文件夹 |

| 返回值 |  类型  | 说明                       |
| :----: | :----: | :------------------------- |
|  ret   | number | 1 - 删除成功，0 - 删除失败 |
|  msg   | string | 删除失败返回失败原因       |

**函数用例**

```lua
--脚本仅供参考不可直接使用
require("tsnet")
ftp.setTimeout(50)
local url ="1.1.1.1"
local username ="ceshi"
local password ="ceshi"
ftp.init(url,username,password)
ret,msg = ftp.rmdir("/test")  
if ret == 1 then
    dialog("删除成功")
else
    dialog("删除失败".."\n".."失败原因："..msg)
end
```

### 函数：ftp.mkdir 创建文件夹

**函数名称：创建文件夹**

**函数功能：在服务器指定目录下创建文件夹**

**函数方法**

ret,msg = ftp.mkdir(filePath)

|   参数   |  类型  | 必填 | 说明                 |
| :------: | :----: | :--: | :------------------- |
| filePath | string |  是  | 文件夹路径及文件夹名 |

| 返回值 |  类型  | 说明                       |
| :----: | :----: | :------------------------- |
|  ret   | number | 1 - 创建成功，0 - 创建失败 |
|  msg   | string | 失败返回失败原因           |

**函数用例**

```lua
--脚本仅供参考不可直接使用
require("tsnet")
ftp.setTimeout(50)
local url ="1.1.1.1"
local username ="ceshi"
local password ="ceshi"
ftp.init(url,username,password)
ret,msg = ftp.mkdir("/test")  
if ret == 1 then
    dialog("创建成功")
else
    dialog("创建失败".."\n".."失败原因："..msg)
end
```

### 函数：ftp.clean 清理 FTP 相关信息

**函数功能：清理 FTP 服务器相关信息，FTP 功能使用结束后必须调用**

**函数方法**

ftp.clean()

### 函数：ts.tsDownload 下载文件

**函数名称：下载文件**

**函数功能：下载文件到设备，支持 http 和 ftp**

**函数方法**

code,msg = ts.tsDownload(path,url,bool)

| 参数 |  类型  | 必填 | 说明                                           |
| :--: | :----: | :--: | :--------------------------------------------- |
| path | string |  是  | 保存路径                                       |
| url  | string |  是  | 下载 URL                                       |
| bool | table  |  否  | 仅 iOS ts.so v1.4.0 及其以上版本支持，下载参数 |

bool 参数介绍

| 参数  |  类型   | 必填 | 说明                                                     |
| :---: | :-----: | :--: | :------------------------------------------------------- |
| tstab | number  |  是  | 固定为 1，参数名称和内容不能修改，否则会导致断点续传失效 |
| mode  | boolean |  是  | 是否进行断点续传，默认是 false，true - 进行断点续传      |

| 返回值 |  类型  | 说明                   |
| :----: | :----: | :--------------------- |
|  code  | number | 状态码，200 为下载成功 |
|  msg   | string | 下载状态               |

**函数用例**

```lua
local ts = require("ts")
code,msg = ts.tsDownload(userPath().."/res/1.jpg","http://p0.so.qhmsg.com/sdr/720_1080_/t01f0c2107148464d50.jpg",{["tstab"] = 1,["mode"] = true})  
--同样支持 ftp 地址
--"1.jpg"（如只填文件名，默认保存到触动 res 目录下）
if code == 200 then
    dialog("下载成功："..msg,0)
else
    dialog("下载失败："..msg,0)
end
--下载中文字库到企业版/触动精灵/小精灵，未下载完成前请勿停止脚本或者重启服务否则文件将损坏，触动精灵推荐在客户端 - 更多（我的账号）- 文件管理 - 插件中下载
local ts = require("ts")
file = userPath().."/res/tessdata/chi_sim.traineddata"
url = "http://video.touchsprite.com/%E5%B8%AE%E5%8A%A9%E6%96%87%E6%A1%A3/%E4%B8%AD%E8%8B%B1%E6%96%87%E5%AD%97%E5%BA%93/chi_sim.traineddata"
code,msg = ts.tsDownload(file,url)  
if code == 200 then
    dialog("下载成功："..msg,0)
else
    dialog("下载失败："..msg,0)
end
```

**注意事项**

- 如果 url 中有中文或者特殊符号请使用 [urlEncoder](https://helpdoc.touchsprite.com/dev_docs/26/10.html) 函数将中文或者特殊符号编码后再试下。

### SMTP 邮件发送库（仅支持 iOS）

**函数：mail.send**

**函数功能：发送邮件**

**函数方法**

a = mail.send("send@gmail.com", "receive@gmail.com", "Hello", "This is a test mail.", "smtp.gmail.com", "send@gmail.com", "***")

|  参数  |  类型  | 必填 | 说明            |
| :----: | :----: | :--: | :-------------- |
| 参数 1 | string |  是  | 发送者邮件地址  |
| 参数 2 | string |  是  | 接收者邮件地址  |
| 参数 3 | string |  是  | 邮件主题        |
| 参数 4 | string |  是  | 邮件正文        |
| 参数 5 | string |  是  | SMTP 服务器     |
| 参数 6 | string |  是  | SMTP 鉴定用户名 |
| 参数 7 | string |  是  | SMTP 鉴定密码   |

| 返回值 |      类型      | 说明                                  |
| :----: | :------------: | :------------------------------------ |
|   a    | boolean/string | true - 发送成功，其它字符串为失败原因 |

**函数用例**

```lua
local mail = require "mail"
a = mail.send("i.82@82flex.com", "357722984@qq.com", "Hello", "This is a test mail.", "smtp.mxhichina.com", "i.82@82flex.com", "***")
if a == true then         --发送成功
    dialog("Succeed!", 0)
else
    dialog(a, 0)
end
```

**注意事项**

- 点击 [mail.so](http://video.touchsprite.com/插件函数库/mail.so/mail.so) 进行下载。
- iOS11 以下系统设备将 so 放入 /var/mobile/Media/TouchSprite/plugin 文件夹下。
- iOS11 及其以上系统设备将 so 放入/ var/mobile/Media/TouchSprite/plugin_ios11 或者 usr/bin/tsplugin 文件夹下。

### 函数：ts.smtp 通过 smtp 发送邮件

**函数名称：通过 smtp 发送邮件**

**函数功能：通过 smtp 方式发送邮件**

**函数方法**

status = ts.smtp("收件人邮箱","邮件主题","邮件正文","发送邮件的 smtp 服务器","发送邮件的 smtp 邮箱账号","发送邮件的 smtp 邮箱授权码")

| 返回值 |  类型   | 说明                              |
| :----: | :-----: | :-------------------------------- |
| status | boolean | true - 发送成功，false - 发送失败 |

**函数用例**

```lua
local ts = require("ts")
status = ts.smtp("10879433@qq.com","紧急通知","今天不上班","smtp.qq.com","test@qq.com","testpassword")
if status then           
    dialog("Success", 0) --发送成功
else
    dialog("False", 0) --发送失败
end
```

**注意事项**

1. 邮箱需先开启 SMTP 服务功能，例如 163 邮箱，在登录邮箱后 - 设置 - POP3/SMTP/IMAP 中开启 SMTP 服务。
2. SMTP 服务器和 SMTP 授权码请以邮箱后台提供的为准，一般与邮箱登录密码不同。常用邮箱授权码使用方法：[QQ 邮箱](https://service.mail.qq.com/cgi-bin/help?subtype=1&&no=1001256&&id=28&client=tim&ADUIN=1085473932&ADSESSION=1547084684&ADTAG=CLIENT.QQ.5597_.0&ADPUBNO=26863)、[163邮箱](https://jingyan.baidu.com/article/adc815139f60c2f723bf7385.html)，其他邮箱请自行百度。
3. 邮件有可能会被归入垃圾箱，请自行检查邮件内容。

### Socket 模块

**函数功能：发送 tcp/udp 请求**

**函数用例**

```lua
local ts = require("ts")
local socket = require("socket")
local host = "www.baidu.com"
local file = "/"
local sock = assert(socket.connect(host, 80))  -- 创建一个 TCP 连接，连接到 HTTP 连接的标准 80 端口上
sock:send("GET " .. file .. " HTTP/1.0\r\n\r\n")
repeat
    local chunk, status, partial = sock:receive(1024) -- 以 1K 的字节块来接收数据，并把接收到字节块输出来
    dialog(chunk or partial, 0)
until status ~= "closed"
sock:close()  -- 关闭 TCP 连接
local ts = require("ts")
local socket = require("socket")
local host = host or "127.0.0.1"
local port = port or 8080
print("Binding to host '" ..host.. "' and port " ..port.. "...")
--创建 udp 对象
udp = assert(socket.udp())
--绑定到指定的端口
assert(udp:setsockname(host, port))
--设置超时时间
assert(udp:settimeout(5))
--获取绑定 IP 和端口
ip, port = udp:getsockname()
assert(ip, port)
print("Waiting packets on " .. ip .. ":" .. port .. "...")
local recvmaxbyte =20
--单线程无限循环
while 1 do
    --接收udp packet
    dgram, ip, port = udp:receivefrom(recvmaxbyte)
    if(dgram=="终止")then
        nlog("终止")
        break
    end
    if dgram then
        dialog("Echoing '" .. dgram .. "' to " .. ip .. ":" .. port)
        --发送数据
        udp:sendto(dgram, ip, port)
    else
        dialog(ip)
    end
end
udp=nil
collectgarbage("collect")
```

