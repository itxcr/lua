# TSLib 基础扩展库

### 获取扩展版本号

```lua
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
dialog(TSVersions()) --返回版本号字符串，返回值如：1.1.1
```

### compareVersion 比较版本号

| 参数 |  类型  | 必填 |               说明               |
| :--: | :----: | :--: | :------------------------------: |
|  v1  | string |  是  | 需要比较的版本号，参数需要大于 0 |
|  v2  | string |  是  | 需要比较的版本号，参数需要大于 0 |

| 返回值 |  类型  | 说明                                                         |
| :----: | :----: | :----------------------------------------------------------- |
|  size  | string | 如果 v1 大于 v2 返回 1，如果 v2 大于 v1 返回 2，v1 与 v2 相同返回 3 |

```lua
require("TSLib")
local m = TSVersions()
--注意：仅支持 TSLib v1.2.9 及其以上版本
size = compareVersion(m,"1.3.4")
if size == 3 then
    dialog("TSLib 版本号为 1.3.4")
elseif  size == 1  then
    dialog("TSLib 版本号大于 1.3.4")
elseif  size == 2  then
    dialog("TSLib 版本号小于 1.3.4")
end
```

### 函数：checkTSLibrary 检测加载插件

| 参数 |  类型  | 必填 | 说明                           |
| :--: | :----: | :--: | :----------------------------- |
| name | string |  是  | 插件或函数库名称，`aso`、`vpn` |

| 返回值 |  类型   | 说明                              |
| :----: | :-----: | :-------------------------------- |
|  bool  | boolean | true - 查询成功，false - 查询失败 |
|  msg   | string  | 查询结果或错误信息                |

```lua
--[[
    vpn = VPN 插件
 --]]
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
local bool,msg = checkTSLibrary("tsvpn") -- TSLib 1.2.5 以上版本支持此函数 
dialog((bool and "成功 : " or "失败 : ") .. msg)
```

### 函数：tap 点击

tap(x,y,{ms,pic,index})

| 参数  |  类型  | 必填 | 说明                                                         |
| :---: | :----: | :--: | :----------------------------------------------------------- |
|   x   | number |  是  | 屏幕横坐标                                                   |
|   y   | number |  是  | 屏幕纵坐标                                                   |
|  ms   | number |  否  | 时间，缺省默认为 50，单位毫秒                                |
|  pic  | string |  否  | 点击效果图路径，仅支持函数库 v1.2.4 及其以上版本 支持绝对路径和相对路径，相对路径默认为 res 目录， 图片不存在则不显示点击位置 |
| index | number |  否  | 手指序号，仅支持函数库 v1.3.0 及其以上版本 默认不写随机手指序号，推荐使用 1-9 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--index 参数仅支持函数库 v1.3.0 及其以上版本 TSLib
--pic 参数仅支持函数库 v1.2.4 及其以上版本 TSLib
tap(100,200,50,"1.png",1) --点击坐标(100,200),默认按下 50 毫秒后抬起
--tap(100,200,{["ms"]=50,["index"] = 1,["pic"] ="1.png"})
```

### 函数：moveTo 滑动

moveTo(x1,y1,x2,y2,step,ms,{index,stop})

| 参数  |     类型     | 必填 | 说明                                                         |
| :---: | :----------: | :--: | :----------------------------------------------------------- |
|  x1   |    number    |  是  | 屏幕起点横坐标                                               |
|  y1   |    number    |  是  | 屏幕起点纵坐标                                               |
|  x2   |    number    |  是  | 屏幕终点横坐标                                               |
|  y2   |    number    |  是  | 屏幕终点纵坐标                                               |
| step  |    number    |  否  | 滑动速度，不写默认为 10 px                                   |
|  ms   |    number    |  否  | 弹起时间，不写默认为 50 毫秒                                 |
| index | table/number |  否  | 手指序号，仅支持函数库 v1.3.0 及其以上版本 默认不写随机手指序号，推荐使用 1 - 9 |
| stop  |   boolean    |  否  | 是否解决惯性滑动，仅支持函数库 v1.3.1 及其以上版本 默认 0 不进行处理，1 - 精准滑动，解决惯性问题 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--从坐标(100,100)滑动到(300,100)，步长为 20 像素，默认移到另一点等待 70 毫秒弹起
--index 参数仅支持 TSLib v1.3.0 及其以上版本
--step 步长不宜超过 50 像素
--stop 参数仅支持 TSLib v1.3.1 及其以上版本
moveTo(100,100,300,100,{["step"] = 20,["ms"] = 70,["index"] = 1,["stop"] = 1}) 
--moveTo(100,100,300,100,20,70,1,1)
```

- 步长不宜超过 50

### 函数：randomTap 随机点击

randomTap(x,y,r,pic,index,ms)

| 参数  |  类型  | 必填 | 说明                                                         |
| :---: | :----: | :--: | :----------------------------------------------------------- |
|   x   | number |  是  | 屏幕横坐标                                                   |
|   y   | number |  是  | 屏幕纵坐标                                                   |
|   r   | number |  否  | 随机值，缺省默认为 5px                                       |
|  pic  | string |  否  | 点击效果图路径，此参数仅支持函数库 v1.2.4 及其以上版本 支持绝对路径和相对路径，相对路径默认为 res 目录， 图片不存在则不显示点击位置 |
| index | number |  否  | 手指序号，仅支持函数库 v1.3.0 及其以上版本 默认不写随机手指序号，推荐使用 1-9 |
|  ms   | number |  否  | 弹起时间，不写默认为 50 毫秒，仅支持函数库 v1.3.5 及其以上版本 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--pic 参数仅支持函数库 v1.2.4 及其以上版本 TSLib
--index 参数支持 v3.1.0 及其以上版本
--ms 参数仅支持 v3.1.5 及其以上版本

randomTap(100,200,10,"1.png",1,1000)--随机点击坐标(x,y)，x 为 100±10 取一个随机值，y 为 200±10 取一个随机值，1 秒后弹起。
```

### 函数：touchDown touchUp 触摸按下 抬起

touchDown(index,x,y)

touchUp(index,x ,y)

| 参数  |  类型  | 必填 |        说明        |
| :---: | :----: | :--: | :----------------: |
| index | number |  否  | 手指序号（可省略） |
|   x   | number |  是  |     屏幕横坐标     |
|   y   | number |  是  |     屏幕纵坐标     |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
--在坐标 (150, 550)按下
touchDown(150, 550);    
mSleep(30);
--在坐标 (150, 550) 抬起
touchUp(150, 550);
```

- 需要注意的是在使用 `touchDown`、`touchMove`、`touchUp` 函数时，中间一定要插入一定的延时，建议大于 20 毫秒，否则可能会出现点击无效等异常情况。

- 使用滑动函数时，新手常犯的错误就是两点之间滑动距离过大，请注意 `touchDown`、`touchMove` 的坐标间隔不宜超过 50 像素。

- 非多点触控可省略手指 id。

### 函数：touchMove 触摸移动

touchMove(index,x ,y)

| 参数  |  类型  | 必填 |        说明        |
| :---: | :----: | :--: | :----------------: |
| index | number |  否  | 手指序号（可省略） |
|   x   | number |  是  |     屏幕横坐标     |
|   y   | number |  是  |     屏幕纵坐标     |

```lua
--在坐标 (150, 550)按下
--此函数为触动精灵专用函数请勿用于积木编程
touchDown(150, 550);    
mSleep(30);
--移动到坐标 (150, 600)，注意一次滑动的坐标间隔不要太大，不宜超过 50 像素
touchMove(150, 600);    
mSleep(30);
--在坐标 (150, 600) 抬起
touchUp(150, 600);
```

### 函数：catchTouchPoint 获取用户点击坐标

x,y = catchTouchPoint();

| 返回值 |  类型  | 说明                 |
| :----: | :----: | :------------------- |
|   x    | number | 用户点击屏幕的横坐标 |
|   y    | number | 用户点击屏幕的纵坐标 |

ret = catchTouchPoint(touchCount)

|    参数    |  类型  | 必填 | 说明                                                         |
| :--------: | :----: | :--: | :----------------------------------------------------------- |
| touchCount | number |  是  | 所需获取的点/坐标个数 （需引擎版本 iOS v2.2.4,Android v1.1.9 以上支持） |

| 返回值 | 类型  | 说明                                                         |
| :----: | :---: | :----------------------------------------------------------- |
|  ret   | table | 当 touchCount 参数有效时，将返回一个包含所有点击坐标的 table |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
dialog("一秒后接收用户一次点击", 0);
mSleep(1000);
x,y = catchTouchPoint(); 
dialog("x:"..x.." y:"..y, 0);
```

```lua
--获取多个点击坐标
dialog("一秒后接收用户三次点击", 0);
mSleep(1000);
local ret = catchTouchPoint(3);
for i = 1, #ret do  
    dialog("第"..i.."次点击的位置:"..i..",x="..ret[i].x..",y="..ret[i].y);
end
```

- \# 来计算字符串的长度

### 函数：setScreenScale 坐标缩放

setScreenScale(flag,width,height)

|  参数  |  类型   | 必填 | 说明                      |
| :----: | :-----: | :--: | :------------------------ |
|  flag  | boolean |  是  | true - 打开，false - 关闭 |
| width  | number  |  是  | 基准屏幕的宽度            |
| height | number  |  是  | 基准屏幕的高度            |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
--当此函数打开时，将影响点击、取色、单点模糊找色等函数
--以 750,1334 分辨率为基准坐标进行缩放
setScreenScale(true,750,1334)   
--关闭缩放
setScreenScale(false)
```

### 函数：xyRotate 坐标转换

x2,y2 = xyRotate(x1,y1,dir)

| 参数 |  类型  | 必填 | 说明             |
| :--: | :----: | :--: | :--------------- |
|  x1  | number |  是  | 需要旋转的横坐标 |
|  y1  | number |  是  | 需要旋转的纵坐标 |
| dir  | number |  是  | 旋转方向，0 - 3  |

dir 参数介绍

| 参数 |       说明       |
| :--: | :--------------: |
|  0   |      不旋转      |
|  1   | 逆时针旋转 90 度 |
|  2   | 顺时针旋转 90 度 |
|  3   |   旋转 180 度    |

| 返回值 |  类型  |      说明      |
| :----: | :----: | :------------: |
|   x2   | number | 旋转后的横坐标 |
|   y2   | number | 旋转后的纵坐标 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require("TSLib")
for var= 1,4,1 do
    x,y = xyRotate(611,274,var-1);
    dialog(x..","..y)
end
```

### 函数：randomsTap 随机滑动点击

randomsTap(x,y,{r,pic,index,ms})

| 参数  |     类型     | 必填 | 说明                                                         |
| :---: | :----------: | :--: | :----------------------------------------------------------- |
|   x   |    number    |  是  | 屏幕横坐标                                                   |
|   y   |    number    |  是  | 屏幕纵坐标                                                   |
|   r   |    number    |  否  | 随机值，缺省默认为 20，单位 px                               |
|  pic  |    string    |  否  | 点击效果图路径，此参数仅支持函数库 v1.2.4 及其以上版本 支持绝对路径和相对路径，相对路径默认为 res 目录， 图片不存在则不显示点击位置 |
| index | table/number |  否  | 手指序号，仅支持函数库 v1.3.0 及其以上版本 默认不写随机手指序号，推荐使用 1 - 9 |
|  ms   |    number    |  否  | 弹起时间，不写默认为 50 毫秒，仅支持函数库 v1.3.5 及其以上版本 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
dialog(TSVersions())
--index 参数仅支持函数库 v1.3.0 及其以上版本 TSLib
--pic 参数仅支持函数库 v1.2.4 及其以上版本 TSLib
--ms 参数仅支持函数库 v1.3.5 及其以上版本 TSLib
randomsTap(100,200,{["index"] = 1,["pic"] ="1.png",["r"]=5,["ms"]=5000}) --随机点击滑动坐标(x,y)，x 为 100±20 取一个随机值，y 为 200±20 取一个随机值,并在此范围内随机抖动，5 秒后弹起。
--参数齐全后显示点击位置的图标才会显示
--randomsTap(100,200,20,"1.png",1,5000)
```

### 函数：moveTowards 角度滑动

moveTowards(x,y,angle,length,step);

|  参数  |  类型  | 必填 | 说明                      |
| :----: | :----: | :--: | :------------------------ |
|   x    | number |  是  | 屏幕起点横坐标            |
|   y    | number |  是  | 屏幕起点纵坐标            |
| angle  | number |  是  | 角度                      |
| length | number |  是  | 滑动长度                  |
|  step  | number |  否  | 滑动速度，不写默认为 10px |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
moveTowards(500,500,90,300,10) --从坐标(500,500)向上滑动 300
```

- 角度 angle 为 0 时向右滑动，90 向上滑动，180 向左滑动

- 长度 length 大于 0

- 可选参数速度 step，当不写默认为 10，也可自己填写，step 应为大于 0 小于距离长度的数值，建议小于 50，否则会出现滑动无效的情况

### 函数：moveZoomOut 捏合

moveZoomOut(x1,y1,x2,y2,step)

| 参数 |  类型  | 必填 | 说明                       |
| :--: | :----: | :--: | :------------------------- |
|  x1  | number |  是  | 需要捏合点 1 的横坐标      |
|  y1  | number |  是  | 需要捏合点 1 的纵坐标      |
|  x2  | number |  是  | 需要捏合点 2 的横坐标      |
|  y2  | number |  是  | 需要捏合点 2 的纵坐标      |
| step | number |  否  | 捏合速度，不写默认为 10 px |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
moveZoomOut(100,100,300,300) --从坐标 (100,100) 和坐标 (300,300) 同时向中间点滑动缩小
```

- 可选参数速度 step，当不写默认为 10，也可自己填写，step 为大于 0 小于距离长度的数值，建议小于 50，否则会出现滑动无效的情况

### 函数：moveZoomIn 放大滑动

moveZoomIn(x1,y1,x2,y2,step)

| 参数 |  类型  | 必填 | 说明                        |
| :--: | :----: | :--: | :-------------------------- |
|  x1  | number |  是  | 放大滑动点 1 的横坐标       |
|  y1  | number |  是  | 放大滑动点 1 的纵坐标       |
|  x2  | number |  是  | 放大滑动点 2 的横坐标       |
|  y2  | number |  是  | 放大滑动点 2 的纵坐标       |
| step | number |  否  | 滑动速度，不写缺默认为 10px |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
moveZoomIn(100,100,300,300) --两点坐标中间同时向坐标 (100,100) 和坐标 (300,300) 两端滑动
```

### 函数：moveCircleCenter 圆心滑动

moveCircleCenter(cX,cY,x,y,angle,step,direction)

|   参数    |  类型  | 必填 | 说明                                      |
| :-------: | :----: | :--: | :---------------------------------------- |
|    cX     | number |  是  | 圆心点横坐标                              |
|    cY     | number |  是  | 圆心点纵坐标                              |
|     x     | number |  是  | 圆上点横坐标                              |
|     y     | number |  是  | 圆上点纵坐标                              |
|   angle   | number |  否  | 滑动角度，不写默认为 360，转一周          |
|   step    | number |  否  | 滑动速度，不写默认为 10px                 |
| direction | number |  否  | 滑动方向，不写默认为逆时针，-1 时为顺时针 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
moveCircleCenter(200,200,0,200) --以圆心坐标(200,200)，圆上一点起点(0,200),逆时针转一圈
```

- 角度 angle 大于 0，转 1 圈数值为 360，以此类推

- step 步长不写默认为 10，越小越快，大于 0，建议小于 50，否则可能会导致函数运行无效

- 方向 direction 默认逆时针，-1 时为顺时针

### 函数：moveCirclePonits 圆弧滑动

moveCirclePonits(x1,y1,x2,y2,x3,y3,angle,step,direction);

|   参数    |  类型  | 必填 | 说明                                      |
| :-------: | :----: | :--: | :---------------------------------------- |
|    x1     | number |  是  | 圆上点 1 横坐标                           |
|    y1     | number |  是  | 圆上点 1 纵坐标                           |
|    x2     | number |  是  | 圆上点 2 横坐标                           |
|    y2     | number |  是  | 圆上点 2 纵坐标                           |
|    x3     | number |  是  | 圆上点 3 横坐标                           |
|    y3     | number |  是  | 圆上点 3 纵坐标                           |
|   angle   | number |  否  | 滑动角度，不写默认为 360，转一周          |
|   step    | number |  否  | 滑动速度，不写默认为 10px                 |
| direction | number |  否  | 不滑动方向，写默认为逆时针，-1 时为顺时针 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
moveCirclePonits(300,100,100,200,500,200) --三点坐标确定圆心，以圆上起点(300,100)，逆时针转一圈
```

### 函数：getAngle 获取角度

angle = getAngle(x1,y1,x2,y2)

| 参数 |  类型  | 必填 |     说明     |
| :--: | :----: | :--: | :----------: |
|  x1  | number |  是  | 基准点横坐标 |
|  y1  | number |  是  | 基准点纵坐标 |
|  x2  | number |  是  | 查找点横坐标 |
|  y2  | number |  是  | 查找点纵坐标 |

| 返回值 |  类型  | 说明         |
| :----: | :----: | :----------- |
| angle  | number | 获取到的角度 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require("TSLib")
angle = getAngle(188,379,317,243)
dialog(angle)
```

### 函数：touch() 获取对象

local touch = touch(index)

| 参数  |  类型  | 必填 | 说明                                                         |
| :---: | :----: | :--: | :----------------------------------------------------------- |
| index | number |  否  | 手指序号，仅支持函数库 v1.3.0 及其以上版本 默认不写随机手指序号，推荐使用 0 - 29 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--touch 函数仅支持 V1.2.7 以上版本 TSLib  
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
tsver = TSVersions()     
tsint = tonumber(string.sub(tsver,1,1)..string.sub(tsver,3,3)..string.sub(tsver,5,5));
if tsint < 127 then
    dialog("TSLib 版本低，请下载最新版本的 TSLib 导入到lua文件夹下")
    luaExit()
end
--index 参数仅支持函数库 v1.3.0 及其以上版本 TSLib
local touch = touch() 
touch:on(100,100):move(100,100):off()
```

### 函数：on 按下

**随机分配的手指 id 在 (x,y) 处按下**

touch = touch:on(x,y)

| 参数 |  类型  | 必填 |    说明    |
| :--: | :----: | :--: | :--------: |
|  x   | number |  是  | 屏幕横坐标 |
|  y   | number |  是  | 屏幕纵坐标 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--仅支持 1.2.7 以上版本的 TSLib 
require "TSLib"
touch():on(100,100):off()
```

```lua
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--仅支持 V1.3.3 以上版本的 TSLib 
require "TSLib"
local touch = touch() 
touch:on(100,100):off()
```

```lua
--仅支持 V1.3.3 以上版本的 TSLib 
require "TSLib"
local touch = touch() 
touch = touch:on(100,100)
touch = touch:Delay(20)
touch:off()
```

### 函数：move 移动

touch = touch:move(x,y)

| 参数 |  类型  | 必填 |    说明    |
| :--: | :----: | :--: | :--------: |
|  x   | number |  是  | 屏幕横坐标 |
|  y   | number |  是  | 屏幕纵坐标 |

```lua
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--此函数为触动精灵专用函数请勿用于积木编程
--仅支持 V1.2.7 以上版本的 TSLib 
require "TSLib"
touch():on(100,100):move(200,200):off()
```

```lua
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--仅支持 V1.3.3 以上版本的 TSLib 
require "TSLib"
local touch = touch(1) 
touch:on(100,100):move(200,200):off()
```

### 函数：off 抬起

off()

```lua
--此函数为触动精灵专用函数请勿用于积木编程
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--仅支持 V1.2.7 以上版本的 TSLib 
require "TSLib"
touch():on(100,100):move(200,200):off()
```

```lua
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--index 参数仅支持 V1.3.3 以上版本的 TSLib 
require "TSLib"
local touch = touch(1) 
touch:on(100,100):move(200,200):off()
```

### 函数：Delay 设置延迟

touch = touch:Delay(time)

| 参数 |  类型  | 必填 |           说明           |
| :--: | :----: | :--: | :----------------------: |
| time | number |  否  | 延迟时间，不写默认为 5ms |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--仅支持 V1.2.7 以上版本的 TSLib 
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
touch():Delay(10):on(100,100):move(200,200):off()
```

```lua
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--index 参数仅支持 V1.3.3 以上版本的 TSLib 
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
local touch = touch() 
touch:Delay(10):on(100,100):move(200,200):off()
```

### 函数：Step 设置步长

touch = touch:Step(step)

| 参数 |  类型  | 必填 |            说明            |
| :--: | :----: | :--: | :------------------------: |
| step | number |  否  | 步长，不写默认值为 10 像素 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--仅支持 V1.2.7 以上版本 TSLib 使用
require "TSLib"
touch():Step(5):on(100,100):move(200,200):off()
```

```lua
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--index 仅支持 V1.3.3 以上版本 TSLib 使用
require "TSLib"
local touch = touch() 
touch:Step(5):on(100,100):move(200,200):off()
```

## 示例

### 连续滑动

```lua
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--index 参数仅支持 V1.3.3 以上版本的 TSLib 
require "TSLib"
local touch = touch() 
touch = touch:on(100,100)
touch = touch:Step(10)
touch = touch:Delay(5)
touch = touch:move(100,200)
touch = touch:move(200,200)
touch = touch:move(200,100)
touch = touch:move(100,100)
touch:off()
```

```lua
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--仅支持 V1.2.7 以上版本的 TSLib 
require "TSLib"
touch():on(100,100):Step(10):Delay(5):move(100,200):move(200,200):move(200,100):move(100,100):off()
```

### 精准滑动

```lua
--精准滑动的原理就是通过向滑动方向的垂直线方向移动 1 像素来终止滑动惯性
--简单的垂直精准滑动
touchDown(200,1000)
for i = 0, 500, 50 do
    touchMove(200, 1000-i)
    mSleep(10)
end
--只要 90 度滑动 1 像素就可以精准滑动
--横向滑动 1 像素
touchUp(201, 500) 
mSleep(10)
```

```lua
--使用 v1.2.7 版本 TSLib 新增的 touch() 函数进行滑动
require("TSLib")
touch():Step(50):on(200,1000):move(200,500):off()
--减少步长也可以进行精准滑动
```

```lua
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--从坐标(100,100)滑动到(300,100)，步长为 20 像素，默认移到另一点等待 70 毫秒弹起
--index 参数仅支持 TSLib v1.3.0 及其以上版本
--step 步长不宜超过 50 像素
--stop 参数仅支持 TSLib v1.3.1 及其以上版本
moveTo(100,100,300,100,{["step"] = 20,["ms"] = 70,["index"] = 1,["stop"] = true})
```

### 多点触控

```lua
--此示例代码所有函数为触动精灵专用函数请勿用于积木编程
touchDown(1, 200, 400);                --手指 1 在坐标 (200, 400) 按下
touchDown(2, 300, 500);                --手指 2 在坐标 (300, 500) 按下
mSleep(50);
for i = 1, 100, 1 do                --使用 for 循环使两只手指同时分离
    touchMove(1, 200 - i, 400 - i); 
    touchMove(2, 300 + i, 500 + i);
    mSleep(10);
end
touchUp(1, 200 - 100, 400 - 100);    --抬起手指 1
touchUp(2, 300 + 100, 500 + 100);   --抬起手指 2
```

### 封装点击函数

```lua
function click(x, y)
    touchDown(x, y)
    mSleep(30)
    touchMove(x, y) -- 安卓部分机型单点不生效的情况下可以加上此句
    touchUp(x, y)
end
click(100, 200) --点击坐标 100,200 位置
```

### 方形渐开线

```lua
init(1)
mSleep(1000)
local x = 1010 --起始坐标 x
local y = 698  --起始坐标 y
local v = 30   --两点间距离
touchDown(x, y)
mSleep(100)
for var = 1,20 do
    j = 0
    k = v
    for _i = 1,2 do
        for i = 1,10 do
            x = x + j
            y = y + k
            touchMove(x, y)
            mSleep(20)
        end
        j = v
        k = 0
    end
    v = v * (-1.05)
end
touchUp(x, y)
```

### 圆形渐开线

```lua
init(1)
mSleep(1000)
local x0 = 1010 --起始坐标 x
local y0 = 698  --起始坐标 y
local rr = 20   --设置递增半径 
local l = 10    --设置点间距 
local p = 0     --初始化角度  
local r = 30    --设置首圈半径
local rn = 10   --设置圈数
touchDown(x0, y0)
mSleep(100)
for var = 1,rn do
    while p < math.pi * 2 do
        x = x0 + r * math.cos(p) 
        y = y0 - r * math.sin(p) 
        touchMove(x, y)
        mSleep(10)
        p = p + l/r
    end
    p = 0
    r = r + rr 
end
touchUp(x0, y0)
```

## 安卓点击失效

```lua
--其中 x,y 为坐标值 
os.execute("input mouse tap x y")，
```

```lua
--点击坐标（600,900）
x=100+500
y=500+400
m=tostring(x)
n=tostring(y)
os.execute("input mouse tap "..m.." "..n)
```

##### **滑动，x1 y1 为滑动初始坐标，x2 y2 为滑动结束坐标**

os.execute("input mouse swipe x1 y1 x2 y2")

```
如果以上命令还是不生效可以用下面的 API 方法代替 mouse 进行尝试：

keyboard  
joystick  
touchnavigation  
touchpad  
trackball  
stylus  
dpad  
touchscreen  
gamepad
```

```lua
os.execute("input keyboard tap 100 100")
```

如果仍无法滑动可以使用 touchInputDown、touchInputMove、touchInputUp 函数。

##### 函数：touchInputDown、touchInputMove、touchInputUp 触动点击、滑动（仅支持 Android）

touchInputDown(index,x ,y)

touchInputMove(index, x, y)

touchInputUp(index,x ,y)

| 参数  |  类型  | 必填 |        说明        |
| :---: | :----: | :--: | :----------------: |
| index | number |  否  | 手指序号（可省略） |
|   x   | number |  是  |     屏幕横坐标     |
|   y   | number |  是  |     屏幕纵坐标     |

*划动*

```lua
--此示例代码所用函数为触动精灵专用函数请勿用于积木编程
--在部分安卓应用程序中的 HTML5 页面中，出现脚本能够点击，但点击没有后续反应的问题并且使用 os.execute 函数也没有效果，可以使用此函数
--在坐标 (150, 550)按下
touchInputDown(150, 550);    
mSleep(30);
--移动到坐标 (150, 600)，注意一次滑动的坐标间隔不要太大，不宜超过 50 像素
touchInputMove(150, 600);    
mSleep(30);
--在坐标 (150, 600) 抬起
touchInputUp(150, 600);
```

## Lua 编程

### 语句块

```lua
do print("Hello") end
```

- 可以在函数和语句块中定义局部变量。

### 赋值语句

```lua
a,b,c,d=1,2,3,4
```

```lua
a,b=b,a --多么方便的交换变量功能啊
```

```lua
local a,b,c = 1,2,3 -- a,b,c 都是局部变量
```

### 循环语句

- while 循环：while 条件 do … end
- repeat 循环：repeat … until 条件
- for 循环：for 变量 = 初值，终点值，步进 do … end
- for 循环：for 变量 1，变量 2，… ，变量 N in表或枚举函数 do … end

**while 循环**

```lua
my_table = {1,2,3}
local index = 1  -- 注意: table 中的索引从 1 开始

while my_table[index] do   -- 只要条件返回 true，就一直执行循环 
print(my_table[index]) 
index = index +1   -- Lua 中没有 i++ 的写法，所以只能用这种写法
end

-- 输出 1
--      2
--      3
```

**repeat 循环(相当于其他语言中的 do…while)**

```lua
local snum = 1 --起始值

repeat
print("snum is "..snum)
snum = snum + 1
until snum == 4   --当 snum 等于 4 时 跳出循环

--输出:
--snum is 1
--snum is 2
--snum is 3
```

**for 循环**

```lua
for i = 1, #my_table do --#my_table 表示取表的长度,上边定义了长度为 3
print(my_table[i])
end
```

```lua
for i=1,10,2 do -- 这里i=1表示起始值, 10 表示最大值, 2 表示步进值(可以没有,默认值为 1,也就是其他语言里的 i++)
print(i)
end
```

### 数值运算

和 C 语言一样，支持+, -, *, /。但 Lua 还多了一个 "^"。这表示指数乘方运算。比如 2^3 结果为 8, 2^4 结果为 16。

连接两个字符串，可以用”..“运处符。如：

```lua
"This a " .. "string." -- 等于 "this a string"
```

### 比较运算

< > <= >= == ~=

分别表示 小于，大于，不大于，不小于，相等，不相等

所有这些操作符总是返回 true 或 false。

对于 Table,Function 和 Userdata 类型的数据，只有 == 和 ~=可以用。相等表示两个变量引用的是同一个数据。比如：

```lua
a={1,2}
b=a
print(a==b, a~=b) -- true, false
a={1,2}
b={1,2}
print(a==b, a~=b) -- false, true
```

### 逻辑运算

and, or, not

在 Lua 中，只有 false 和 nil 才计算为 false，其它任何数据都计算为 true，**0 也是 true**！

and 和 or 的运算结果不是 true 和 false，而是和它的两个操作数相关。

a and b： 如果 a 为 false，则返回 a；否则返回 b

a or b： 如果 a 为 true，则返回 a；否则返回 b

```lua
print(4 and 5) --> 5
print(nil and 13) --> nil
print(false and 13) --> false
print(4 or 5) --> 4
print(false or 5) --> 5
```

可以模拟 C 语言中的语句：

```c
x = a? b : c
```

在 Lua 中，可以写成：

```lua
x = a and b or c
```

最有用的语句是：

```lua
x = x or v
```

它相当于：

```lua
if not x then x = v end
```

### 运算符优先级

从高到低顺序如下：

```lua
^

not - （一元运算）

* /

+ -

..（字符串连接）

< > <= >= ~= ==

and

or
```

### 关键字

关键字是不能做为变量的

```lua
and break do else elseif

end false for function if
        
in local nil not or
        
repeat return then true until　while
```

### 变量类型

可以用 type() 函数来检查

**Nil 空值**

所有没有使用过的变量，都是 nil。nil 既是值，又是类型。

**Boolean 布尔值**

true 或 false

**Number 数值**

在 Lua 里，数值相当于 C 语言的 double

**String 字符串**

如果你愿意的话，字符串是可以包含 '\0' 字符的

**Table 关系表类型**

这个类型功能比较强大

**Function 函数类型**

函数也是一种类型，也就是说，所有的函数，它本身就是一个变量

**Userdata**

这个类型专门用来和 Lua 的宿主打交道的。宿主通常是用 C 和 C++ 来编写的，在这种情况下，Userdata 可以是宿主的任意数据类型，常用的有 Struct 和指针。

**Thread 线程类型**

在 Lua 中没有真正的线程。Lua 中可以将一个函数分成几部份运行

## Lua 常用函数

### 函数：type 判断数据类型

bool = type(str)

| 参数 | 必填 | 说明           |
| :--: | :--: | :------------- |
| str  |  是  | 需要判断的数据 |

| 返回值 | 说明                                                         |
| :----: | :----------------------------------------------------------- |
|  bool  | 数据类型："number"、"string"、"boolean"、"table"、"function"、"thread"、"userdata" |

```lua
num=111
str = tostring(num)
dialog("转换后的内容："..str.."\r\n".."数据类型："..type(str),5)
```

### 函数：require 加载模块

bool = require(modle)

| 参数  |  类型  | 必填 | 说明               |
| :---: | :----: | :--: | :----------------- |
| modle | string |  是  | 需要加载的模块名称 |

| 返回值 | 说明       |
| :----: | :--------- |
|  bool  | 模块返回值 |

```lua
--可以加载 lua 文 件或者 so 模块
--如果要加载 ceshi.lua 文件代码如下
require("ceshi")
--如果要加载 ts.so 文件代码如下
require("ts")
```

### 函数：tonumber 将字符串转成数字

num = tonumber(str, base)

| 参数 |  类型  | 必填 | 说明                          |
| :--: | :----: | :--: | :---------------------------- |
| str  | string |  是  | 需要转换的字符串              |
| base | string |  否  | 原字符进制类型，不写默认为 10 |

| 返回值 |    类型    | 说明         |
| :----: | :--------: | :----------- |
|  num   | number/nil | 转换后的数字 |

```lua
str="111"
num = tonumber(str)
dialog("转换后的内容："..num.."\r\n".."数据类型："..type(num),5)
```

- 当调用 base 时，则 str 应该是一个字符串，该字符串将被解释为该基数中的整数。基数可以是 2 到 36 之间（包括 2 和 36）的任何整数。在 10 以上的基数中，字母 ' A'（大写或小写）代表 10，' B' 代 表 11，依此类推，' Z' 代表 35

### 函数：tostring 将数字转成字符串

str = tostring(num)

| 参数 |  类型  | 必填 | 说明           |
| :--: | :----: | :--: | :------------- |
| num  | number |  是  | 需要转换的数字 |

| 返回值 |    类型    | 说明           |
| :----: | :--------: | :------------- |
|  str   | string/nil | 转换后的字符串 |

```lua
num=111
str = tostring(num)
dialog("转换后的内容："..str.."\r\n".."数据类型："..type(str),5)
```

### 函数：pcall 保护模式调用

**保护执行 function 函数， function 内部发生的错误不会影响脚本运行**

bool,msg = pcall(fun,action,...)

|  参数  |   类型   | 必填 | 说明                            |
| :----: | :------: | :--: | :------------------------------ |
|  fun   | function |  是  | 待调用参数                      |
| action |    -     |  否  | 待传入 fun 的参数，支持多个参数 |

| 返回值 |  类型   | 说明                          |
| :----: | :-----: | :---------------------------- |
|  bool  | boolean | true - 无错误，false - 有错误 |
|  msg   |    -    | 有错误时返回错误信息          |

```lua
bool,msg=pcall(function(i) print(i) error('error..') end,33)
if bool then
    dialog("无错误")
else
    dialog(msg,5)
end
```

### 函数：io.open 按模式打开文件

**以字符串指定的模式打开文件**

file,msg = io.open(filename,mode)

|   参数   |  类型  | 必填 | 说明                     |
| :------: | :----: | :--: | :----------------------- |
| filename | string |  是  | 需要打开的文件路径       |
|   mode   | string |  否  | 打开模式，不写默认为 "r" |

mode 参数介绍

| 参数 | 说明                                               |
| :--: | :------------------------------------------------- |
| "r”  | 读取模式（默认）                                   |
| "w”  | 写模式                                             |
| "a”  | 追加模式                                           |
| "r+" | 更新模式，所有以前的数据都保留                     |
| "w+" | 更新模式，以前的所有数据都被删除                   |
| "a+" | 追加更新模式，保留以前的数据，只允许在文件末尾写入 |
| "b"  | 二进制方式                                         |

| 返回值 |     类型     | 说明                                 |
| :----: | :----------: | :----------------------------------- |
|  file  | userdata/nil | 成功返回打开文件的句柄，失败返回 nil |
|  msg   |    string    | 返回报错信息                         |

```lua
file,msg = io.open("/mnt/sdcard/kazhu.txt")
if file then
    dialog("打开成功",5)
    file:close()
else
    dialog("打开失败，失败原因："..msg,5)
end
```

### 函数：io.type 判断句柄

**判断是否为有效句柄**

bool = io.type(file)

| 参数 |   类型   | 必填 | 说明               |
| :--: | :------: | :--: | :----------------- |
| file | userdata |  是  | 需要判断的文件句柄 |

| 返回值 |  类型  | 说明                                                         |
| :----: | :----: | :----------------------------------------------------------- |
|  bool  | string | “file“ - 一个打开的文件句柄，"closed file“ - 为一个已关闭的文件句柄，nil - 不是文件句柄 |

```lua
file,msg = io.open("/mnt/sdcard/kazhu.txt")
bool = io.type(file)
if bool == "file" then
    dialog("是文件句柄",5)
elseif bool == "closed file" then
    dialog("句柄已关闭",5)
elseif bool == nil then
    dialog("不是文件句柄",5)
end
```

### 函数：io.read 按模式读取文件

file,msg=io.read(format)

|  参数  |  类型  | 必填 | 说明                                     |
| :----: | :----: | :--: | :--------------------------------------- |
| format | string |  否  | 读取格式/读取的字节数，不写默认值 ："*l" |

|  参数  | 说明                                                         |
| :----: | :----------------------------------------------------------- |
|  "*n"  | 读取一个数字                                                 |
| "*a":  | 从当前位置读取整个文件，若为文件尾返回空字串                 |
|  "*l"  | 读取下一行的内容，若为文件尾返回 nil                         |
| number | 读取指定字节数的字符，若为文件尾返回 nil；如果 number 为 0 则返回空字串；若为文件尾，则返回 nil |

| 返回值 |     类型     | 说明                                 |
| :----: | :----------: | :----------------------------------- |
|  file  | userdata/nil | 成功返回打开文件的句柄，失败返回 nil |
|  msg   |    string    | 返回报错信息                         |

```lua
file,msg = io.open("/mnt/sdcard/kazhu.txt")
if file then
    dialog("文件全部内容："..file:read("*a"),5)
    file:close()
else
    dialog("打开失败，失败原因："..msg,5)
end
```

### 函数：io.write 写入到文件

io.write(str)

| 参数 |     类型      | 必填 | 说明           |
| :--: | :-----------: | :--: | :------------- |
| str  | string/number |  是  | 需要写入的内容 |

```lua
file,msg = io.open("/mnt/sdcard/888.txt","r+")
if file then
    file:write("1")
    mSleep(2000)
    dialog(file:read("*n"),5)
    file:close()
else
    dialog("打开失败，失败原因："..msg,5)
end
```

### 函数：io.close 关闭文件句柄

io.close()

```lua
file,msg = io.open("/mnt/sdcard/kazhu.txt")
if file then
    dialog("打开成功",5)
    file:close()
else
    dialog("打开失败，失败原因："..msg,5)
end
```

### 函数：os.date 格式化日期

str = os.date(format,timeout)

|  参数   |  类型  | 必填 | 说明                                 |
| :-----: | :----: | :--: | :----------------------------------- |
| format  | string |  是  | 格式化字符串/格式符                  |
| timeout | string |  否  | 指定格式化的时间, 不写默认为当前时间 |

格式化字符串

| 格式符 |        类型         |             类型             |
| :----: | :-----------------: | :--------------------------: |
|   %a   | 一星期中天数的简写  |            (Fri)             |
|   %A   | 一星期中天数的全称  |         (Wednesday)          |
|   %b   |     月份的简写      |            (Sep)             |
|   %B   |     月份的全称      |            (May)             |
|   %c   |     日期和时间      |     (09/16/98 23:48:10)      |
|   %d   |  一个月中的第几天   |         (28)[0 - 31]         |
|   %H   | 24 小时制中的小时数 |        (18)[00 - 23]         |
|   %I   | 12 小时制中的小时数 |        (10)[01 - 12]         |
|   %j   |   一年中的第几天    |       (209)[01 - 366]        |
|   %M   |       分钟数        |        (48)[00 - 59]         |
|   %m   |       月份数        |        (09)[01 - 12]         |
|   %P   |     上午或下午      |        (pm)[am - pm]         |
|   %S   |   一分钟之内秒数    |        (10)[00 - 59]         |
|   %w   |  一星期中的第几天   | (3)[0 - 6 = 星期天 - 星期六] |
|   %W   | 一年中的第几个星期  |          (2)0 - 52           |
|   %x   |        日期         |          (09/16/98)          |
|   %X   |        时间         |          (23:48:10)          |
|   %y   |    两位数的年份     |        (16)[00 - 99]         |
|   %Y   |     完整的年份      |            (2016)            |
|   %%   |      字符串'%'      |             (%)              |

| 返回值 |     类型     | 说明           |
| :----: | :----------: | :------------- |
|  str   | string/table | 格式化后的时间 |

```lua
--获取当前日期及时间
local nowTime = os.date("*t",os.time()) --返回一个 table
dialog(nowTime.year,5) --年
dialog(nowTime.month,5) --月
dialog(nowTime.day,5) --日
dialog(nowTime.hour,5) --小时
dialog(nowTime.min,5) --分钟
dialog(nowTime.sec,5) --秒钟
dialog(nowTime.yday,5) --显示当前为一年中的第几天
--时间戳格式化当前时间
local nowTime = os.date("%Y-%m-%d %H:%M:%S", os.time())
dialog(nowTime,5)
```

```lua
--获取今天是星期几
local today = tonumber(os.date("%w",os.time()))
if today ==0 then
    dialog("今天是周日",5)
elseif  today ==6 then
    dialog("今天是周六",5)
elseif  today ==1 then
    dialog("今天是周一",5)
elseif  today ==2 then
    dialog("今天是周二",5)
elseif  today ==3 then
    dialog("今天是周三",5)
elseif  today ==4 then
    dialog("今天是周四",5)
elseif  today ==5 then
    dialog("今天是周五",5)
end
```

### 函数：os.time 格式化时间

exampletime = os.time(timeout)

|  参数   | 类型  | 必填 | 说明                                 |
| :-----: | :---: | :--: | :----------------------------------- |
| timeout | table |  否  | 指定格式化的时间, 不写默认为当前时间 |

timeout 参数介绍

| 格式符 |  类型   |      说明      |
| :----: | :-----: | :------------: |
|  hour  | number  |      小时      |
|  min   | number  |      分钟      |
|  wday  | number  |      星期      |
|  day   | number  |      日期      |
| month  | number  |      月份      |
|  year  | number  |       年       |
|  sec   | number  |       秒       |
|  yday  | number  | 一年当中第几天 |
|  isds  | boolean |     夏时令     |

|   返回值    |  类型  | 说明           |
| :---------: | :----: | :------------- |
| exampletime | number | 转换后的时间戳 |

```lua
--获取当前时间的时间戳
local exampletime = os.time();
dialog("转换后的时间戳:"..exampletime)
dialog(os.date("%c",exampletime))
local exampletime = os.time({year=2020,month=12,day=25,hour=8,min=0,sec=0})
dialog("转换后的时间戳:"..exampletime)
dialog(os.date("%c",exampletime))
```

### 函数：os.rename 重命名文件（夹）

bool,msg = os.rename (oldname, newname)

|  参数   |  类型  | 必填 | 说明                   |
| :-----: | :----: | :--: | :--------------------- |
| oldname | string |  是  | 修改前的文件路径及名称 |
| newname | string |  是  | 修改后的文件路径及名称 |

| 返回值 |  类型   | 说明                   |
| :----: | :-----: | :--------------------- |
|  bool  | boolean | 成功 - tue，失败 - nil |
|  msg   | string  | 失败返回的错误信息     |

```lua
bool,msg = os.rename ("/mnt/sdcard/111/","/mnt/sdcard/222/")
if bool then
    dialog("修改成功",5)
else
    dialog("修改失败，失败原因："..msg,5)
end
```

### 函数：os.remove 删除文件

bool,msg = os.remove(filename)

|   参数   |  类型  | 必填 | 说明               |
| :------: | :----: | :--: | :----------------- |
| filename | string | 必填 | 需要删除的文件路径 |

| 返回值 |  类型   | 说明                   |
| :----: | :-----: | :--------------------- |
|  bool  | boolean | 成功 - tue，失败 - nil |
|  msg   | string  | 失败返回的错误信息     |

```lua
bool,msg = os.remove("/mnt/sdcard/111/")
if bool then
    dialog("删除成功",5)
else
    dialog("删除失败，失败原因："..msg,5)
end
```

### 函数：os.execute 执行 shell 命令

os.execute(command)

|  参数   |  类型  | 必填 | 说明                  |
| :-----: | :----: | :--: | :-------------------- |
| command | string |  是  | 需要执行的 shell 命令 |

### 函数：string.find 查找字符串

num1,num2 = string.find(s,pattern,in,plain)

|  参数   |  类型   | 必填 | 说明                                                   |
| :-----: | :-----: | :--: | :----------------------------------------------------- |
|    s    | string  |  是  | 原字符串                                               |
| pattern | string  |  是  | 待查找的字符串或模式匹配                               |
|   in    | number  |  否  | 从第几个字符开始搜索，不写默认为 1                     |
| pllain  | boolean |  否  | 是否搜索纯文本，否即支持模式匹配搜索，不写默认为 false |

| 返回值 |    类型    | 说明                                    |
| :----: | :--------: | :-------------------------------------- |
|  num1  | number/nil | pattern 位于 s 的起点位置，nil 为没找到 |
|  num2  | number/nil | pattern 位于 s 的终点位置,nil 为没找到  |

模式匹配用法

| 参数 |     说明      |
| :--: | :-----------: |
|  .   |   任意字符    |
|  %s  |    空白符     |
|  %p  |   标点字符    |
|  %c  |   控制字符    |
|  %d  |     数字      |
|  %x  | 十六进制数字  |
|  %z  | 代表 0 的字符 |
|  %a  |     字母      |
|  %l  |   小写字母    |
|  %u  |   大写字母    |
|  %w  |  字母和数字   |

```lua
num1,num2 = string.find("bbaaadd","aaa")
if num1~= nil and num2~= nil then
dialog("开始位置："..num1.."\r\n".."结束位置："..num2,5)
else
    dialog("未找到")
end
```

### 函数：string.format 格式化字符串

**将字符串进行格式化，返回一个类似 printf 的格式化字符串**

st = string.find(str,arg)

| 参数 |  类型  | 必填 | 说明                                                         |
| :--: | :----: | :--: | :----------------------------------------------------------- |
| str  | string |  是  | 待格式化的字符串/模式匹配                                    |
| arg  |   -    |  是  | 任意内容，需要与 str 模式匹配支持的类型（number/string）相同 |

模式匹配用法

|  参数  | 类型                                                         |
| :----: | :----------------------------------------------------------- |
|   %c   | 接收一个数字, 并将其转化为 ASCII 码表中对应的字符            |
| %d、%i | 接收一个数字并将其转化为有符号的整数格式                     |
|   %o   | 接收一个数字并将其转化为八进制数格式                         |
|   %u   | 接收一个数字并将其转化为无符号整数格式                       |
|   %x   | 接收一个数字并将其转化为十六进制数格式, 使用小写字母         |
|   %X   | 接收一个数字并将其转化为十六进制数格式, 使用大写字母         |
|   %e   | 接收一个数字并将其转化为科学记数法格式, 使用小写字母 e       |
|   %E   | 接收一个数字并将其转化为科学记数法格式, 使用大写字母 E       |
|   %f   | 接收一个数字并将其转化为浮点数格式                           |
| %g(%G) | 接收一个数字并将其转化为 %e(%E 对应 %G)及 %f 中较短的一种格式 |
|   %q   | 接收一个字符串并将其转化为可安全被 Lua 编译器读入的格式      |
|   %s   | 接收一个字符串并按照给定的参数格式化该字符串                 |

| 返回值 |    类型    | 说明             |
| :----: | :--------: | :--------------- |
|   st   | string/nil | 格式化后的字符串 |

```lua
st = string.format("just do %s","it")
dialog(st,5)
```

### 函数：string.gmatch 全局模式匹配

**创建并返回一个迭代器，可用于 for 语句中迭代的进行全局查找**

str = string.match(s,pattern)

|  参数   |  类型  | 必填 | 说明                     |
| :-----: | :----: | :--: | :----------------------- |
|    s    | string |  是  | 原字符串                 |
| pattern | string |  是  | 待查找的字符串或模式匹配 |

| 返回值 |    类型    | 说明                           |
| :----: | :--------: | :----------------------------- |
|  str   | string/nil | 格式化后的字符串，nil 为没找到 |

| 参数 |     说明      |
| :--: | :-----------: |
|  .   |   任意字符    |
|  %s  |    空白符     |
|  %p  |   标点字符    |
|  %c  |   控制字符    |
|  %d  |     数字      |
|  %x  | 十六进制数字  |
|  %z  | 代表 0 的字符 |
|  %a  |     字母      |
|  %l  |   小写字母    |
|  %u  |   大写字母    |
|  %w  |  字母和数字   |

```lua
s = "a1 B c d"
for w in string.gmatch(s, "%l+") do
    dialog(w,5)
end
```

### 函数：string.gsub 字符串替换

str,num = string.gsub(s,pattern,repl,n)

|  参数   |        类型         | 必填 | 说明                     |
| :-----: | :-----------------: | :--: | :----------------------- |
|    s    | string/table/number |  是  | 原字符串                 |
| pattern | string/table/number |  是  | 待查找的字符串或模式匹配 |
|  repl   | string/table/number |  是  | 待替换的字符串           |
|    n    |       number        |  否  | 替换次数                 |

| 参数 |     说明      |
| :--: | :-----------: |
|  .   |   任意字符    |
|  %s  |    空白符     |
|  %p  |   标点字符    |
|  %c  |   控制字符    |
|  %d  |     数字      |
|  %x  | 十六进制数字  |
|  %z  | 代表 0 的字符 |
|  %a  |     字母      |
|  %l  |   小写字母    |
|  %u  |   大写字母    |
|  %w  |  字母和数字   |

| 返回值 |       类型        | 说明         |
| :----: | :---------------: | :----------- |
|  str   | string/number/nil | 替换后的内容 |
|  num   |      number       | 替换次数     |

```lua
str,num=string.gsub("juaa do it","aa","st")
dialog("替换后的内容："..str.."\r\n".."替换次数："..num,5)
```

### 函数：string.len 获取字符串长度

num = string.len(str)

| 参数 |  类型  | 必填 | 说明             |
| :--: | :----: | :--: | :--------------- |
| str  | string |  是  | 需要计算的字符串 |

| 返回值 |    类型    | 说明       |
| :----: | :--------: | :--------- |
|  num   | number/nil | 字符串长度 |

```lua
str="JUST DO IT"
num = string.len(str)
dialog("字符串长度："..num)
```

### 函数：string.match 字符串查找

str = string.match(s,pattern,in)

|  参数   |  类型  | 必填 | 说明                                      |
| :-----: | :----: | :--: | :---------------------------------------- |
|    s    | string |  是  | 原字符串                                  |
| pattern | string |  是  | 待查找的字符串或模式匹配                  |
|   in    | string |  否  | 从 s 的第 in 个字符开始搜索，不写默认为 1 |

| 返回值 |  类型  | 说明                                     |
| :----: | :----: | :--------------------------------------- |
|  str   | string | 找到结果返回整个配对字符串，失败返回 nil |

| 参数 |     说明      |
| :--: | :-----------: |
|  .   |   任意字符    |
|  %s  |    空白符     |
|  %p  |   标点字符    |
|  %c  |   控制字符    |
|  %d  |     数字      |
|  %x  | 十六进制数字  |
|  %z  | 代表 0 的字符 |
|  %a  |     字母      |
|  %l  |   小写字母    |
|  %u  |   大写字母    |
|  %w  |  字母和数字   |

```lua
s = "您申请了邮箱注册，验证码为：123abc，两分钟内有效。请在注册页面中输入以完成注册。"
str = string.match(s,"%w+")
dialog(str)
```

### 函数：string.rep 复制字符串

str = string.rep(s,n,sep)

| 参数 |  类型  | 必填 | 说明                   |
| :--: | :----: | :--: | :--------------------- |
|  s   | string |  是  | 原字符串               |
|  n   | number |  是  | 复制次数               |
| sep  | string |  否  | 间隔依据，不写默认为空 |

| 返回值 |  类型  | 说明           |
| :----: | :----: | :------------- |
|  str   | string | 复制后的字符串 |

```lua
s = "go"
str = string.rep(s,3," ")
dialog(str,5)
```

### 函数：string.reverse 字符串反转

str2 = string.reverse(str1)

| 参数 |  类型  | 必填 | 说明           |
| :--: | :----: | :--: | :------------- |
| str1 | string |  是  | 需要转换的内容 |

| 返回值 |  类型  | 说明         |
| :----: | :----: | :----------- |
|  str2  | string | 转换后的内容 |

```lua
str1 = "ti od tsuj"
str2 = string.reverse(str1)
dialog("转换后内容："..str2,5)
```

### 函数：string.sub 字符串截取

str = string.sub(s,i,j)

| 参数 |  类型  | 必填 | 说明                       |
| :--: | :----: | :--: | :------------------------- |
|  s   | string |  是  | 待截取的字符串             |
|  i   | number |  是  | 开始截取位置               |
|  j   | string |  否  | 停止截取位置，不写默认为 i |

| 返回值 |  类型  | 说明         |
| :----: | :----: | :----------- |
|  str   | string | 截取的字符串 |

```lua
s="just do it"
str = string.sub(s,6,7)
dialog("截取的内容："..str,5)
```

### 函数：string.upper 小写字母转大写

str2 = string.upper(str1)

| 参数 |  类型  | 必填 | 说明           |
| :--: | :----: | :--: | :------------- |
| str1 | string |  是  | 需要转换的内容 |

| 返回值 |  类型  | 说明         |
| :----: | :----: | :----------- |
|  str2  | string | 转换后的内容 |

```lua
str1 = "just do it"
str2 = string.upper(str1)
dialog("转换后的大写字母内容："..str2,5)
```

### 函数：string.lower 大写字母转成小写

str2 = string.lower(str1)

| 参数 |  类型  | 必填 | 说明           |
| :--: | :----: | :--: | :------------- |
| str1 | string |  是  | 需要转换的内容 |

| 返回值 |  类型  | 说明               |
| :----: | :----: | :----------------- |
|  str2  | string | 转换成大写后的内容 |

```lua
str1 = "JUST DO IT"
str2 = string.lower(str1)
dialog("转换后的内容："..str2,5)
```

### 函数：string.byte 字符串转 ASCII 编码

num1,num2,num3,.. = string.byte(str.i,j)

| 参数 |  类型  | 必填 | 说明                     |
| :--: | :----: | :--: | :----------------------- |
| str  | string |  是  | 需要进行编码的字符串     |
|  i   | number |  是  | 截取起点，不写默认值为 1 |
|  j   | number |  是  | 截取终点，不写默认值为 i |

| 返回值 |    类型    | 说明           |
| :----: | :--------: | :------------- |
|  num   | number/nil | 编码后的字符串 |

```lua
num1,num2,num3=string.byte("ceshi",1,3)
dialog(num1.."\r\n"..num2.."\r\n"..num3,5)
```

### 函数：string.char ASCII 编码转字符串

str = string.char(num1,num2,num3,..)

| 参数 |  类型  | 必填 | 说明                                      |
| :--: | :----: | :--: | :---------------------------------------- |
| num  | number |  是  | 需要进行操作的 ASCII 编码，可以是多个数据 |

| 返回值 |    类型    | 说明           |
| :----: | :--------: | :------------- |
|  num   | number/nil | 转码后的字符串 |

```lua
num1,num2,num3 = string.byte("ceshi",1,3)
dialog(num1.."\r\n"..num2.."\r\n"..num3,5)
mSleep(1000)
str = string.char(num1,num2,num3)
dialog(str,5)
```

### 函数：table.concat 数组连接

str = table.concat (tb,sep,i, j)

| 参数 |  类型  | 必填 | 说明                         |
| :--: | :----: | :--: | :--------------------------- |
|  tb  | table  |  是  | 待操作数组                   |
| sep  | string |  是  | 分割的字符                   |
|  i   | number |  否  | tb[i] 起点，不写默认值为 1   |
|  j   | number |  否  | tb[j] 终点，不写默认值为 #tb |

| 返回值 |  类型  | 说明           |
| :----: | :----: | :------------- |
|  str   | string | 连接后的字符串 |

```lua
tb = {"a","b","c","d",1,2,3,4}
str = table.concat(tb,"|")
dialog(str,5)
```

### 函数：table.insert 插入数据到数组

table.insert (tab_table, pos,value)

|   参数    |  类型  | 必填 | 说明                                |
| :-------: | :----: | :--: | :---------------------------------- |
| tab_table | string |  是  | 待操作的数组                        |
|    pos    | number |  否  | 待插入位置，不写默认值为 #tab_table |
|   value   | value  |  否  | 待插入的内容                        |

```lua
tab_table = {1,2,3,4,5,6,7,8,9,10}
table.insert(tab_table,11)
dialog(tab_table[11],5)
```

## 基本函数

### 函数：init 坐标初始化

**脚本运行前必须调用，以设置设备方向及坐标系**

init(rotate);

|  参数  |  类型  | 必填 | 说明                                                         |
| :----: | :----: | :--: | :----------------------------------------------------------- |
| rotate | number |  是  | 屏幕方向，0 - Home 键在底部，1 - Home 键在右侧，2 - Home 键在左侧 |

```lua
init(0)     
-- iOS 设备以 Home 键在下方时的屏幕左上角为坐标系原点(0,0)，iOS 7 以上系统有效；
--安卓设备以当前屏幕默认截图方向进行初始化
```

```lua
init(1);    
--iOS 设备以当前应用 Home 键在右边初始化，即以 Home 键在右侧时的横屏左上角为屏幕坐标原点(0,0)
--安卓设备以屏幕默认截图方向向左旋转 90° 进行初始化
```

```lua
init(2);
--iOS 设备以当前应用 Home 键在左边初始化，即以 Home 键在左侧时的横屏左上角为屏幕坐标原点(0,0)
--安卓设备以屏幕默认截图方向向右旋转 90° 进行初始化
```

- 安卓系统不同设备初始的截图方向有所不同，使用安卓手机尤其是模拟器编写脚本前请用截图函数确认设备的默认方向。

- 此函数可在脚本运行过程中多次调用以改变屏幕方向。

- 如在脚本中未指定屏幕方向，系统将默认为竖屏为初始方向。
- 安卓设备根据机型初始方向有区别，需要开发者自行调试，0 - 初始方向，1 - 初始方向向左旋转 90°，2 初始方向向右旋转 90°。

- init 方向不受是否锁屏影响。

- Bundle ID 的获取方法

- 在触动精灵客户端的 **更多/我的账号 -> 应用 ID 查询** 中能查看到应用程序的 Bundle ID。
- iOS 使用 iFile、PP 助手等软件可查看应用文件夹下的 Info.plist，其中的 CFBundleIdentifier 即为该应用的 Bundle ID。

- 使用 frontAppBid 函数，前台运行要获取 Bundle ID 的应用，运行此函数并用 diolag、toast、nLog 函数显示返回值。

### 函数：mSleep 延时

mSleep(interval)

|   参数   |  类型  | 必填 | 说明                               |
| :------: | :----: | :--: | :--------------------------------- |
| interval | number |  是  | 单位为毫秒，脚本暂停执行的时间长度 |

*延迟 1 秒和 1 分钟*

```lua
mSleep(1000);       --延迟 1 秒钟
mSleep(60*1000)   --此函数不适合用于长时间的精确计时，如长时间的精确计时请使用 os.time
```

*按住 3 秒不松手*

```lua
touchDown(200,300);    --按下
mSleep(3000);            --延迟 3 秒
touchUp(200,300);      --抬起
```

- 延迟函数的使用与各类函数的使用息息相关，尤其是触摸类函数。脚本一般是用来模拟人在界面上的操作，因此要考虑人在各种情况下的延迟、界面加载时的响应时间。
- 延迟间隔不可过短，当 interval <= 50 ms 时，延迟精确度大幅下降，当 interval <= 16 ms 时，实际延迟约在 16 ms左右。
- 请勿将此函数用于长时间的精确计时。
- 1 秒 (s) = 1000 毫秒 (ms)。

## 文本输入

### 函数：inputText 输入字符串

inputText(str,kind)

| 参数 |  类型  | 必填 | 说明                                                         |
| :--: | :----: | :--: | :----------------------------------------------------------- |
| str  | string |  是  | 将输入的文本以及控制字符                                     |
| kind | number |  否  | 不写或者参数为 0 为复制粘贴的输入方式； 1 - 调用 iOS 触动输入法， 仅支持引擎版本 iOS v3.0.3 及其以上版本 2 - 通过模拟蓝牙键盘进行输入符号、字母和数字， 仅支持引擎版本 iOSv3.0.9 及以上版本 |

*输入欢迎文本并发送*

```lua
--此函数为触动精灵专用函数请勿用于积木编程
--点击输入框获取焦点（假设输入框坐标已知）
touchDown(150,150);       
mSleep(30)
touchUp(150,150);
--延迟 1 秒以便获取焦点，注意某些应用不获取焦点无法输入
mSleep(1000);             
for var = 1,15 do
    --删除输入框中的文字（假设输入框中已存在文字）
    inputText("\b")
    --iOS 设备连续输入建议加下延时时间，否则可能因为速度太快导致输入错误
    mSleep(20)
end
--在输入框中输入字符串 "Welcome." 并回车；此函数在某些应用中无效，如支付宝、密码输入框等位置，甚至可能会导致目标应用闪退
inputText("Welcome.#ENTER#");
```

*切换到触动 iOS 输入法进行输入*

```
require("TSLib")
local m = TSVersions()
if m < "1.2.8" then
    dialog("请使用 v1.2.8 及其以上版本 TSLib")
end
--此函数仅支持 v1.2.8 及其以上版本 TSLib
local bool = switchInputText()
mSleep(20)
if bool then
    inputText("123",1)
else
    dialog("切换失败")
end
```

### 函数：inputStr 输入字符串（仅支持 iOS）

inputStr(text);

| 参数 |  类型  | 必填 |     说明     |
| :--: | :----: | :--: | :----------: |
| text | string |  是  | 要输入的文本 |

```lua
--输入欢迎文本
--此函数为触动精灵专用函数请勿用于积木编程
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
inputStr("Welcome"); --在输入框中输入字符串 "Welcome"，此函数仅适用于 iOS 系统
```

### 函数：switchTSInputMethod 切换到触动输入法（仅支持 Android）

switchTSInputMethod(flag)

| 参数 |  类型   | 必填 | 说明                                                         |
| :--: | :-----: | :--: | :----------------------------------------------------------- |
| flag | boolean |  是  | 保持开关，true - 切换到触动输入法，false - 切换回之前的输入法 |

```lua
-- 需要多次输入的登录模块
-- 此函数为触动精灵专用函数请勿用于积木编程
function login(...)
    switchTSInputMethod(true);   -- 切换到触动输入法
    -- 点击输入框获取焦点
    touchDown(x, y)
    mSleep(30)
    touchUp(x, y)
    inputText("username")
    -- 点击输入框获取焦点
    touchDown(x, y)
    mSleep(30)
    touchUp(x, y)
    inputText("password")
    switchTSInputMethod(false);  -- 切换到之前的输入法
end
-- 不需要 inputText 输入的其他逻辑模块
function main(...)
    login()
end
main()
```

### 函数：switchInputText 切换输入法到触动 iOS 输入法（iOS）

bool = switchInputText()

| 返回值 |  类型   | 说明                                                         |
| :----- | :-----: | :----------------------------------------------------------- |
| bool   | boolean | 切换触动输入法是否成功， true - 切换成功， false - 切换失败（未安装输入法/未将触动输入法添加到键盘/未切换到触动输入法） |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require("TSLib")
local m = TSVersions()
if m < "1.2.8" then
    dialog("请使用 v1.2.8 及其以上版本 TSLib")
end
local bool = switchInputText()
mSleep(20)
if bool then
    inputText("123",1)
else
    dialog("切换失败")
end
```

### 函数：getInPutMethod 获取当前输入法包名（仅支持 Android）

bid = getInPutMethod()

| 返回值 |  类型  | 说明                 |
| :----: | :----: | :------------------- |
|  bid   | string | 用于切换输入法的包名 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
--频繁输入字符的脚本
-- 脚本启动,获取输入法包名
ipm = getInPutMethod()  
-- 切换到触动输入法
os.execute("settings put secure default_input_method com.touchsprite.android/.core.TSInputMethod")  
-- 脚本主体
-- 结束脚本前切换回之前的输入法
os.execute("settings put secure default_input_method "..ipm)
```

### 函数：keyDown、keyUp 模拟键盘（仅支持 iOS）

keyDown(key);

keyUp(key);

| 参数 |  类型  | 必填 |         说明         |
| :--: | :----: | :--: | :------------------: |
| key  | string |  是  | 模拟外接键盘的键盘码 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
--以下为全选示例
keyDown("RightGUI") 
keyDown("a")
keyUp("a")
keyUp("RightGUI")

--以下为复制示例
keyDown("RightGUI") 
keyDown("c")
keyUp("c")
keyUp("RightGUI")

--以下为粘贴示例
keyDown("RightGUI") 
keyDown("v")
keyUp("v")
keyUp("RightGUI")

--以下为输入小写字母（t）
keyDown("t")
keyUp("t")

--以下为输入大写字母（T）
keyDown("CapsLock")
keyUp("CapsLock")
keyDown("t")
keyUp("t")

--以下为输入大写字母（T）然后输入小写字母（t）
keyDown("CapsLock")
keyUp("CapsLock")
keyDown("t")
keyUp("t")
keyDown("CapsLock")
keyUp("CapsLock")
keyDown("t")
keyUp("t")

--以下为输入大写字母（T）
--iOS13 以上系统可以使用此方法输入大写字母
keyDown("LeftShift")
keyDown("t")
keyUp("t")
keyUp("LeftShift")

--以下为输入大写字母（T）然后输入小写字母（t）
--iOS13 以上系统可以使用此方法输入大写字母
keyDown("LeftShift")
keyDown("t")
keyUp("t")
keyUp("LeftShift")
keyDown("t")
keyUp("t")

--以下为输入数字（1）
keyDown("1")
keyUp("1")

--以下为输入符号（!）
keyDown("LeftShift")
keyDown("1")
keyUp("1")
keyUp("LeftShift")

--以下为删除
keyDown("DeleteOrBackspace")
keyUp("DeleteOrBackspace")   

--以下为清空输入内容
keyDown("Clear")
keyUp("Clear") 

--以下为回车
key = "ReturnOrEnter"
keyDown(key)
keyUp(key)
```

**按键码表[字母]**

| 按键码 |  说明  |
| :----: | :----: |
|  "a"   | a or A |
|  "b"   | b or B |
|  "c"   | c or C |
|  "d"   | d or D |
|  "e"   | e or E |
|  "f"   | f or F |
|  "g"   | g or G |
|  "h"   | h or H |
|  "i"   | i or I |
|  "j"   | j or J |
|  "k"   | k or K |
|  "l"   | l or L |
|  "m"   | m or M |
|  "n"   | n or N |
|  "o"   | o or O |
|  "p"   | p or P |
|  "q"   | q or Q |
|  "r"   | r or R |
|  "s"   | s or S |
|  "t"   | t or T |
|  "u"   | u or U |
|  "v"   | v or V |
|  "w"   | w or W |
|  "x"   | x or X |
|  "y"   | y or Y |
|  "z"   | z or Z |

**按键码表[数字]**

| 按键码 |  说明  |
| :----: | :----: |
|  "0"   | 0 or ) |
|  "1"   | 1 or ! |
|  "2"   | 2 or @ |
|  "3"   | 3 or # |
|  "4"   | 4 or $ |
|  "5"   | 5 or % |
|  "6"   | 6 or ^ |
|  "7"   | 7 or & |
|  "8"   | 8 or * |
|  "9"   | 9 or ( |

**按键码表[其他]**

|        按键码         |           说明           |
| :-------------------: | :----------------------: |
|       "Hyphen"        |         `- or _`         |
|      "EqualSign"      |         `= or +`         |
|     "OpenBracket"     |         `[ or {`         |
|    "CloseBracket"     |         `] or }`         |
|      "Backslash"      |         `\ or l`         |
|     "NonUSPound"      |     `Non-US # or _`      |
|      "Semicolon"      |         `; or :`         |
|        "Quote"        |         `' or "`         |
| "GraveAccentAndTilde" | `Grave Accent and Tilde` |
|        "Comma"        |         `, or <`         |
|       "Period"        |         `. or >`         |
|        "Slash"        |         `/ or ?`         |

按键码表[更多请自行尝试]

|       按键码        |             说明             |
| :-----------------: | :--------------------------: |
|   "ReturnOrEnter"   |        Return (Enter)        |
|      "Escape"       |            Escape            |
| "DeleteOrBackspace" |      Delete (Backspace)      |
|        "Tab"        |             Tab              |
|     "Spacebar"      |           Spacebar           |
|     "CapsLock"      |          Caps Lock           |
|        "F1"         |              F1              |
|        "F2"         |              F2              |
|        "F3"         |              F3              |
|        "F4"         |              F4              |
|        "F5"         |              F5              |
|        "F6"         |              F6              |
|        "F7"         |              F7              |
|        "F8"         |              F8              |
|        "F9"         |              F9              |
|        "F10"        |             F10              |
|        "F11"        |             F11              |
|        "F12"        |             F12              |
|    "PrintScreen"    |         Print Screen         |
|    "ScrollLock"     |         Scroll Lock          |
|       "Pause"       |            Pause             |
|      "Insert"       |            Insert            |
|       "Home"        |             Home             |
|      "PageUp"       |           Page Up            |
|   "DeleteForward"   |        Delete Forward        |
|        "End"        |             End              |
|     "PageDown"      |          Page Down           |
|    "RightArrow"     |         Right Arrow          |
|     "LeftArrow"     |          Left Arrow          |
|     "DownArrow"     |          Down Arrow          |
|      "UpArrow"      |           Up Arrow           |
|   "KeypadNumLock"   |   Keypad NumLock or Clear    |
|    "KeypadSlash"    |           Keypad /           |
|  "KeypadAsterisk"   |           Keypad *           |
|   "KeypadHyphen"    |           Keypad -           |
|    "KeypadPlus"     |           Keypad +           |
|    "KeypadEnter"    |         Keypad Enter         |
|      "Keypad1"      |       Keypad 1 or End        |
|      "Keypad2"      |    Keypad 2 or Down Arrow    |
|      "Keypad3"      |    Keypad 3 or Page Down     |
|      "Keypad4"      |    Keypad 4 or Left Arrow    |
|      "Keypad5"      |           Keypad 5           |
|      "Keypad6"      |   Keypad 6 or Right Arrow    |
|      "Keypad7"      |       Keypad 7 or Home       |
|      "Keypad8"      |     Keypad 8 or Up Arrow     |
|      "Keypad9"      |     Keypad 9 or Page Up      |
|      "Keypad0"      |      Keypad 0 or Insert      |
|   "KeypadPeriod"    |      Keypad . or Delete      |
|  "NonUSBackslash"   |         Non-US \ or          |
|    "Application"    |         Application          |
|       "Power"       |            Power             |
|     "EqualSign"     |           Keypad =           |
|        "F13"        |             F13              |
|        "F14"        |             F14              |
|        "F15"        |             F15              |
|        "F16"        |             F16              |
|        "F17"        |             F17              |
|        "F19"        |             F19              |
|        "F20"        |             F20              |
|        "F21"        |             F21              |
|        "F22"        |             F22              |
|        "F23"        |             F23              |
|        "F24"        |             F24              |
|      "Execute"      |           Execute            |
|       "Help"        |             Help             |
|       "Menu"        |             Menu             |
|      "Select"       |            Select            |
|       "Stop"        |             Stop             |
|       "Again"       |            Again             |
|       "Undo"        |             Undo             |
|        "Cut"        |             Cut              |
|       "Copy"        |             Copy             |
|       "Paste"       |            Paste             |
|       "Find"        |             Find             |
|       "Mute"        |             Mute             |
|     "VolumeUp"      |          Volume Up           |
|    "VolumeDown"     |         Volume Down          |
|  "LockingCapsLock"  |      Locking Caps Lock       |
|  "LockingNumLock"   |       Locking Num Lock       |
| "LockingScrollLock" |     Locking Scroll Lock      |
|       "Comma"       |         Keypad Comma         |
|  "EqualSignAS400"   | Keypad Equal Sign for AS/400 |
|  "International1"   |        International1        |
|  "International2"   |        International2        |
|  "International3"   |        International3        |
|  "International4"   |        International4        |
|  "International5"   |        International5        |
|  "International6"   |        International6        |
|  "International7"   |        International7        |
|  "International8"   |        International8        |
|  "International9"   |        International9        |
|       "LANG1"       |            LANG1             |
|       "LANG2"       |            LANG2             |
|       "LANG3"       |            LANG3             |
|       "LANG4"       |            LANG4             |
|       "LANG5"       |            LANG5             |
|       "LANG6"       |            LANG6             |
|       "LANG7"       |            LANG7             |
|       "LANG8"       |            LANG8             |
|       "LANG9"       |            LANG9             |
|  "AlternateErase"   |        AlternateErase        |
| "SysReqOrAttention" |       SysReq/Attention       |
|      "Cancel"       |            Cancel            |
|       "Clear"       |            Clear             |
|       "Prior"       |            Prior             |
|      "Return"       |            Return            |
|     "Separator"     |          Separator           |
|        "Out"        |             Out              |
|       "Oper"        |             Oper             |
|   "ClearOrAgain"    |         Clear/Again          |
|   "CrSelOrProps"    |         CrSel/Props          |
|       "ExSel"       |            ExSel             |
|    "LeftControl"    |         Left Control         |
|     "LeftShift"     |          Left Shift          |
|      "LeftAlt"      |           Left Alt           |
|      "LeftGUI"      |           Left GUI           |
|   "RightControl"    |        Right Control         |
|    "RightShift"     |         Right Shift          |
|     "RightAlt"      |          Right Alt           |
|     "RightGUI"      |          Right GUI           |
|   "ErrorRollOver"   |        ErrorRollOver         |
|     "POSTFail"      |           POSTFail           |
|  "ErrorUndefined"   |        ErrorUndefine         |

### 函数：inputKey 输入按键码（仅支持 iOS）

inputKey（str,time_min,time_max）

|   参数   |  类型  | 必填 | 说明                     |
| :------: | :----: | :--: | :----------------------- |
|   str    | string |  是  | 需要输入的字符串         |
| time_min | number |  否  | 最小时间间隔，单位：毫秒 |
| time_max | number |  否  | 最大时间间隔，单位：毫秒 |

- time_min、time_max 参数都不写默认输入字符之间延时时间为 10 毫秒；
- 只写 time_min 参数则延时时间默认为 time_min 的参数；
- time_min、time_max 参数都存在则在 time_min ~ time_max 之间随机延时时间。

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require("TSLib")
--延时时间默认是 10 毫秒。
inputKey("123")
--延时时间默认是 15 毫秒。
--inputKey("123",15)
--延时时间为 15 ~ 20 毫秒之间。
--inputKey("123",15,20)
```

### 安卓模拟物理按键（仅支持 Android）

- 当 inputText 函数在某些输入框内无效时可尝试使用此函数输入字符。
- 推荐使用键名，不同的手机的键值不同会导致此函数无效。
- 在安卓某些 HTML 页面，使用 inputText 函数输入无效，可尝试使用模拟物理按键。

#### Android 按键类编码

**电话功能按键**

|         键名         |     描述     | 键值 |
| :------------------: | :----------: | :--: |
|     KEYCODE_HOME     |  按键 Home   |  3   |
|     KEYCODE_BACK     |    返回键    |  4   |
|     KEYCODE_CALL     |    拨号键    |  5   |
|   KEYCODE_ENDCALL    |    挂机键    |  6   |
|  KEYCODE_VOLUME_UP   |  音量增加键  |  24  |
| KEYCODE_VOLUME_DOWN  |  音量减小键  |  25  |
|    KEYCODE_POWER     |    电源键    |  26  |
|    KEYCODE_CAMERA    |    拍照键    |  27  |
|    KEYCODE_FOCUS     |  拍照对焦键  |  80  |
|     KEYCODE_MENU     |    菜单键    |  82  |
| KEYCODE_NOTIFICATION |    通知键    |  83  |
|    KEYCODE_SEARCH    |    搜索键    |  84  |
|     KEYCODE_MUTE     |  话筒静音键  |  91  |
| KEYCODE_VOLUME_MUTE  | 扬声器静音键 | 164  |

**控制类按键**

|        键名         |       描述       | 键值 |
| :-----------------: | :--------------: | :--: |
|   KEYCODE_DPAD_UP   |   导航键 向上    |  19  |
|  KEYCODE_DPAD_DOWN  |   导航键 向下    |  20  |
|  KEYCODE_DPAD_LEFT  |   导航键 向左    |  21  |
| KEYCODE_DPAD_RIGHT  |   导航键 向右    |  22  |
| KEYCODE_DPAD_CENTER |  导航键 确定键   |  23  |
|     KEYCODE_TAB     |      Tab 键      |  61  |
|    KEYCODE_ENTER    |      回车键      |  66  |
|     KEYCODE_DEL     |      退格键      |  67  |
|   KEYCODE_PAGE_UP   |    向上翻页键    |  92  |
|  KEYCODE_PAGE_DOWN  |    向下翻页键    |  93  |
|   KEYCODE_ESCAPE    |      ESC 键      | 111  |
| KEYCODE_FORWARD_DEL |      删除键      | 112  |
|  KEYCODE_CAPS_LOCK  |    大写锁定键    | 115  |
| KEYCODE_SCROLL_LOCK |    滚动锁定键    | 116  |
|    KEYCODE_BREAK    |  Break/Pause 键  | 121  |
|  KEYCODE_MOVE_HOME  | 光标移动到开始键 | 122  |
|  KEYCODE_MOVE_END   | 光标移动到末尾键 | 123  |
|   KEYCODE_INSERT    |      插入键      | 124  |
|  KEYCODE_NUM_LOCK   |     小键盘锁     | 143  |
|   KEYCODE_ZOOM_IN   |      放大键      | 168  |
|  KEYCODE_ZOOM_OUT   |      缩小键      | 169  |

**基本类按键**

|     键名      |  描述   | 键值 |
| :-----------: | :-----: | :--: |
|   KEYCODE_0   | 按键'0' |  7   |
|   KEYCODE_1   | 按键'1' |  8   |
|   KEYCODE_2   | 按键'2' |  9   |
|   KEYCODE_3   | 按键'3' |  10  |
|   KEYCODE_4   | 按键'4' |  11  |
|   KEYCODE_5   | 按键'5' |  12  |
|   KEYCODE_6   | 按键'6' |  13  |
|   KEYCODE_7   | 按键'7' |  14  |
|   KEYCODE_8   | 按键'8' |  15  |
|   KEYCODE_9   | 按键'9' |  16  |
|   KEYCODE_A   | 按键'A' |  29  |
|   KEYCODE_B   | 按键'B' |  30  |
|   KEYCODE_C   | 按键'C' |  31  |
|   KEYCODE_D   | 按键'D' |  32  |
|   KEYCODE_E   | 按键'E' |  33  |
|   KEYCODE_F   | 按键'F' |  34  |
|   KEYCODE_G   | 按键'G' |  35  |
|   KEYCODE_H   | 按键'H' |  36  |
|   KEYCODE_I   | 按键'I' |  37  |
|   KEYCODE_J   | 按键'J' |  38  |
|   KEYCODE_K   | 按键'K' |  39  |
|   KEYCODE_L   | 按键'L' |  40  |
|   KEYCODE_M   | 按键'M' |  41  |
|   KEYCODE_N   | 按键'N' |  42  |
|   KEYCODE_O   | 按键'O' |  43  |
|   KEYCODE_P   | 按键'P' |  44  |
|   KEYCODE_Q   | 按键'Q' |  45  |
|   KEYCODE_R   | 按键'R' |  46  |
|   KEYCODE_S   | 按键'S' |  47  |
|   KEYCODE_T   | 按键'T' |  48  |
|   KEYCODE_U   | 按键'U' |  49  |
|   KEYCODE_V   | 按键'V' |  50  |
|   KEYCODE_W   | 按键'W' |  51  |
|   KEYCODE_X   | 按键'X' |  52  |
|   KEYCODE_Y   | 按键'Y' |  53  |
|   KEYCODE_Z   | 按键'Z' |  54  |
| KEYCODE_SPACE | 空格键  |  无  |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
os.execute("input keyevent 键名")

--按下 Home 键
os.execute("input keyevent KEYCODE_HOME")

--删除
os.execute("input keyevent KEYCODE_FORWARD_DEL")

--按下返回键
os.execute("input keyevent KEYCODE_BACK")

--按下回车键
os.execute("input keyevent KEYCODE_ENTER")

--按下菜单键
os.execute("input keyevent KEYCODE_MENU")

--按下音量加键
os.execute("input keyevent KEYCODE_VOLUME_UP")

--按下音量减键
os.execute("input keyevent KEYCODE_VOLUME_DOWN")

--输入 10086
os.execute("input text \"10086\"")   

--输入 10086
kt = "10086"
os.execute("input text "..kt)
```

## 坐标与图色

### 函数：getColor 获取屏幕某点颜色值

color = getColor(x, y)

| 参数 |  类型  | 必填 | 说明                     |
| :--: | :----: | :--: | :----------------------- |
|  x   | number |  是  | 将获取颜色值的屏幕横坐标 |
|  y   | number |  是  | 将获取颜色值的屏幕纵坐标 |

| 返回值 |  类型  | 说明                   |
| :----: | :----: | :--------------------- |
| color  | number | 该点的十进制颜色值 RGB |

```lua
color = getColor(100, 100)
--将 color 转换成十六进制颜色值
dialog(string.format("100,100 颜色值为:0x%X",color))
```

*如果某点符合某颜色则点击*

```lua
color = getColor(100, 100);    --获取(100,100)的颜色值，赋值给 color 变量
if color == 0xffffff then      --如果该点的颜色值等于 0xffffff
    touchDown(100, 100);    --那么点击该点
    mSleep(30);
    touchUp(100, 100);
end
```

*亦可写作*

```lua
if getColor(100, 100) == 0xffffff then 
   touchDown(100, 100);
   mSleep(30);
   touchUp(100, 100);
end
```

- 整型，指的是可以用十、十六、八进制指定的数据类型。使用十六进制符号，必须加上 0x。
- 赋值是 Lua 基本语法，操作符为 "="（一个等号）。
- 等于是 Lua 基本语法，属于条件控制，操作符为 "=="（两个等号）。新手常常将等于写作赋值，从而导致编译出现错误

**注意事项**

- getColor 与 getColorRGB 的作用是一样的，只不过前者返回单变量，后者返回 R,G,B 三个变量。
- 如直接使用例子中的代码进行测试，请在全部代码之前，加入 2 ~ 3 秒延迟，或者使用循环语句。 因为脚本开始运行时，会出现音量提示遮盖在前台，影响获取颜色。
- 特别注意，getColor 函数获得的颜色值十六进制文本中，实际顺序为 R G B。
- 新手找色可使用触动精灵函数扩展库中的[比色](https://helpdoc.touchsprite.com/dev_docs/17/8.html)和[多点比色函数](https://helpdoc.touchsprite.com/dev_docs/17/9.html)，更加简单方便。

### 函数：getColorRGB 获取屏幕某点颜色值

color_r, color_g, color_b = getColorRGB(x,y);

| 参数 |  类型  | 必填 | 说明                     |
| :--: | :----: | :--: | :----------------------- |
|  x   | number |  是  | 将获取颜色值的屏幕横坐标 |
|  y   | number |  是  | 将获取颜色值的屏幕纵坐标 |

|          返回值           |  类型  | 说明                |
| :-----------------------: | :----: | :------------------ |
| color_r, color_g, color_b | number | 该点颜色的 R,G,B 值 |

```lua
r,g,b = getColorRGB(100,100);
--转换成十六进制颜色值
dialog(string.format("%#x",r)..string.format("%x",g)..string.format("%x",b))
```

*如果某点的颜色与某颜色相似则点击*

```lua
r,g,b = getColorRGB(100,100);    --获取(100, 100)的颜色值，赋值给 color 变量
if r > 200 and g < 150 then         --如果红色强度大于 200，绿色强度小于 150
    touchDown(100,100);             --那么点击该点
    mSleep(30);
    touchUp(100,100);
end
```

*封装一个单点模糊比色函数*

```lua
function isColor(x,y,c,s)   --封装函数，函数名 isColor
    local fl,abs = math.floor,math.abs
    s = fl(0xff*(100-s)*0.01)
    local r,g,b = fl(c/0x10000),fl(c%0x10000/0x100),fl(c%0x100)
    local rr,gg,bb = getColorRGB(x,y)
    if abs(r-rr)<s and abs(g-gg)<s and abs(b-bb)<s then
        return true
    end
end
--下面为函数用法
if isColor(963,  961, 0x7b593f,90) then --90 为模糊值，值越大要求的精确度越高
    touchDown(963, 961)
    mSleep(50)
    touchUp(963, 961)
end
```

*多点模糊比色*

在实际游戏脚本制作中，很多界面单靠 1 个点不容易进行准确的判断，这里封装一个配合 TABLE 使用的多点模糊比色函数来实现精确判断：

```lua
function multiColor(array,s)
    s = math.floor(0xff*(100-s)*0.01)
    keepScreen(true)
    for var = 1, #array do
        local lr,lg,lb = getColorRGB(array[var][1],array[var][2])
        local r = math.floor(array[var][3]/0x10000)
        local g = math.floor(array[var][3]%0x10000/0x100)
        local b = math.floor(array[var][3]%0x100)
        if math.abs(lr-r) > s or math.abs(lg-g) > s or math.abs(lb-b) > s then
            keepScreen(false)
            return false
        end
    end
    keepScreen(false)
    return true
end

--用法
g_t_Table = {
    { 1962,   52, 0xefdccf},
    { 2150,   50, 0xefd8d0},
    { 1964,   76, 0xe9d1c5},
    { 2152,   74, 0xefdcd1},
    { 2122,   62, 0xf1ddd1},
    { 2146, 1080, 0x893824},
    { 1840, 1082, 0x593724},
}
if multiColor(g_t_Table,90) then
    touchDown(100,100)
    mSleep(50)
    touchUp(100,100)
end
```

### 函数：multiColor 多点比色

**判断多个坐标相应颜色是否成立，成立返回 true，不成立返回 false**

bool = multiColor(array,dim,flag)

| 参数  |  类型   | 必填 | 说明                                                         |
| :---: | :-----: | :--: | :----------------------------------------------------------- |
| array |  table  |  是  | 需要判断的颜色数组                                           |
|  dim  | number  |  否  | 精度，不写默认为 90                                          |
| flag  | boolean |  否  | 是否保持屏幕，默认是 true， 保持屏幕 - true，取消保持屏幕 - false 仅支持 TSLib v1.2.6 及其以上版本 |

| 返回值 |  类型   | 说明                                                |
| :----: | :-----: | :-------------------------------------------------- |
|  bool  | boolean | true - 全部坐标和颜色一致，false - 坐标和颜色值不符 |

*方式一*

```lua
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--全部坐标点和颜色一致时返回 true，== true 可省略不写
if multiColor({{78,272,0x00a8e9},{120,44,0xffffff},{122,197,0x00a8e9}},90,false) == true then
    tap(x,y)
    mSleep(50)
    toast("找到颜色并点击")
    mSleep(3000)
end
```

*方式二（table 格式）*

```lua
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
local options = {
    ["dim"] = 90,
    ["flag"] = false
}
local color_table = {
    {   45,  171, 0xff5722},
    {   45,  168, 0xfce6a8},
    {   45,  174, 0xfce6a8},
}
if multiColor(color_table,options) then--全部坐标点和颜色一致时返回 true，== true 可省略不写
    toast("找到颜色")
else
    toast("未找到颜色")
end
```

- array 为 table 表，坐标颜色值数量任意（填一个坐标和颜色值时为单点找色），可配合触动精灵抓色器自动生成代码使用
- 触动精灵已内置本函数库，无需下载

### 函数：multiColTap 多点比色点击

**判断多个坐标相应颜色是否成立，成立则点击最后一个坐标**

bool = multiColTap(array,dim,pic,flag)

| 参数  |  类型   | 必填 | 说明                                                         |
| :---: | :-----: | :--: | :----------------------------------------------------------- |
| array |  table  |  是  | 需要判断的颜色数组，使用抓色器获取                           |
|  dim  | number  |  否  | 精度，不写默认为 90                                          |
|  pic  | string  |  否  | 点击效果图图片路径，仅支持函数库 v1.2.4 及其以上版本 支持绝对路径和相对路径，相对路径默认为 res 目录 图片不存在则不显示点击位置 |
| flag  | boolean |  否  | 是否保持屏幕，仅支持函数库 v1.2.4 及其以上版本 默认是 true，true - 保持屏幕 - true，false - 取消保持屏幕 |

| 返回值 |  类型   | 说明                                                |
| :----: | :-----: | :-------------------------------------------------- |
|  bool  | boolean | true - 全部坐标和颜色一致，false - 坐标和颜色值不符 |

```lua
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
local color_table = {
    {   45,  171, 0xff5722},
    {   45,  168, 0xfce6a8},
    {   45,  174, 0xfce6a8},
    }
--全部坐标点和颜色一致时返回 true，== true 可省略不写
if multiColTap(color_table,90,"1.png",false) then
    toast("找到颜色")
else
    toast("未找到颜色")
end
```

```lua
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
local options = {
    ["dim"] = 90,
    ["flag"] = true
}
local color_table = {
    {   45,  171, 0xff5722},
    {   45,  168, 0xfce6a8},
    {   45,  174, 0xfce6a8},
}
if multiColTap(color_table,options) then--判断多个坐标相应颜色是否成立，成立则点击最后一个坐标
    toast("找到颜色")
else
    toast("未找到颜色")
end
```

### 函数：muColors 多组颜色比色

**判断第一个数组坐标和颜色值是否匹配，第二个数组坐标和颜色值是否不匹配，符合则返回 true，不符合返回 false**

bool = muColors(color_table1,color_table2,options)

|     参数     | 类型  | 必填 | 说明               |
| :----------: | :---: | :--: | :----------------- |
| color_table1 | table |  是  | 正确的数组         |
| color_table2 | table |  是  | 错误的数组         |
|   options    | table |  否  | 精度及是否保持屏幕 |

options 参数介绍

| 参数 |  类型   | 必填 | 说明                                                         |
| :--: | :-----: | :--: | :----------------------------------------------------------- |
| dim  | number  |  否  | 模糊度。缺省默认为 90                                        |
| flag | boolean |  否  | 是否保持屏幕，默认是 true，保持屏幕 - true，取消保持屏幕 - false |

| 返回值 |  类型   |            说明             |
| :----: | :-----: | :-------------------------: |
|  bool  | boolean | true - 存在；false - 不存在 |

```lua
--一般用于关闭弹窗广告，color_table1 推荐颜色为纯黑或者纯白，用于 color_table1 的坐标和颜色值不变但是周边点颜色变化的场景。
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
local options = {
    ["dim"] = 90,
    ["flag"] = true
}
local color_table1 = {
    {   80,  120, 0xffffff},
    {   90, 23, 0xffffff},
    {   123,  189, 0xffffff},
}
local color_table2 = {
    {   45,  171, 0xffffff},
    {   45,  168, 0xffffff},
    {   45,  174, 0xffffff},
}
if muColors(color_table1,color_table2,options) then
    toast("找到颜色")
else
    toast("未找到颜色")
end
```

### 函数：isColor 单点比色

bool = isColor(x,y,c,dim)

| 参数 |  类型  | 必填 |        说明         |
| :--: | :----: | :--: | :-----------------: |
|  x   | number |  是  | 需要找的点的横坐标  |
|  y   | number |  是  | 需要找的点的纵坐标  |
|  c   | number |  是  | 需要找的点的颜色值  |
| dim  | number |  否  | 精度，不写默认为 90 |

| 返回值 |  类型   |            说明            |
| :----: | :-----: | :------------------------: |
|  bool  | boolean | true - 存在，false- 不存在 |

```lua
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
if isColor(100,200,0xffffff) then --判断点 (100,200) 的颜色值是否为 0xffffff，模糊度默认为 90
    dialog("找到啦",5)
else
    dialog("未找到",5)  
end
```

### 函数：findColorUntil 单点循环比色

bool = findColorUntil(x,y,color,bool,dim,ms,timeout)

|  参数   |  类型   | 必填 |             说明              |
| :-----: | :-----: | :--: | :---------------------------: |
|    x    | number  |  是  |         基准点横坐标          |
|    y    | number  |  是  |         基准点纵坐标          |
|  color  | number  |  是  |         基准点颜色值          |
|  bool   | boolean |  是  |   是否匹配，不写默认为 true   |
|   dim   | number  |  是  |   找色精度，不写默认默认 90   |
|   ms    | number  |  否  | 找色频率，不写默认为 100 毫秒 |
| timeout | number  |  否  |  超时时间，不写默认为 60 秒   |

| 返回值 |  类型   |            说明             |
| :----: | :-----: | :-------------------------: |
|  bool  | boolean | true - 存在；false - 不存在 |

```lua
require("TSLib")
bool =  findColorUntil(44,166,0xfce6a8,true,90,405,1) 
if bool then
    dialog("找到")
else
    dialog("未找到")
end
```

### 函数：findColorInRegionFuzzy 区域单点找色

**在指定区域中，寻找符合指定颜色的坐标，支持模糊查找。**

x, y = findColorInRegionFuzzy(color,degree,x1,y1,x2,y2)

|  参数  |  类型  | 必填 | 说明                                           |
| :----: | :----: | :--: | :--------------------------------------------- |
| color  | number |  是  | 将要找的十六进制颜色值                         |
| degree | number |  是  | 寻找精度，范围：1 ~ 100，当是 100 时为完全匹配 |
|   x1   | number |  是  | 找色区域左上角顶点屏幕横坐标                   |
|   y1   | number |  是  | 找色区域左上角顶点屏幕纵坐标                   |
|   x2   | number |  是  | 找色区域右下角顶点屏幕横坐标                   |
|   y2   | number |  是  | 找色区域右下角顶点屏幕纵坐标                   |

| 返回值 |  类型  | 说明                               |
| :----: | :----: | :--------------------------------- |
|  x,y   | number | 找到的点坐标，如未找到则返回 -1,-1 |

*精确寻找指定区域中，指定颜色的坐标，并按下*

```lua
--寻找符合条件的点
x, y = findColorInRegionFuzzy(0x112233, 100, 50, 50, 300, 300); 
if x ~= -1 and y ~= -1 then  --如果在指定区域找到某点符合条件
    touchDown(x, y);         --那么单击该点
    mSleep(30);
    touchUp(x, y);
else                         --如果找不到符合条件的点
    dialog("未找到符合条件的坐标！",0);
end
```

*模糊查找指定区域中，尽可能接近指定颜色的点，并按下*

```lua
for deg = 100, 1, -1 do           --使用 for 循环不断降低精确度
    x, y = findColorInRegionFuzzy(0xffffff, deg, 50, 50, 300, 300); 
    if x ~= -1 and y ~= -1 then   --如果在指定区域找到某点符合条件
        nLog("在模糊度:"..deg.."下找到一个相似的颜色,坐标:"..x..":"..y)
        touchDown(x, y);          --那么单击该点
        mSleep(30)
        touchUp(x, y);
        break;                      --并跳出循环
    end
end
```

### 函数：findMultiColorInRegionFuzzy 区域多点找色

**在指定区域，根据基准点颜色以及其周边参照点的相对坐标颜色，寻找符合条件的点的坐标，支持模糊查找。**

x, y = findMultiColorInRegionFuzzy(color,posandcolors,degree,x1,y1,x2,y2,tab)

|     参数     |  类型  | 必填 | 说明                                                         |
| :----------: | :----: | :--: | :----------------------------------------------------------- |
|    color     | number |  是  | 基准点颜色                                                   |
| posandcolors | string |  是  | 周边参照点颜色参数； 在周边参考点颜色值前加 ~ 表示与基准点颜色不匹配的颜色 （也可以加反色值）， 此功能引擎版本仅支持 iOS v3.1.7 及其以上版本 |
|    degree    | number |  是  | 寻找精度，范围：1 ~ 100，当是 100 时为完全匹配               |
|      x1      | number |  是  | 找色区域左上角顶点屏幕横坐标                                 |
|      y1      | number |  是  | 找色区域左上角顶点屏幕纵坐标                                 |
|      x2      | number |  是  | 找色区域右下角顶点屏幕横坐标                                 |
|      y2      | number |  是  | 找色区域右下角顶点屏幕纵坐标                                 |
|     tab      | table  |  否  | 高阶用法                                                     |

**高阶用法**

|   参数   |  类型  | 必填 | 说明                                                         |
| :------: | :----: | :--: | :----------------------------------------------------------- |
|  orient  | number |  否  | 0 - 8 代表找色方向，支持版本详见注意事项                     |
|   main   | number |  否  | 基准点的[偏色](https://helpdoc.touchsprite.com/dev_docs/218.html)，支持引擎版本 iOS v2.4.1， Andriod v2.3.5.4 以上版本， 例如 main = 0x101010（十六进制） |
|   list   | number |  否  | 周边参照点的[偏色](https://helpdoc.touchsprite.com/dev_docs/218.html)，支持引擎版本 iOS v2.4.1， Andriod v2.3.5.4 以上版本， 例如 list = 0x202020（十六进制） |
| max_miss | number |  否  | 最大不匹配数，默认 0，代表所有参考点都匹配； 1 代表其中 1 个点不匹配，仅支持引擎版本 iOS v3.0.7、 Android v3.1.3 及其以上版本 |

| 返回值 |  类型  | 说明                                             |
| :----: | :----: | :----------------------------------------------- |
|  x, y  | number | 返回符合条件的基准点的坐标，如未找到则返回 -1,-1 |

*多方向找色方法*

```lua
--tab 参数需要引擎版本：iOS 3.0.0-118,Android 2.3.5 以上支持
--max_miss 参数仅支持专业版 iOS v3.0.7 及其以上版本
x,y = findMultiColorInRegionFuzzy( 0x000000, "0|0|0x000000", 95, 0, 0, 500, 500,  { orient = 1,["max_miss"] = 3 } )
```

*偏色用法*

```lua
--另外一种偏色模式，引擎版本 iOS v2.4.1，Andriod v2.3.5.4 以上支持
--main 为参照点 0xffffff 的偏色，list 为参照点的偏色，如果想对每一个参照点单独偏色，在每一个偏色后面加上偏色值即可，如 "0|0|0x1ac819|0x202020"
x, y = findMultiColorInRegionFuzzy(0xffffff,"0|0|0x1ac819,-4|-208|0x18cb76,3|58|0x21cc79",90,0,0,500,500,{ main = 0x101010, list = 0x202020 })
dialog(x..","..y,0)
```

*反色用法*

```lua
--与基准点不匹配的颜色，也可以叫反色，可用于匹配不规则图形
--可用于找不固定位置广告右上角的 × 号，如 × 号的颜色是白色，周边参数点不是白色，可以使用此函数
fwShowWnd("window1",0,0,100,100,1)
fwShowTextView("window1","text1","","center","000000","ffffff",20,0,0,40,100,60,1)
fwShowTextView("window1","text2","","center","000000","ffffff",20,0,40,0,60,100,1)
mSleep(2000)
x,y = findMultiColorInRegionFuzzy( 0xffffff, "0xffffff,36|7|0xffffff,-38|6|0xffffff,-36|-24|~0xffffff,23|-20|~0xffffff,29|27|~0xffffff", 90, 0, 0, 300, 300)
if x~=-1 then
    dialog("x:"..x.."\n".."y:"..y)
else
    dialog("未找到")
end
```

### 函数：findMultiColorInRegionFuzzyExt 高级多点区域找色

point = findMultiColorInRegionFuzzyExt(color,posandcolors,degree,x1,y1,x2,y2,tab);

|     参数     |  类型  | 必填 | 说明                                                         |
| :----------: | :----: | :--: | :----------------------------------------------------------- |
|    color     | number |  是  | 基准点颜色                                                   |
| posandcolors | string |  是  | 周边参照点颜色参数                                           |
|    degree    | number |  是  | 寻找精度，范围：1 ~ 100，当是 100 时为完全匹配               |
|      x1      | number |  是  | 找色区域左上角顶点屏幕横坐标                                 |
|      y1      | number |  是  | 找色区域左上角顶点屏幕纵坐标                                 |
|      x2      | number |  是  | 找色区域右下角顶点屏幕横坐标                                 |
|      y2      | number |  是  | 找色区域右下角顶点屏幕纵坐标                                 |
|     tab      | table  |  否  | 高阶用法，详见 [findMultiColorInRegionFuzzy](https://helpdoc.touchsprite.com/dev_docs/17/18.html) 函数 |

高阶用法

|  参数  |  类型  | 必填 | 说明                                                         |
| :----: | :----: | :--: | :----------------------------------------------------------- |
| orient | number |  否  | 0 - 8，代表找色方向，详见注意事项，支持版本详见注意事项      |
|  main  | number |  否  | 基准点的[偏色](https://helpdoc.touchsprite.com/dev_docs/218.html)，支持引擎版本 iOS v2.4.1,Andriod v2.3.5.4 以上版本， 例如 main = 0x101010（十六进制） |
|  list  | number |  否  | 周边参照点的[偏色](https://helpdoc.touchsprite.com/dev_docs/218.html)，支持引擎版本 iOS v2.4.1,Andriod v2.3.5.4 以上版本， 例如 list = 0x202020（十六进制） |
| count  | number |  否  | 设置查找结果数量，默认返回所有符合条件的目标点的坐标， 仅支持引擎版本 iOS v3.0.7,Android v3.1.3 及其以上版本 |

| 返回值 | 类型  | 说明                                                         |
| :----: | :---: | :----------------------------------------------------------- |
| point  | table | 以 table 形式返回所有符合条件点的坐标（第一个点为基准点，其余点为参照点），如未找到则返回的 table 为空 |

返回的 table 为以下形式：

```
table = {
    {x = 100,y = 110},
    {x = 200,y = 210},
    {x = 300,y = 310},
    ...
}
```

```lua
point = findMultiColorInRegionFuzzyExt( 0xcf0000, "-37|3|0x942814,-38|20|0xeba62d,1|54|0xf2b054,28|22|0x8a5707", 90, 97, 220, 903, 701)
if #point ~= 0 then  --如返回的table不为空（至少找到一个符合条件的点）
    for var = 1,#point do
        nLog(point[var].x..","..point[var].y)
    end
end
```

*偏色用法*

```lua
--另外一种偏色模式，引擎版本 iOS v2.4.1，Andriod v2.3.5.4 以上支持
--main 为基准点 0xffffff 的偏色，list 为周边参照点的偏色，如果想对每一个参照点单独偏色，在每一个偏色后面加上偏色值即可，如 "0|0|0x1ac819|0x202020"
point = findMultiColorInRegionFuzzyExt(0xffffff,"0|0|0x1ac819,-4|-208|0x18cb76,3|58|0x21cc79", 90,0,0,100,100,{main = 0x101010,list = 0x202020})
if #point ~= 0 then  --如返回的table不为空（至少找到一个符合条件的点）
    for var = 1,#point do
        nLog(point[var].x..","..point[var].y)
    end
end
```

*多点方向用法*

```lua
--count 参数仅支持专业版 iOS v3.0.7 以及以上版本
x,y = findMultiColorInRegionFuzzyExt( 0x000000, "0|0|0x000000", 95, 0, 0, 100, 100,  { orient = 1,["count"] = 3 })
```

### 函数：findMultiColor 多点区域找色

findMultiColor(color,posandcolors,degree,x1,y1,x2,y2,tb)

|     参数     |  类型  | 必填 | 说明                                                         |
| :----------: | :----: | :--: | :----------------------------------------------------------- |
|    color     | number |  是  | 基准点颜色                                                   |
| posandcolors | string |  是  | 周边参照点颜色参数                                           |
|    degree    | number |  是  | 寻找精度，范围：1 ~ 100，当是 100 时为完全匹配               |
|      x1      | number |  是  | 找色区域左上角顶点屏幕横坐标                                 |
|      y1      | number |  是  | 找色区域左上角顶点屏幕纵坐标                                 |
|      x2      | number |  是  | 找色区域右下角顶点屏幕横坐标                                 |
|      y2      | number |  是  | 找色区域右下角顶点屏幕纵坐标                                 |
|      tb      | table  |  否  | 高阶用法，详细用法详见 [findMultiColorInRegionFuzzy](https://helpdoc.touchsprite.com/dev_docs/17/18.html) 函数 |

**高阶用法**

|  参数  |  类型  | 必填 | 说明                                                         |
| :----: | :----: | :--: | :----------------------------------------------------------- |
| orient | number |  否  | 0 - 8，代表找色方向，详见注意事项，支持版本详见注意事项      |
|  main  | number |  否  | 基准点的[偏色](https://helpdoc.touchsprite.com/dev_docs/218.html)，支持引擎版本 iOS v2.4.1,Andriod v2.3.5.4 以上版本 例如 main = 0x101010（十六进制） |
|  list  | number |  否  | 周边参照点的[偏色](https://helpdoc.touchsprite.com/dev_docs/218.html)，支持引擎版本 iOS v2.4.1,Andriod v2.3.5.4 以上版本 例如 list = 0x202020（十六进制） |
| count  | number |  否  | 设置查找结果数量，默认返回所有符合条件的参照点的坐标 仅支持引擎版本 iOS v3.0.7,Android v3.1.3 及其以上版本 |
|  miss  | number |  否  | 单位：像素，过滤返回值中在此参数范围内的坐标                 |

| 返回值 | 类型  | 说明                                                         |
| :----: | :---: | :----------------------------------------------------------- |
| point  | table | 以 table 形式返回所有符合条件点的坐标（第一个点为基准点，其余点为参照点），如未找到则返回的 table 为空 |

**返回的 table 为以下形式**

```
table = {
    {x = 100,y = 110},
    {x = 200,y = 210},
    {x = 300,y = 310},
    ...
}
```

```lua
require "TSLib"
--参数 miss 仅支持 TSLib v1.3.1 以及以上版本
point = findMultiColor(0x969696,"6|1|0x969696,1|12|0x969696,-4|0|0x969696",90,683,236,732,663,{miss = 3})
if point then
    if #point ~= 0 then  --如返回的table不为空（至少找到一个符合条件的点）
        for var = 1,#point do
            nLog(point[var].x..":"..point[var].y)
        end
    end
end
```

### 扩展：区域多点找色基础和高阶用法

**基础用法**

当我们使用“区域模糊找色”函数时，常常会因为屏幕上有大量符合指定颜色的点而找不到需要的坐标。该函数通过在寻找到一个符合指定颜色 color 的坐标后，进一步确认其周边点坐标的方式，来确定准确目标。例如，现在我们在图像上找到了我们需要的一个按钮，这个按钮的图案是不变的，但是它的整体位置却会在整个屏幕上变化，现在我们想要在脚本运行时得到其坐标。

我们首先找到基准点：

这个点的颜色为 `0x181F85`，坐标为 `268, 802`。

记录下来，接着找这个按钮上的参照点：

这个点的颜色为 `0x00BBFE`，坐标为 `297, 803`，相对于基准点的坐标为 `29, 1`。 记录下来，接着找这个按钮上的第三个点和第四个点。

第二个参照点的颜色为 `0x0B6BBE`，坐标为 `371, 798`，相对于基准点的坐标为 `103, -4`。

第三个参照点的颜色为 `0x150972`，坐标为 `333, 811`，相对于基准点的坐标为 `65, 9`。

现在我们找到了需要的目标点：

| 序号 |   颜色   |    坐标    | 相对坐标  |
| :--: | :------: | :--------: | :-------: |
|  1   | 0x181F85 | (268, 802) |  (0, 0)   |
|  2   | 0x00BBFE | (297, 803) |  (29, 1)  |
|  3   | 0x0B6BBE | (371, 798) | (103, -4) |
|  4   | 0x150972 | (333, 811) |  (65, 9)  |

现在我们可以把它写成多点找色的格式了：

```lua
--多点找色
--在屏幕上以左上角坐标 (0,0) 和右下角坐标 (639, 959)确定的区域（即全屏）范围内寻找符合偏移范围和颜色的 3 个坐标点
x, y = findMultiColorInRegionFuzzy(0x181F85, "29|1|0x00BBFE,103|-4| 0x0B6BBE,65|9|0x150972", 100, 0, 0, 639, 959); 
dialog(x..","..y, 0)
```

那么返回的 `x, y` 就应该是基准点坐标 `268,802`了。即使这个按钮平移了，这个点的坐标变了，也可以寻找到其准确位置。

**高阶用法**

*多方向找色规则*

orient 不填或 orient = 0 表示包括基准点在内的所有目标点都必须在查找范围之内 ，orient = 1 - 8 表示使用 8 种不同的找色方向。

只要写了 orient 参数，那么找色方向就会根据 init 设置方向旋转，一直保持以当前设置的屏幕方向左上角为初始点。

```lua
 local w,h = getScreenSize()
    fwShowWnd("wid1", 0, 0, w-1, h-1,1)
    fwShowImageView("wid1","picid","image.png",0, 0, w-1, h-1)
    mSleep(500)
    for i = 0, 2 do
        init(i)
        if i == 0 then
            toast("init方向为0",3)
            x1,y1,x2,y2 = 0,0,w-1,h-1
        elseif i == 1 then
            toast("init方向为1",3)
            x1,y1,x2,y2 = 0,0,h-1,w-1
        else
            toast("init方向为2",3)
            x1,y1,x2,y2 = 0,0,h-1,w-1
        end
        for var = 1, 8 do
            x,y = findMultiColorInRegionFuzzy( 0x000000, "0|0|0x000000", 95, x1, y1, x2, y2,  { orient = var })
            fwShowWnd("wid", x-20, y-20, x+20, y+20,1)
            fwShowTextView("wid","textid","","center","FF0000","FFDAB9",20,0,0,0,40,40,1)
            mSleep(500)
        end
    end
```

