# TSLib 基础扩展库

### 获取扩展版本号

```lua
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
dialog(TSVersions()) --返回版本号字符串，返回值如：1.1.1
```

### compareVersion 比较版本号

| 参数 |  类型  | 必填 |               说明               |
| :--: | :----: | :--: | :------------------------------: |
|  v1  | string |  是  | 需要比较的版本号，参数需要大于 0 |
|  v2  | string |  是  | 需要比较的版本号，参数需要大于 0 |

| 返回值 |  类型  | 说明                                                         |
| :----: | :----: | :----------------------------------------------------------- |
|  size  | string | 如果 v1 大于 v2 返回 1，如果 v2 大于 v1 返回 2，v1 与 v2 相同返回 3 |

```lua
require("TSLib")
local m = TSVersions()
--注意：仅支持 TSLib v1.2.9 及其以上版本
size = compareVersion(m,"1.3.4")
if size == 3 then
    dialog("TSLib 版本号为 1.3.4")
elseif  size == 1  then
    dialog("TSLib 版本号大于 1.3.4")
elseif  size == 2  then
    dialog("TSLib 版本号小于 1.3.4")
end
```

### 函数：checkTSLibrary 检测加载插件

| 参数 |  类型  | 必填 | 说明                           |
| :--: | :----: | :--: | :----------------------------- |
| name | string |  是  | 插件或函数库名称，`aso`、`vpn` |

| 返回值 |  类型   | 说明                              |
| :----: | :-----: | :-------------------------------- |
|  bool  | boolean | true - 查询成功，false - 查询失败 |
|  msg   | string  | 查询结果或错误信息                |

```lua
--[[
    vpn = VPN 插件
 --]]
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
local bool,msg = checkTSLibrary("tsvpn") -- TSLib 1.2.5 以上版本支持此函数 
dialog((bool and "成功 : " or "失败 : ") .. msg)
```

### 函数：tap 点击

tap(x,y,{ms,pic,index})

| 参数  |  类型  | 必填 | 说明                                                         |
| :---: | :----: | :--: | :----------------------------------------------------------- |
|   x   | number |  是  | 屏幕横坐标                                                   |
|   y   | number |  是  | 屏幕纵坐标                                                   |
|  ms   | number |  否  | 时间，缺省默认为 50，单位毫秒                                |
|  pic  | string |  否  | 点击效果图路径，仅支持函数库 v1.2.4 及其以上版本 支持绝对路径和相对路径，相对路径默认为 res 目录， 图片不存在则不显示点击位置 |
| index | number |  否  | 手指序号，仅支持函数库 v1.3.0 及其以上版本 默认不写随机手指序号，推荐使用 1-9 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--index 参数仅支持函数库 v1.3.0 及其以上版本 TSLib
--pic 参数仅支持函数库 v1.2.4 及其以上版本 TSLib
tap(100,200,50,"1.png",1) --点击坐标(100,200),默认按下 50 毫秒后抬起
--tap(100,200,{["ms"]=50,["index"] = 1,["pic"] ="1.png"})
```

### 函数：moveTo 滑动

moveTo(x1,y1,x2,y2,step,ms,{index,stop})

| 参数  |     类型     | 必填 | 说明                                                         |
| :---: | :----------: | :--: | :----------------------------------------------------------- |
|  x1   |    number    |  是  | 屏幕起点横坐标                                               |
|  y1   |    number    |  是  | 屏幕起点纵坐标                                               |
|  x2   |    number    |  是  | 屏幕终点横坐标                                               |
|  y2   |    number    |  是  | 屏幕终点纵坐标                                               |
| step  |    number    |  否  | 滑动速度，不写默认为 10 px                                   |
|  ms   |    number    |  否  | 弹起时间，不写默认为 50 毫秒                                 |
| index | table/number |  否  | 手指序号，仅支持函数库 v1.3.0 及其以上版本 默认不写随机手指序号，推荐使用 1 - 9 |
| stop  |   boolean    |  否  | 是否解决惯性滑动，仅支持函数库 v1.3.1 及其以上版本 默认 0 不进行处理，1 - 精准滑动，解决惯性问题 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--从坐标(100,100)滑动到(300,100)，步长为 20 像素，默认移到另一点等待 70 毫秒弹起
--index 参数仅支持 TSLib v1.3.0 及其以上版本
--step 步长不宜超过 50 像素
--stop 参数仅支持 TSLib v1.3.1 及其以上版本
moveTo(100,100,300,100,{["step"] = 20,["ms"] = 70,["index"] = 1,["stop"] = 1}) 
--moveTo(100,100,300,100,20,70,1,1)
```

- 步长不宜超过 50

### 函数：randomTap 随机点击

randomTap(x,y,r,pic,index,ms)

| 参数  |  类型  | 必填 | 说明                                                         |
| :---: | :----: | :--: | :----------------------------------------------------------- |
|   x   | number |  是  | 屏幕横坐标                                                   |
|   y   | number |  是  | 屏幕纵坐标                                                   |
|   r   | number |  否  | 随机值，缺省默认为 5px                                       |
|  pic  | string |  否  | 点击效果图路径，此参数仅支持函数库 v1.2.4 及其以上版本 支持绝对路径和相对路径，相对路径默认为 res 目录， 图片不存在则不显示点击位置 |
| index | number |  否  | 手指序号，仅支持函数库 v1.3.0 及其以上版本 默认不写随机手指序号，推荐使用 1-9 |
|  ms   | number |  否  | 弹起时间，不写默认为 50 毫秒，仅支持函数库 v1.3.5 及其以上版本 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--pic 参数仅支持函数库 v1.2.4 及其以上版本 TSLib
--index 参数支持 v3.1.0 及其以上版本
--ms 参数仅支持 v3.1.5 及其以上版本

randomTap(100,200,10,"1.png",1,1000)--随机点击坐标(x,y)，x 为 100±10 取一个随机值，y 为 200±10 取一个随机值，1 秒后弹起。
```

### 函数：touchDown touchUp 触摸按下 抬起

touchDown(index,x,y)

touchUp(index,x ,y)

| 参数  |  类型  | 必填 |        说明        |
| :---: | :----: | :--: | :----------------: |
| index | number |  否  | 手指序号（可省略） |
|   x   | number |  是  |     屏幕横坐标     |
|   y   | number |  是  |     屏幕纵坐标     |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
--在坐标 (150, 550)按下
touchDown(150, 550);    
mSleep(30);
--在坐标 (150, 550) 抬起
touchUp(150, 550);
```

- 需要注意的是在使用 `touchDown`、`touchMove`、`touchUp` 函数时，中间一定要插入一定的延时，建议大于 20 毫秒，否则可能会出现点击无效等异常情况。

- 使用滑动函数时，新手常犯的错误就是两点之间滑动距离过大，请注意 `touchDown`、`touchMove` 的坐标间隔不宜超过 50 像素。

- 非多点触控可省略手指 id。

### 函数：touchMove 触摸移动

touchMove(index,x ,y)

| 参数  |  类型  | 必填 |        说明        |
| :---: | :----: | :--: | :----------------: |
| index | number |  否  | 手指序号（可省略） |
|   x   | number |  是  |     屏幕横坐标     |
|   y   | number |  是  |     屏幕纵坐标     |

```lua
--在坐标 (150, 550)按下
--此函数为触动精灵专用函数请勿用于积木编程
touchDown(150, 550);    
mSleep(30);
--移动到坐标 (150, 600)，注意一次滑动的坐标间隔不要太大，不宜超过 50 像素
touchMove(150, 600);    
mSleep(30);
--在坐标 (150, 600) 抬起
touchUp(150, 600);
```

### 函数：catchTouchPoint 获取用户点击坐标

x,y = catchTouchPoint();

| 返回值 |  类型  | 说明                 |
| :----: | :----: | :------------------- |
|   x    | number | 用户点击屏幕的横坐标 |
|   y    | number | 用户点击屏幕的纵坐标 |

ret = catchTouchPoint(touchCount)

|    参数    |  类型  | 必填 | 说明                                                         |
| :--------: | :----: | :--: | :----------------------------------------------------------- |
| touchCount | number |  是  | 所需获取的点/坐标个数 （需引擎版本 iOS v2.2.4,Android v1.1.9 以上支持） |

| 返回值 | 类型  | 说明                                                         |
| :----: | :---: | :----------------------------------------------------------- |
|  ret   | table | 当 touchCount 参数有效时，将返回一个包含所有点击坐标的 table |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
dialog("一秒后接收用户一次点击", 0);
mSleep(1000);
x,y = catchTouchPoint(); 
dialog("x:"..x.." y:"..y, 0);
```

```lua
--获取多个点击坐标
dialog("一秒后接收用户三次点击", 0);
mSleep(1000);
local ret = catchTouchPoint(3);
for i = 1, #ret do  
    dialog("第"..i.."次点击的位置:"..i..",x="..ret[i].x..",y="..ret[i].y);
end
```

- \# 来计算字符串的长度

### 函数：setScreenScale 坐标缩放

setScreenScale(flag,width,height)

|  参数  |  类型   | 必填 | 说明                      |
| :----: | :-----: | :--: | :------------------------ |
|  flag  | boolean |  是  | true - 打开，false - 关闭 |
| width  | number  |  是  | 基准屏幕的宽度            |
| height | number  |  是  | 基准屏幕的高度            |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
--当此函数打开时，将影响点击、取色、单点模糊找色等函数
--以 750,1334 分辨率为基准坐标进行缩放
setScreenScale(true,750,1334)   
--关闭缩放
setScreenScale(false)
```

### 函数：xyRotate 坐标转换

x2,y2 = xyRotate(x1,y1,dir)

| 参数 |  类型  | 必填 | 说明             |
| :--: | :----: | :--: | :--------------- |
|  x1  | number |  是  | 需要旋转的横坐标 |
|  y1  | number |  是  | 需要旋转的纵坐标 |
| dir  | number |  是  | 旋转方向，0 - 3  |

dir 参数介绍

| 参数 |       说明       |
| :--: | :--------------: |
|  0   |      不旋转      |
|  1   | 逆时针旋转 90 度 |
|  2   | 顺时针旋转 90 度 |
|  3   |   旋转 180 度    |

| 返回值 |  类型  |      说明      |
| :----: | :----: | :------------: |
|   x2   | number | 旋转后的横坐标 |
|   y2   | number | 旋转后的纵坐标 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require("TSLib")
for var= 1,4,1 do
    x,y = xyRotate(611,274,var-1);
    dialog(x..","..y)
end
```

### 函数：randomsTap 随机滑动点击

randomsTap(x,y,{r,pic,index,ms})

| 参数  |     类型     | 必填 | 说明                                                         |
| :---: | :----------: | :--: | :----------------------------------------------------------- |
|   x   |    number    |  是  | 屏幕横坐标                                                   |
|   y   |    number    |  是  | 屏幕纵坐标                                                   |
|   r   |    number    |  否  | 随机值，缺省默认为 20，单位 px                               |
|  pic  |    string    |  否  | 点击效果图路径，此参数仅支持函数库 v1.2.4 及其以上版本 支持绝对路径和相对路径，相对路径默认为 res 目录， 图片不存在则不显示点击位置 |
| index | table/number |  否  | 手指序号，仅支持函数库 v1.3.0 及其以上版本 默认不写随机手指序号，推荐使用 1 - 9 |
|  ms   |    number    |  否  | 弹起时间，不写默认为 50 毫秒，仅支持函数库 v1.3.5 及其以上版本 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
dialog(TSVersions())
--index 参数仅支持函数库 v1.3.0 及其以上版本 TSLib
--pic 参数仅支持函数库 v1.2.4 及其以上版本 TSLib
--ms 参数仅支持函数库 v1.3.5 及其以上版本 TSLib
randomsTap(100,200,{["index"] = 1,["pic"] ="1.png",["r"]=5,["ms"]=5000}) --随机点击滑动坐标(x,y)，x 为 100±20 取一个随机值，y 为 200±20 取一个随机值,并在此范围内随机抖动，5 秒后弹起。
--参数齐全后显示点击位置的图标才会显示
--randomsTap(100,200,20,"1.png",1,5000)
```

### 函数：moveTowards 角度滑动

moveTowards(x,y,angle,length,step);

|  参数  |  类型  | 必填 | 说明                      |
| :----: | :----: | :--: | :------------------------ |
|   x    | number |  是  | 屏幕起点横坐标            |
|   y    | number |  是  | 屏幕起点纵坐标            |
| angle  | number |  是  | 角度                      |
| length | number |  是  | 滑动长度                  |
|  step  | number |  否  | 滑动速度，不写默认为 10px |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
moveTowards(500,500,90,300,10) --从坐标(500,500)向上滑动 300
```

- 角度 angle 为 0 时向右滑动，90 向上滑动，180 向左滑动

- 长度 length 大于 0

- 可选参数速度 step，当不写默认为 10，也可自己填写，step 应为大于 0 小于距离长度的数值，建议小于 50，否则会出现滑动无效的情况

### 函数：moveZoomOut 捏合

moveZoomOut(x1,y1,x2,y2,step)

| 参数 |  类型  | 必填 | 说明                       |
| :--: | :----: | :--: | :------------------------- |
|  x1  | number |  是  | 需要捏合点 1 的横坐标      |
|  y1  | number |  是  | 需要捏合点 1 的纵坐标      |
|  x2  | number |  是  | 需要捏合点 2 的横坐标      |
|  y2  | number |  是  | 需要捏合点 2 的纵坐标      |
| step | number |  否  | 捏合速度，不写默认为 10 px |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
moveZoomOut(100,100,300,300) --从坐标 (100,100) 和坐标 (300,300) 同时向中间点滑动缩小
```

- 可选参数速度 step，当不写默认为 10，也可自己填写，step 为大于 0 小于距离长度的数值，建议小于 50，否则会出现滑动无效的情况

### 函数：moveZoomIn 放大滑动

moveZoomIn(x1,y1,x2,y2,step)

| 参数 |  类型  | 必填 | 说明                        |
| :--: | :----: | :--: | :-------------------------- |
|  x1  | number |  是  | 放大滑动点 1 的横坐标       |
|  y1  | number |  是  | 放大滑动点 1 的纵坐标       |
|  x2  | number |  是  | 放大滑动点 2 的横坐标       |
|  y2  | number |  是  | 放大滑动点 2 的纵坐标       |
| step | number |  否  | 滑动速度，不写缺默认为 10px |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
moveZoomIn(100,100,300,300) --两点坐标中间同时向坐标 (100,100) 和坐标 (300,300) 两端滑动
```

### 函数：moveCircleCenter 圆心滑动

moveCircleCenter(cX,cY,x,y,angle,step,direction)

|   参数    |  类型  | 必填 | 说明                                      |
| :-------: | :----: | :--: | :---------------------------------------- |
|    cX     | number |  是  | 圆心点横坐标                              |
|    cY     | number |  是  | 圆心点纵坐标                              |
|     x     | number |  是  | 圆上点横坐标                              |
|     y     | number |  是  | 圆上点纵坐标                              |
|   angle   | number |  否  | 滑动角度，不写默认为 360，转一周          |
|   step    | number |  否  | 滑动速度，不写默认为 10px                 |
| direction | number |  否  | 滑动方向，不写默认为逆时针，-1 时为顺时针 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
moveCircleCenter(200,200,0,200) --以圆心坐标(200,200)，圆上一点起点(0,200),逆时针转一圈
```

- 角度 angle 大于 0，转 1 圈数值为 360，以此类推

- step 步长不写默认为 10，越小越快，大于 0，建议小于 50，否则可能会导致函数运行无效

- 方向 direction 默认逆时针，-1 时为顺时针

### 函数：moveCirclePonits 圆弧滑动

moveCirclePonits(x1,y1,x2,y2,x3,y3,angle,step,direction);

|   参数    |  类型  | 必填 | 说明                                      |
| :-------: | :----: | :--: | :---------------------------------------- |
|    x1     | number |  是  | 圆上点 1 横坐标                           |
|    y1     | number |  是  | 圆上点 1 纵坐标                           |
|    x2     | number |  是  | 圆上点 2 横坐标                           |
|    y2     | number |  是  | 圆上点 2 纵坐标                           |
|    x3     | number |  是  | 圆上点 3 横坐标                           |
|    y3     | number |  是  | 圆上点 3 纵坐标                           |
|   angle   | number |  否  | 滑动角度，不写默认为 360，转一周          |
|   step    | number |  否  | 滑动速度，不写默认为 10px                 |
| direction | number |  否  | 不滑动方向，写默认为逆时针，-1 时为顺时针 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
moveCirclePonits(300,100,100,200,500,200) --三点坐标确定圆心，以圆上起点(300,100)，逆时针转一圈
```

### 函数：getAngle 获取角度

angle = getAngle(x1,y1,x2,y2)

| 参数 |  类型  | 必填 |     说明     |
| :--: | :----: | :--: | :----------: |
|  x1  | number |  是  | 基准点横坐标 |
|  y1  | number |  是  | 基准点纵坐标 |
|  x2  | number |  是  | 查找点横坐标 |
|  y2  | number |  是  | 查找点纵坐标 |

| 返回值 |  类型  | 说明         |
| :----: | :----: | :----------- |
| angle  | number | 获取到的角度 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
require("TSLib")
angle = getAngle(188,379,317,243)
dialog(angle)
```

### 函数：touch() 获取对象

local touch = touch(index)

| 参数  |  类型  | 必填 | 说明                                                         |
| :---: | :----: | :--: | :----------------------------------------------------------- |
| index | number |  否  | 手指序号，仅支持函数库 v1.3.0 及其以上版本 默认不写随机手指序号，推荐使用 0 - 29 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--touch 函数仅支持 V1.2.7 以上版本 TSLib  
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
tsver = TSVersions()     
tsint = tonumber(string.sub(tsver,1,1)..string.sub(tsver,3,3)..string.sub(tsver,5,5));
if tsint < 127 then
    dialog("TSLib 版本低，请下载最新版本的 TSLib 导入到lua文件夹下")
    luaExit()
end
--index 参数仅支持函数库 v1.3.0 及其以上版本 TSLib
local touch = touch() 
touch:on(100,100):move(100,100):off()
```

### 函数：on 按下

**随机分配的手指 id 在 (x,y) 处按下**

touch = touch:on(x,y)

| 参数 |  类型  | 必填 |    说明    |
| :--: | :----: | :--: | :--------: |
|  x   | number |  是  | 屏幕横坐标 |
|  y   | number |  是  | 屏幕纵坐标 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--仅支持 1.2.7 以上版本的 TSLib 
require "TSLib"
touch():on(100,100):off()
```

```lua
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--仅支持 V1.3.3 以上版本的 TSLib 
require "TSLib"
local touch = touch() 
touch:on(100,100):off()
```

```lua
--仅支持 V1.3.3 以上版本的 TSLib 
require "TSLib"
local touch = touch() 
touch = touch:on(100,100)
touch = touch:Delay(20)
touch:off()
```

### 函数：move 移动

touch = touch:move(x,y)

| 参数 |  类型  | 必填 |    说明    |
| :--: | :----: | :--: | :--------: |
|  x   | number |  是  | 屏幕横坐标 |
|  y   | number |  是  | 屏幕纵坐标 |

```lua
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--此函数为触动精灵专用函数请勿用于积木编程
--仅支持 V1.2.7 以上版本的 TSLib 
require "TSLib"
touch():on(100,100):move(200,200):off()
```

```lua
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--仅支持 V1.3.3 以上版本的 TSLib 
require "TSLib"
local touch = touch(1) 
touch:on(100,100):move(200,200):off()
```

### 函数：off 抬起

off()

```lua
--此函数为触动精灵专用函数请勿用于积木编程
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--仅支持 V1.2.7 以上版本的 TSLib 
require "TSLib"
touch():on(100,100):move(200,200):off()
```

```lua
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--index 参数仅支持 V1.3.3 以上版本的 TSLib 
require "TSLib"
local touch = touch(1) 
touch:on(100,100):move(200,200):off()
```

### 函数：Delay 设置延迟

touch = touch:Delay(time)

| 参数 |  类型  | 必填 |           说明           |
| :--: | :----: | :--: | :----------------------: |
| time | number |  否  | 延迟时间，不写默认为 5ms |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--仅支持 V1.2.7 以上版本的 TSLib 
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
touch():Delay(10):on(100,100):move(200,200):off()
```

```lua
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--index 参数仅支持 V1.3.3 以上版本的 TSLib 
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
local touch = touch() 
touch:Delay(10):on(100,100):move(200,200):off()
```

### 函数：Step 设置步长

touch = touch:Step(step)

| 参数 |  类型  | 必填 |            说明            |
| :--: | :----: | :--: | :------------------------: |
| step | number |  否  | 步长，不写默认值为 10 像素 |

```lua
--此函数为触动精灵专用函数请勿用于积木编程
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--仅支持 V1.2.7 以上版本 TSLib 使用
require "TSLib"
touch():Step(5):on(100,100):move(200,200):off()
```

```lua
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--index 仅支持 V1.3.3 以上版本 TSLib 使用
require "TSLib"
local touch = touch() 
touch:Step(5):on(100,100):move(200,200):off()
```

## 示例

### 连续滑动

```lua
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--index 参数仅支持 V1.3.3 以上版本的 TSLib 
require "TSLib"
local touch = touch() 
touch = touch:on(100,100)
touch = touch:Step(10)
touch = touch:Delay(5)
touch = touch:move(100,200)
touch = touch:move(200,200)
touch = touch:move(200,100)
touch = touch:move(100,100)
touch:off()
```

```lua
--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--仅支持 V1.2.7 以上版本的 TSLib 
require "TSLib"
touch():on(100,100):Step(10):Delay(5):move(100,200):move(200,200):move(200,100):move(100,100):off()
```

### 精准滑动

```lua
--精准滑动的原理就是通过向滑动方向的垂直线方向移动 1 像素来终止滑动惯性
--简单的垂直精准滑动
touchDown(200,1000)
for i = 0, 500, 50 do
    touchMove(200, 1000-i)
    mSleep(10)
end
--只要 90 度滑动 1 像素就可以精准滑动
--横向滑动 1 像素
touchUp(201, 500) 
mSleep(10)
```

```lua
--使用 v1.2.7 版本 TSLib 新增的 touch() 函数进行滑动
require("TSLib")
touch():Step(50):on(200,1000):move(200,500):off()
--减少步长也可以进行精准滑动
```

```lua
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
--从坐标(100,100)滑动到(300,100)，步长为 20 像素，默认移到另一点等待 70 毫秒弹起
--index 参数仅支持 TSLib v1.3.0 及其以上版本
--step 步长不宜超过 50 像素
--stop 参数仅支持 TSLib v1.3.1 及其以上版本
moveTo(100,100,300,100,{["step"] = 20,["ms"] = 70,["index"] = 1,["stop"] = true})
```

### 多点触控

```lua
--此示例代码所有函数为触动精灵专用函数请勿用于积木编程
touchDown(1, 200, 400);                --手指 1 在坐标 (200, 400) 按下
touchDown(2, 300, 500);                --手指 2 在坐标 (300, 500) 按下
mSleep(50);
for i = 1, 100, 1 do                --使用 for 循环使两只手指同时分离
    touchMove(1, 200 - i, 400 - i); 
    touchMove(2, 300 + i, 500 + i);
    mSleep(10);
end
touchUp(1, 200 - 100, 400 - 100);    --抬起手指 1
touchUp(2, 300 + 100, 500 + 100);   --抬起手指 2
```

### 封装点击函数

```lua
function click(x, y)
    touchDown(x, y)
    mSleep(30)
    touchMove(x, y) -- 安卓部分机型单点不生效的情况下可以加上此句
    touchUp(x, y)
end
click(100, 200) --点击坐标 100,200 位置
```

### 方形渐开线

```lua
init(1)
mSleep(1000)
local x = 1010 --起始坐标 x
local y = 698  --起始坐标 y
local v = 30   --两点间距离
touchDown(x, y)
mSleep(100)
for var = 1,20 do
    j = 0
    k = v
    for _i = 1,2 do
        for i = 1,10 do
            x = x + j
            y = y + k
            touchMove(x, y)
            mSleep(20)
        end
        j = v
        k = 0
    end
    v = v * (-1.05)
end
touchUp(x, y)
```

### 圆形渐开线

```lua
init(1)
mSleep(1000)
local x0 = 1010 --起始坐标 x
local y0 = 698  --起始坐标 y
local rr = 20   --设置递增半径 
local l = 10    --设置点间距 
local p = 0     --初始化角度  
local r = 30    --设置首圈半径
local rn = 10   --设置圈数
touchDown(x0, y0)
mSleep(100)
for var = 1,rn do
    while p < math.pi * 2 do
        x = x0 + r * math.cos(p) 
        y = y0 - r * math.sin(p) 
        touchMove(x, y)
        mSleep(10)
        p = p + l/r
    end
    p = 0
    r = r + rr 
end
touchUp(x0, y0)
```

## 安卓点击失效

```lua
--其中 x,y 为坐标值 
os.execute("input mouse tap x y")，
```

```lua
--点击坐标（600,900）
x=100+500
y=500+400
m=tostring(x)
n=tostring(y)
os.execute("input mouse tap "..m.." "..n)
```

##### **滑动，x1 y1 为滑动初始坐标，x2 y2 为滑动结束坐标**

os.execute("input mouse swipe x1 y1 x2 y2")

```
如果以上命令还是不生效可以用下面的 API 方法代替 mouse 进行尝试：

keyboard  
joystick  
touchnavigation  
touchpad  
trackball  
stylus  
dpad  
touchscreen  
gamepad
```

```lua
os.execute("input keyboard tap 100 100")
```

如果仍无法滑动可以使用 touchInputDown、touchInputMove、touchInputUp 函数。

##### 函数：touchInputDown、touchInputMove、touchInputUp 触动点击、滑动（仅支持 Android）

touchInputDown(index,x ,y)

touchInputMove(index, x, y)

touchInputUp(index,x ,y)

| 参数  |  类型  | 必填 |        说明        |
| :---: | :----: | :--: | :----------------: |
| index | number |  否  | 手指序号（可省略） |
|   x   | number |  是  |     屏幕横坐标     |
|   y   | number |  是  |     屏幕纵坐标     |

*划动*

```lua
--此示例代码所用函数为触动精灵专用函数请勿用于积木编程
--在部分安卓应用程序中的 HTML5 页面中，出现脚本能够点击，但点击没有后续反应的问题并且使用 os.execute 函数也没有效果，可以使用此函数
--在坐标 (150, 550)按下
touchInputDown(150, 550);    
mSleep(30);
--移动到坐标 (150, 600)，注意一次滑动的坐标间隔不要太大，不宜超过 50 像素
touchInputMove(150, 600);    
mSleep(30);
--在坐标 (150, 600) 抬起
touchInputUp(150, 600);
```

## Lua 编程

### 语句块

```lua
do print("Hello") end
```

- 可以在函数和语句块中定义局部变量。

### 赋值语句

```lua
a,b,c,d=1,2,3,4
```

```lua
a,b=b,a --多么方便的交换变量功能啊
```

```lua
local a,b,c = 1,2,3 -- a,b,c 都是局部变量
```

### 循环语句

- while 循环：while 条件 do … end
- repeat 循环：repeat … until 条件
- for 循环：for 变量 = 初值，终点值，步进 do … end
- for 循环：for 变量 1，变量 2，… ，变量 N in表或枚举函数 do … end

**while 循环**

```lua
my_table = {1,2,3}
local index = 1  -- 注意: table 中的索引从 1 开始

while my_table[index] do   -- 只要条件返回 true，就一直执行循环 
print(my_table[index]) 
index = index +1   -- Lua 中没有 i++ 的写法，所以只能用这种写法
end

-- 输出 1
--      2
--      3
```

**repeat 循环(相当于其他语言中的 do…while)**

```lua
local snum = 1 --起始值

repeat
print("snum is "..snum)
snum = snum + 1
until snum == 4   --当 snum 等于 4 时 跳出循环

--输出:
--snum is 1
--snum is 2
--snum is 3
```

**for 循环**

```lua
for i = 1, #my_table do --#my_table 表示取表的长度,上边定义了长度为 3
print(my_table[i])
end
```

```lua
for i=1,10,2 do -- 这里i=1表示起始值, 10 表示最大值, 2 表示步进值(可以没有,默认值为 1,也就是其他语言里的 i++)
print(i)
end
```

### 数值运算

和 C 语言一样，支持+, -, *, /。但 Lua 还多了一个 "^"。这表示指数乘方运算。比如 2^3 结果为 8, 2^4 结果为 16。

连接两个字符串，可以用”..“运处符。如：

```lua
"This a " .. "string." -- 等于 "this a string"
```

### 比较运算

< > <= >= == ~=

分别表示 小于，大于，不大于，不小于，相等，不相等

所有这些操作符总是返回 true 或 false。

对于 Table,Function 和 Userdata 类型的数据，只有 == 和 ~=可以用。相等表示两个变量引用的是同一个数据。比如：

```lua
a={1,2}
b=a
print(a==b, a~=b) -- true, false
a={1,2}
b={1,2}
print(a==b, a~=b) -- false, true
```

### 逻辑运算

and, or, not

在 Lua 中，只有 false 和 nil 才计算为 false，其它任何数据都计算为 true，**0 也是 true**！

and 和 or 的运算结果不是 true 和 false，而是和它的两个操作数相关。

a and b： 如果 a 为 false，则返回 a；否则返回 b

a or b： 如果 a 为 true，则返回 a；否则返回 b

```lua
print(4 and 5) --> 5
print(nil and 13) --> nil
print(false and 13) --> false
print(4 or 5) --> 4
print(false or 5) --> 5
```

可以模拟 C 语言中的语句：

```c
x = a? b : c
```

在 Lua 中，可以写成：

```lua
x = a and b or c
```

最有用的语句是：

```lua
x = x or v
```

它相当于：

```lua
if not x then x = v end
```

### 运算符优先级

从高到低顺序如下：

```lua
^

not - （一元运算）

* /

+ -

..（字符串连接）

< > <= >= ~= ==

and

or
```

### 关键字

关键字是不能做为变量的

```lua
and break do else elseif

end false for function if
        
in local nil not or
        
repeat return then true until　while
```

### 变量类型

可以用 type() 函数来检查

**Nil 空值**

所有没有使用过的变量，都是 nil。nil 既是值，又是类型。

**Boolean 布尔值**

true 或 false

**Number 数值**

在 Lua 里，数值相当于 C 语言的 double

**String 字符串**

如果你愿意的话，字符串是可以包含 '\0' 字符的

**Table 关系表类型**

这个类型功能比较强大

**Function 函数类型**

函数也是一种类型，也就是说，所有的函数，它本身就是一个变量

**Userdata**

这个类型专门用来和 Lua 的宿主打交道的。宿主通常是用 C 和 C++ 来编写的，在这种情况下，Userdata 可以是宿主的任意数据类型，常用的有 Struct 和指针。

**Thread 线程类型**

在 Lua 中没有真正的线程。Lua 中可以将一个函数分成几部份运行

### 变量的定义

