### 函数：getRndNum 获取随机数

**函数名称：获取随机数**

**函数功能：获取真随机数，随机数值**

**函数方法**

rnum = getRndNum();

| 返回值 |  类型  | 说明                             |
| :----: | :----: | :------------------------------- |
|  rnum  | number | 随机范围的整数，每次获取数字不同 |

**函数用例**

```lua
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
math.randomseed(getRndNum()) -- 随机种子初始化真随机数
num = math.random(1, 100) -- 随机获取一个 1 - 100 之间的数字
dialog(num,5)
```

### 函数：getRndStr 生成随机字符串

**函数名称：生成随机字符串**

**函数功能：生成随机字符串**

**TSLib版本：仅 v1.2.8 及其以上版本支持**

**函数方法**

str2 = getRndStr(str1)

|  参数   |  类型  | 必填 | 说明                              |
| :-----: | :----: | :--: | :-------------------------------- |
|  str1   | string |  是  | 需要操作的字符串                  |
| options | table  |  否  | 生成规则，不写默认生成 6 位字符串 |

options 参数介绍

| 参数  |  类型  | 必填 | 说明                                          |
| :---: | :----: | :--: | :-------------------------------------------- |
| tstab | number |  是  | 不可修改，只能写 1                            |
|  num  | number |  否  | 需要生成字符串的数量，不写默认生成 6 位字符串 |

| 返回值 |  类型  | 说明             |
| :----: | :----: | :--------------- |
|  str2  | string | 生成的随机字符串 |

**函数用例**

```lua
require("TSLib")
local str1 ="安彤含祖赩涤彰爵舞深群适渺辞莞延稷桦赐帅适亭濮存城稷澄添悟绢绢澹迪婕箫识悟舞添剑深禄延涤濮存罡禄瑛瑛嗣嫚朵寅添渟黎臻舞绢城骥彰渺禾教祖剑黎莞咸浓芦澹帅臻渟添禾亭添亭霖深策臻稷辞悟悟澄涉城鸥黎悟乔恒黎鲲涉莞霖甲深婕乔程澹男岳深涉益澹悟箫乔多职适芦瑛澄婕朵适祖霖瑛坤嫚涉男珂箫芦黎珹绢芦程识嗣珂瑰枝允黎庸嗣赐罡纵添禄霖男延甲彰咸稷箫岳悟职祖恒珂庸琅男莞庸浓多罡延瑛濮存爵添剑益骥澄延迪寅婕程霖识瑰识程群教朵悟舞岳浓箫城适程禾嫚罡咸职铃爵渺添辞嫚浓寅鲲嗣瑛鸥多教瑛迪坤铃珹群黎益澄程莞深坤澹禄职澹赩澄藉群箫骥定彰寅臻渟枝允珹深群黎甲鲲亭黎藏浓涤渟莞寅辞嗣坤迪嫚添策庸策藉瑰彰箫益莞渺乔彰延舞祖婕澹渺鸥纵嗣瑛藏濮存婕职程芦群禾嫚程辞祖黎职浓桦藏渟禾彰帅辞铃铃黎允绢濮存剑辞禾瑰添延添悟赐祖咸莞男绢策婕藉禾浓珹涤祖汉骥舞瑛多稷赐莞渟黎舞桦黎群藏渺黎坤桦咸迪澈舞允稷咸剑定亭澄濮存鲲臻全鸥多赐程添瑛亭帅悟甲男帅涤适纵渟鲲亭悟琅亭添允舞禾庸咸瑛教鲲允箫芦允瑛咸鸥帅悟延珂黎珹箫爵剑霖剑霖禄鸥悟涉彰群悟辞帅渺莞澄桦瑛适臻益霖珹亭澹辞坤程嗣铃箫策澈枝赐莞爵渟禄群枝添芦群浓赐职益城澄赩琅延群乔珹鲲祖群悟黎定庸澄芦延霖罡鲲咸渺纵亭禄鸥赩涤剑澹藏纵濮存澄芦剑延瑰稷黎益赩澄允悟澈甲嗣绢朵益甲悟涤婕群咸臻箫鲲寅鸥桦益珂舞允庸芦藉寅渺咸赐澄程剑瑰霖瑰铃帅男铃悟识瑰仕仕城允莞全朵涤铃剑渺稷剑珂铃箫全仕益纵芦桦珂濮存城朵朵咸程剑澄定澈爵寅庸定莞瑛教彰黎箫仕黎桦赩深赩爵迪悟珹涤琅添箫桦帅瑛黎黎策识寅嫚涉迪策汉舞定彰允男祖教澄群瑛濮存男禾教莞禾鸥澈濮存岳城嫚深舞教岳澄亭禾坤朵亭职莞稷寅瑰城庸亭舞禾瑛恒坤浓彰莞澄澈鸥臻稷教琅辞益剑藉黎添瑛延舞坤仕岳多婕骥迪帅黎悟全澄识益甲桦纵适罡彰澄禾婕程黎城涤浓枝箫咸渟岳渟澹臻珹识珹澄箫辞浓鲲识悟允悟禾识群祖迪渟鲲群庸莞珹悟澹瑰悟鸥汉群甲莞庸职琅莞桦鲲朵深乔辞允彰渺朵瑰亭瑰朵定深男识群职霖益男舞城允舞爵赩枝罡罡群澹芦藉爵悟渟澹禾多庸箫坤乔芦甲濮存多渟藉珹赐汉纵亭禾城枝剑露以玉春飞慧娜悠亦元晔曜霜宁桃彦仪雨琴青筠逸曼代菀孤昆秋蕊语莺丝红羲盛静南淑震晴彭祯山霞凝柔隽松翠高骊雅念皓双洛紫瑞英思歆蓉娟波芸荷笑云若宏夏妍嘉彩如鹏寄芝柳凌莹蝶舒恬虹清爽月巧乾勋翰芳罗刚鸿运枫阳葳杰怀悦凡哲瑶凯然尚丹奇弘顺依雪菡君畅白振馨寻涵问洁辉忆傲伟经润志华兰芹修晨木宛俊博韶天锐溪燕家沈放明光千永溶昊梅巍真尔馥莲怜惜佳广香宇槐珺芷帆秀理柏书沛琪仙之竹向卉欣旻晓冬幻和雁淳浩歌荣懿文幼岚昕牧绿轩工旭颜醉玑卓觅叶夜灵胜晗恨流佁乐火音采睿翎萱民画梦寒泽怡丽心石邵玮佑旺壮名一学谷韵宜冰赫新蕾美晖项琳平树又炳骏气海毅敬曦婉爰伯珊影鲸容晶婷林子昌梧芙澍诗星冉初映善越原茂国腾孟水烟半峯莉绮德慈敏才戈梓景智盼霁琇苗熙姝从谊风发钰玛忍婀菲昶可荌小倩妙涛姗方图迎惠晤宣康娅玟奕锦濯穆禧伶丰良祺珍曲喆扬拔驰绣烁叡长雯颖辰慕承远彬斯薇成聪爱朋萦田致世实愫进瀚朝强铭煦朗精艺熹建忻晏冷佩东古坚滨菱囡银咏正儿瑜宝蔓端蓓芬碧人开珠昂琬洋璠桐舟姣琛亮煊信今年庄淼沙黛烨楠桂斐胤骄兴尘河晋卿易愉蕴雄访湛蓝媛骞娴儒妮旋友娇泰基礼芮羽妞意翔岑苑暖玥尧璇阔燎偲靖行瑾资漪晟冠同齐复吉豆唱韫素盈密富其翮熠绍澎淡韦诚滢知鹍苒抒艳义婧闳琦壤杨芃洲阵璟茵驹涆来捷嫒圣吟恺璞西旎俨颂灿情玄利痴蕙力潍听磊宸笛中好任轶玲螺郁畴会暄峻略琼琰默池温炫季雰司杉觉维饮湉许宵茉贤昱蕤珑锋纬渊超萍嫔大霏楚通邈飙霓谧令厚本邃合宾沉昭峰业豪达彗纳飒壁施欢姮甫湘漾闲恩莎祥启煜鸣品希融野化钊仲蔚生攸能衍菁迈望起微鹤荫靓娥泓金琨筱赞典勇斌媚寿喜飇濡宕茜魁立裕弼翼央莘绚焱奥萝米衣森荃航璧为跃蒙庆琲倚穹武甜璐俏茹悌格穰皛璎龙材湃农福旷童亘苇范寰瓃忠虎颐蓄霈言禹章花健炎籁暮升葛贞侠专懋澜量纶布皎源耀鸾慨曾优栋妃游乃用路余珉藻耘军芊日赡勃卫载时三闵姿麦瑗泉郎怿惬萌照夫鑫樱琭钧掣芫侬丁育浦磬献苓翱雍婵阑女北未陶干自作伦珧溥桀州荏举杏茗洽焕吹甘硕赋漠颀妤诺展俐朔菊秉苍津空洮济尹周江荡简莱榆贝萧艾仁漫锟谨魄蔼豫纯翊堂嫣誉邦果暎珏临勤墨薄颉棠羡浚兆环铄"
local options = {
    ["tstab"] = 1, 
--随机生成 2 位字符串
    ["num"] = 2,
}
while true do
    name = getRndStr(str1,options)
    --仅支持 v1.3.1 及其以上版本 TSLib 
    --radius 仅支持引擎版本 Androidv3.2.0、iOSv3.1.5 及其以上版本，仅支持 TSLib v1.3.4 及其以上版本
    showTextView("随机名字："..name,"abc",100,100,600,300,"center","FFFFFF","000000",20,1,1,1,50)
    mSleep(1000)
end
```

### 函数：strSplit 分割字符串

**函数名称：分割字符串**

**函数功能：按照指定字符分割一个字符串为一个表**

**函数方法**

data = strSplit(str,symbol,pos)

|  参数  |  类型  | 必填 | 说明                       |
| :----: | :----: | :--: | :------------------------- |
|  str   | string |  是  | 要被分割的字符串           |
| symbol | string |  是  | 分割的依据，不填写默认 '@' |
|  pos   | numebr |  否  | 起始分割位置，缺省默认值 1 |

| 返回值 | 类型  | 说明           |
| :----: | :---: | :------------- |
|  data  | table | 分割后形成的表 |

**函数用例**

```lua
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
str="1@2@3"
symbol="@"
pos=3
data = strSplit(str,symbol,pos)  --data = {1,2,3}
dialog(data[1])
```

### 函数：split 字符串分割

**函数名称：字符串分割**

**函数功能：对字符串分割**

**函数方法**

tb = str:split(symbol)

|  参数  |  类型  | 必填 |      说明      |
| :----: | :----: | :--: | :------------: |
|  str   | string |  是  | 需要分割的内容 |
| symbol | string |  是  |   分割的依据   |

| 返回值 | 类型  |     说明     |
| :----: | :---: | :----------: |
|   tb   | table | 分割形成的表 |

**函数用例**

```lua
local ts = require("ts")
str = "  哈哈,he he,1,3,6  "
new = str:split(",") --将字符串 str 按照 `,`，分割并返回一个 table
dialog(new[2], 0)
```

### 函数：rtrim 字符串尾部空白字符过滤

**函数名称：字符串过滤**

**函数功能：对字符串尾部空白字符进行过滤**

**函数方法**

st = str:rtrim()

| 参数 |  类型  | 必填 |          说明          |
| :--: | :----: | :--: | :--------------------: |
| str  | string |  是  | 需要过滤空白字符的内容 |

| 返回值 |  类型  |     说明     |
| :----: | :----: | :----------: |
|   st   | string | 过滤后的内容 |

**函数用例**

```lua
local ts = require("ts")
str = "哈哈,he he,1,3,6  "
--结果 "哈哈,he he,1,3,6"
--删除字符串尾部的空白字符
dialog(str:rtrim(), 0)
```

**名词解析**

- 空白字符包括：空格、制表符 `\t` 、换行符 `\n` 、`\r`。

### 函数：trim 字符串首尾部空白字符过滤

**函数名称：字符串过滤**

**函数功能：对字符串首尾部空白字符进行过滤**

**函数方法**

st = str:trim()

| 参数 |  类型  | 必填 |          说明          |
| :--: | :----: | :--: | :--------------------: |
| str  | string |  是  | 需要过滤空白字符的内容 |

| 返回值 |  类型  |     说明     |
| :----: | :----: | :----------: |
|   st   | string | 过滤后的内容 |

**函数用例**

```lua
local ts = require("ts")
str = "  哈哈,he he,1,3,6  "
--删除字符串首尾部的空白字符
--结果 "哈哈,he he,1,3,6"
dialog(str:trim(), 0)
```

**名词解析**

- 空白字符包括：空格、制表符 `\t` 、换行符 `\n` 、`\r`。

### 函数：ltrim 字符串首部空白字符过滤

**函数名称：字符串分割过滤**

**函数功能：对字符串首部空白字符进行过滤**

**函数方法**

str = str:ltrim()

| 参数 |  类型  | 必填 |          说明          |
| :--: | :----: | :--: | :--------------------: |
| str  | string |  是  | 需要过滤空白字符的内容 |

| 返回值 |  类型  |     说明     |
| :----: | :----: | :----------: |
|  str   | string | 过滤后的内容 |

**函数用例**

```lua
local ts = require("ts")
str = "  哈哈,he he,1,3,6"
--删除字符串首部的空白字符
--结果 "哈哈,he he,1,3,6"
dialog(str:ltrim(), 0)
```

**名词解析**

- 空白字符包括：空格、制表符 `\t` 、换行符 `\n` 、`\r`。

### 函数：atrim 字符串所有空白字符过滤

**函数名称：字符串过滤**

**函数功能：对字符串所有空白字符进行过滤**

**函数方法**

st = str:atrim()

| 参数 |  类型  | 必填 |          说明          |
| :--: | :----: | :--: | :--------------------: |
| str  | string |  是  | 需要过滤空白字符的内容 |

| 返回值 |  类型  |     说明     |
| :----: | :----: | :----------: |
|   st   | string | 过滤后的内容 |

**函数用例**

```lua
local ts = require("ts")
str = "  哈哈,he he,1,3,6  "
--删除字符串所有的空白字符
--结果 "哈哈,hehe,1,3,6"
dialog(str:atrim(), 0)
```

**名词解析**

- 空白字符包括：空格、制表符 `\t` 、换行符 `\n` 、`\r`。

### 函数：reTxtUtf8 过滤文本前的 UTF8-BOM 内容

**函数名称：过滤 UTF8-BOM**

**函数功能：过滤文本前的 UTF8-BOM 内容**

**TSLib 版本：仅支持 v1.2.8 及其以上版本**

**函数方法**

str2 = reTxtUtf8(str1)

| 参数 |  类型  | 必填 | 说明                         |
| :--: | :----: | :--: | :--------------------------- |
| str1 | string |  是  | 需要过滤 UTF8-BOM 字符的内容 |

| 返回值 |  类型  | 说明                   |
| :----: | :----: | :--------------------- |
|  str2  | string | 过滤 UTF8-BOM 后的内容 |

**函数用例**

```lua
require "TSLib"
local ts = require("ts")
function downFile(url, path)
    status, headers, body = ts.httpGet(url)
    if status == 200 then
        file = io.open(path, "wb")
        if file then
            file:write(body)
            file:close()
            return status;
        else
            return -1;
        end
    else
        return status;
    end
end
downFile("http://video.touchsprite.com/公开分享/cs.txt", userPath().."/res/cs.txt")
local file = io.open(userPath().."/res/cs.txt",r)
if type(file) ~= "boolean"  then 
    a=file:read("*a")
    --文件内容
    dialog("文件内容："..a,3)
    --未过滤前的字符串长度
    dialog("未过滤的字符串长度："..string.len(a),3)
    --过滤后的字符串长度
    str = reTxtUtf8(a,3)
    dialog("过滤后的字符串长度："..string.len(str),3)
end
```

### 函数：ts.json.decode json 串编码

**函数名称：json 串编码**

**函数功能：将 json 格式数据转成 table 格式数据**

**函数方法**

tb = json.decode(str)

| 参数 |  类型  | 必填 |          说明          |
| :--: | :----: | :--: | :--------------------: |
| str  | string |  是  | 需要编码的 json 字符串 |

| 返回值 | 类型  |     说明     |
| :----: | :---: | :----------: |
|   tb   | table | 编码后的数据 |

**函数用例**

```lua
local ts = require("ts")--使用扩展库前必须插入这一句
local json = ts.json--使用 JSON 模块前必须插入这一句
local str = [[{"meme":[1,0,0,4,6,9,5,1,0,0],"我":"五毛","爱":"六块"}]]
--把 json 字符串转换成 table
local tmp = json.decode(str)
dialog(tmp.meme[5],5);
dialog(tostring(tmp.nullvalue),5);
```

### 函数：ts.json.encode json 串解码

**函数名称：json 串解码**

**函数功能：将 table 格式数据转成 json 格式数据**

**函数方法**

str = json.encode(tb)

| 参数 | 类型  | 必填 |      说明      |
| :--: | :---: | :--: | :------------: |
|  tb  | table |  是  | 需要解码的数据 |

| 返回值 |  类型  |           说明           |
| :----: | :----: | :----------------------: |
|  str   | string | 解码后返回的 json 字符串 |

**函数用例**

```lua
local ts = require("ts")--使用扩展库前必须插入这一句
local json = ts.json--使用 JSON 模块前必须插入这一句
local tb = {
    ["我"] = "五毛",
    ["爱"] = "六块",
    meme = {
        isArray = true,
        1,0,0,4,6,9,5,1,0,0,
    },
    nullvalue = null,
}
--把 table 转换成 json 字符串
local jsonstring = json.encode(tb);
dialog(jsonstring,5)
```

### 函数：urlEncoder 编码

**函数名称：编码**

**函数功能：json 串编码**

**TSLib 版本：仅支持 v1.2.1 以上版本**

**函数方法**

str2 = urlEncoder(str1)

| 参数 |  类型  | 必填 |       说明        |
| :--: | :----: | :--: | :---------------: |
| str1 | string |  是  | json 串编码的内容 |

| 返回值 |  类型  |     说明     |
| :----: | :----: | :----------: |
|  str2  | string | 编码后的内容 |

**函数用例**

```lua
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
dialog(urlEncoder("触动精灵"),5) -- 编码
```

### 函数：urlDecoder 解码

**函数名称：解码**

**函数功能：json 串解码**

**TSLib 版本：仅支持 v1.2.1 以上版本**

**函数方法**

str2 = urlDecoder(str1)

| 参数 |  类型  | 必填 |       说明        |
| :--: | :----: | :--: | :---------------: |
| str1 | string |  是  | json 串解码的内容 |

| 返回值 |  类型  |     说明     |
| :----: | :----: | :----------: |
|  str2  | string | 解码后的内容 |

**函数用例**

```lua
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
str1 =[[%E8%A7%A6%E5%8A%A8%E7%B2%BE%E7%81%B5]]
-- 解码
str2 = urlDecoder(str1)
dialog(str2,5)
```

### 函数：tohex 字符串转码

**函数名称：字符串转码**

**函数功能：转码，字符串转换为十六进制编码**

**函数方法**

str2 = str1:tohex()

| 参数 |  类型  | 必填 |    说明    |
| :--: | :----: | :--: | :--------: |
| str1 | string |  是  | 字符串内容 |

| 返回值 |  类型  |     说明     |
| :----: | :----: | :----------: |
|  str2  | string | 十六进制内容 |

**函数用例**

```lua
local ts = require("ts")
local str = "触动精灵"
dialog('"'..str..'" 的 16 进制编码为: <'..str:tohex()..'>',5) --“触动精灵”的 16 进制编码
```

### 函数：httpBuildQuery 自动拼接生成 URL 参数字符串

**函数功能：使用给出的关联(或下标)数组生成一个经过 URL-encode 的请求字符**

**TSLib 版本：仅支持 v1.3.4 及其以上版本**

**函数方法**

str = httpBuildQuery(tab)

| 参数 | 类型  | 必填 |      说明      |
| :--: | :---: | :--: | :------------: |
| tab  | table |  是  | 需要转换的内容 |

| 返回值 |  类型  |              说明              |
| :----: | :----: | :----------------------------: |
|  str   | string | 转换后的 URL-encode 的请求字符 |

**函数用例**

```lua
require("TSLib")
tab = {a=1,b=2,c=3,d="中文"}
dialog(httpBuildQuery(tab))
```

### 函数：imageBase64 图片 base64 编码

**函数名称：图片 base64 编码**

**函数功能：将图片进行 base64 编码**

**TSLib 版本：仅支持 v1.3.5 及其以上版本**

**函数方法**

str = imageBase64(path)

| 参数 |  类型  | 必填 | 说明               |
| :--: | :----: | :--: | :----------------- |
| path | string |  是  | 需要进行编码的图片 |

| 参数 |  类型  |     说明     |
| :--: | :----: | :----------: |
| str  | string | 编码后的数据 |

**函数用例**

```lua
require("TSLib")
path = userPath().."/res/test.png"
snapshot(path,0,0,200,200)
--需要下载 ts.so
str = imageBase64(path)
nLog(str)
```

**注意事项**

- 编码后的数据不推荐使用 dialog 进行打印。

### 函数：fromhex 十六进制转码

**函数名称：十六进制转码**

**函数功能：转码，十六进制编码转换为字符串**

**函数方法**

str2 = str1:fromhex()

| 参数 |  类型  | 必填 |     说明     |
| :--: | :----: | :--: | :----------: |
| str1 | string |  是  | 十六进制内容 |

| 返回值 |    类型    |              说明              |
| :----: | :--------: | :----------------------------: |
|  str2  | string/nil | 字符串内容，非十六进制返回为空 |

**函数用例**

```lua
local ts = require("ts")
local str = "e8a7a6e58aa8e7b2bee781b5"
dialog(str:fromhex(),5)
```

### 函数：fromgbk GBK 转 UTF8（仅支持 iOS）

**函数名称：GBK 转 UTF8**

**函数功能：转码，GBK 转 UTF8**

**引擎版本：iOS v2.2.6 以上**

**函数方法**

str2 = str1:fromgbk()

| 参数 |  类型  | 必填 |        说明         |
| :--: | :----: | :--: | :-----------------: |
| str1 | string |  是  | 需要转换的 GBK 内容 |

| 返回值 |  类型  |        说明        |
| :----: | :----: | :----------------: |
|  str2  | string | 转换后的 UTF8 内容 |

**函数用例**

*将字符串从 GBK 编码转换到 UTF8 编码*

```
require "ts"
f = io.open("/var/mobile/Media/TouchSprite/lua/a.txt", "r")
s = f:read("*a")
f:close()
dialog(s:fromgbk(),5)
```

### 函数：toUTF8 unicode 转 utf8

**函数名称：unicode 转 utf8**

**函数功能：转码，unicode 转 utf8**

**函数用例**

```lua
--unicode 转 utf8
local ts = require "ts"
local tmp = ts.json.totable([[{"toUTF8":"\u6211\u7231\u5a1c\u5a1c"}]])
dialog(tmp["toUTF8"],0)
```

### 函数：aes128_encrypt AES128 编码

**函数名称：AES128 编码**

**函数功能：字符串 AES128 编码（模式为 ECB）**

**函数方法：**

emsg = msg:aes128_encrypt(key)

| 参数 |  类型  | 必填 |      说明      |
| :--: | :----: | :--: | :------------: |
| msg  | string |  是  | 需要编码的内容 |
| key  | string |  是  |      密匙      |

| 参数 |  类型  |     说明     |
| :--: | :----: | :----------: |
| emsg | string | 编码后的内容 |

**函数用例**

```lua
local ts = require("ts")
local msg = "我是重要信息"
local key = "我是秘钥"
local emsg = msg:aes128_encrypt(key)
local emsgb64 = emsg:base64_encode()
dialog(emsgb64)
```

**注意事项**

- 在线加密/解密网址：http://tool.chacuo.net/cryptaes
- 加密模式：ECB
- 填充：pkcs7padding
- 数据块：128位
- 偏移量：空
- 输出：base64
- 字符集：utf8编码

### 函数：aes128_decrypt AES128 解码

**函数名称：AES128 解码**

**函数功能：字符串 AES128 解码（模式为 ECB）**

**函数方法**

msg = tmp:aes128_decrypt(key)

| 参数 |  类型  | 必填 |      说明      |
| :--: | :----: | :--: | :------------: |
| tmp  | string |  是  | 需要解码的内容 |
| key  | string |  是  |      密匙      |

| 参数 |  类型  |     说明     |
| :--: | :----: | :----------: |
| msg  | string | 解码后的内容 |

**函数用例**

```lua
local ts = require("ts")
local msg = "\5\4\3\2\1\0"
local key = "触动精灵"
local emsg = msg:aes128_encrypt(key)
local emsgb64 = emsg:base64_encode()
local tmp = emsgb64:base64_decode()
msg = tmp:aes128_decrypt(key)
dialog('"'..emsgb64..'"  \n使用 AES128 算法 密钥 "'..key..'" 解码值是 <'..msg:tohex()..'>', 0)
```

**注意事项**

- 在线加密/解密网址：http://tool.chacuo.net/cryptaes
- 加密模式：ECB
- 填充：pkcs7padding
- 数据块：128位
- 偏移量：空
- 输出：base64
- 字符集：utf8编码

### 函数：base64_encode BASE64 编码

**函数名称：BASE64 编码**

**函数功能：字符串 BASE64 编码（模式为 ECB）**

**函数用例**

```lua
local ts = require("ts")
local msg = "我是重要信息"
local key = "我是秘钥"
local emsg = msg:aes128_encrypt(key)
local emsgb64 = emsg:base64_encode()
dialog(emsgb64)
```

### 函数：base64_decode BASE64 解码

**函数名称：BASE64 解码**

**函数功能：字符串 BASE64 解码（模式为 ECB）**

**函数用例**

```lua
local ts = require("ts")
local msg = "\5\4\3\2\1\0"
local key = "触动精灵"
local emsg = msg:aes128_encrypt(key)
local emsgb64 = emsg:base64_encode()
local tmp = emsgb64:base64_decode()
msg = tmp:aes128_decrypt(key)
dialog('"'..emsgb64..'" base64 解码后的数据为 '..tmp:tohex()..'"',0)
```

### UTF-8 编码

本模块提供了对 UTF-8 编码的基础支持。 所有的函数都放在表 utf8 中。

除非另有说明，当一个函数需要一个字节位置的参数时，都假定这个位置要么从字节序列的开始计

算，要么从字符串长度加一的位置算。和字符串库一样，负的索引从字符串末尾计起。

### 函数：utf8.char 整数序列转换字符串

**函数名称：整数序列转换字符串**

**函数功能：接收零或多个整数，将每个整数转换成对应的 UTF-8 字节序列，并返回这些序列连接到一起的字符串**

**函数方法**

str = utf8.char (number_1,number_2...)

|    参数    |  类型  | 必填 | 说明           |
| :--------: | :----: | :--: | :------------- |
| number_(*) | number |  是  | 输入的整数序列 |

| 返回值 |  类型  | 说明                   |
| :----: | :----: | :--------------------- |
|  str   | string | 整数序列转换对应字符串 |

**函数用例**

```lua
str = utf8.char(35302,21160,31934,28789) 
dialog(str,4)
```

**扩展阅读**

- utf8.charpattern 字符串用于精确匹配到一个 UTF-8 字节序列的模式
- 详情参照这里：http://www.runoob.com/manual/lua53doc/manual.html#6.4.1

### 函数：utf8.codes 获取字符编码

**函数名称：获取字符编码**

**函数功能：返回字符串中每个字符的编码**

**函数方法**

or index,code in utf8.codes(str) do --body end

| 参数 |  类型  | 必填 | 说明         |
| :--: | :----: | :--: | :----------- |
| str  | string |  是  | 输入的字符串 |

| 返回值 |  类型  | 说明                 |
| :----: | :----: | :------------------- |
| index  | number | 字符位置（按字节数） |
|  code  | number | 字符编码             |

**函数用例**

```lua
str = "触动精灵"
for index,code in utf8.codes(str) do 
    dialog(string.format("%s的unicode编码为\\u%0x",index,code),5)
end
```

**注意事项**

- 返回字符位置按字节数计算。
- 如果处理到一个不合法的字节序列，将抛出一个错误。

# [函数：utf8.codepoint 获取指定位置字符编码](https://helpdoc.touchsprite.com/)

### 函数：utf8.codepoint 获取指定位置字符编码

**函数名称：获取指定位置字符编码**

**函数功能：获取指定位置字符编码，以整数形式返回**

**函数方法**

strcode = utf8.codepoint (str,i,j)

| 参数 |  类型  | 必填 | 说明                     |
| :--: | :----: | :--: | :----------------------- |
| str  | string |  是  | 输入的字符串             |
|  i   | number |  是  | 开始位置，不写默认为 1   |
|  j   | number |  否  | 结束位置，可不写默认为 1 |

| 返回值  |  类型  | 说明                       |
| :-----: | :----: | :------------------------- |
| strcode | number | 字符串中指定位置的字符编码 |

**函数用例**

```lua
local str = "触动精灵"
strcode = utf8.codepoint (str)
dialog(strcode)
```

**注意事项**

- 如果处理到一个不合法的字节序列，将抛出一个错误。

### 函数：utf8.len 统计字符个数

**函数名称：统计字符个数**

**函数功能：统计指定位置的字符个数**

**函数方法**

length = utf8.len (str,i,j)

| 参数 |  类型  | 必填 | 说明                    |
| :--: | :----: | :--: | :---------------------- |
| str  | string |  是  | 输入的字符串            |
|  i   | number |  否  | 开始位置，不写默认为 1  |
|  j   | number |  否  | 结束位置，不写默认为 -1 |

| 返回值 |  类型  | 说明                       |
| :----: | :----: | :------------------------- |
| length | number | 字符串中指定位置的字符个数 |

**函数用例**

```lua
local str = "触动精灵"
length = utf8.len(str)
dialog(length)
```

**注意事项**

- 如果处理到一个不合法的字节序列， 返回第一个不合法字节的位置。

### 函数：utf8.offset 获取字符位置

**函数名称：获取字符位置**

**函数功能：返回字符串中的第 n 个字符的开始位置**

**函数方法**

start_num = utf8.offset (str,n,i)

| 参数 |  类型  | 必填 | 说明             |
| :--: | :----: | :--: | :--------------- |
| str  | string |  是  | 输入的字符串     |
|  n   | number |  否  | 查找的第几个字符 |
|  i   | number |  否  | 开始位置         |

|  返回值   |  类型  | 说明                          |
| :-------: | :----: | :---------------------------- |
| start_num | number | 字符串中第 n 个字符的开始位置 |

**函数用例**

```lua
local str = "触动精灵"
start_num = utf8.offset (str,2)
dialog(start_num)
```

**注意事项**

- 返回字符位置按字节数计算。
- n 为负数则取在位置 i 前的字符。当 n 是非负数时，默认的 i 是 1，否则默认为字符串的长度加一。
- 如果处理到一个不合法的字节序列，将抛出一个错误。

### 函数：getStrNum 获取字符串数

**函数名称：获取字符串数**

**函数功能：获取字符串的个数**

**函数方法**

num = getStrNum(str)

| 参数 |  类型  | 必填 |    说明    |
| :--: | :----: | :--: | :--------: |
| str  | string |  是  | 输入的文本 |

| 返回值 |  类型  |    说明    |
| :----: | :----: | :--------: |
|  num   | number | 字符串数量 |

**函数用例**

```lua
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
num = getStrNum("计算str"); 
dialog(num,0) --返回 5
```

### 函数：deepCopyTable 复制表

**函数名称：复制表**

**函数功能：深度复制一张表**

**函数方法**

result = deepCopyTable(tmp);

| 参数 | 类型  | 必填 |      说明      |
| :--: | :---: | :--: | :------------: |
| tmp  | table |  是  | 将要被复制的表 |

| 返回值 | 类型  |    说明    |
| :----: | :---: | :--------: |
| result | table | 复制后的表 |

**函数用例**

```lua
require "TSLib"--使用本函数库必须在脚本开头引用并将文件放到设备 lua 目录下
a={1,2,3}
result=deepCopyTable(a)
```

### 函数：md5 计算 MD5

**函数名称：计算 MD5**

**函数功能：字符串 MD5 计算**

**函数方法**

str2 = str1:md5()

| 参数 |  类型  | 必填 |      说明      |
| :--: | :----: | :--: | :------------: |
| str1 | string |  是  | 需要计算的内容 |

| 返回值 |  类型  |      说明       |
| :----: | :----: | :-------------: |
|  str2  | string | 计算后的 md5 值 |

**函数用例**

```lua
local ts = require("ts")
local str = "触动精灵"
local binstr = "\0\1\2\3\4\5"
dialog('"'..str..'" 的 MD5 值是: '..str:md5(), 0)--计算"触动精灵"的 MD5 值
dialog('<'..binstr:tohex()..'> 的 MD5 值是: '..binstr:md5(), 0)--计算“000102030405”的 MD5 值
```

### 函数：sha1 计算 SHA1

**函数名称：计算 SHA1**

**函数功能：字符串 SHA1 计算**

**函数方法**

str2 = str1:sha1()

| 参数 |  类型  | 必填 |      说明      |
| :--: | :----: | :--: | :------------: |
| str1 | string |  是  | 需要计算的内容 |

| 返回值 |  类型  |       说明       |
| :----: | :----: | :--------------: |
|  str2  | string | 计算后的 SHA1 值 |

**函数用例**

```lua
local ts = require("ts")
local str = "触动精灵的征程"
local binstr = "\0\1\2\3\4\5"
dialog('"'..str..'" 的 SHA1 值是: '..str:sha1(), 0)--计算"触动精灵"的 SHA1 值
dialog('<'..binstr:tohex()..'> 的 SHA1 值是: '..binstr:sha1(), 0)计算“000102030405”的 SHA1 值
```

